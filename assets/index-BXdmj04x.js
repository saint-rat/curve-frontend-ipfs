const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./core-WM5S_B4o.js","./index-DMeSRogx.js","./index-Dbs7FbU6.css"])))=>i.map(i=>d[i]);
import{g as lf,f as uf,k as Fg,j as qg,r as Mg,l as Lg,m as zg,n as Vg,o as Nt,_ as Kg}from"./index-DMeSRogx.js";import{r as Hg}from"./events-DQ172AOg.js";function Wg(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function hf(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Hn(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function Ka(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function Vo(t){if(!Array.isArray(t))throw new Error("array expected")}function Wn(t,e){if(!hf(!0,e))throw new Error(`${t}: array of strings expected`)}function Gg(t,e){if(!hf(!1,e))throw new Error(`${t}: array of numbers expected`)}function Yg(...t){const e=s=>s,r=(s,o)=>a=>s(o(a)),i=t.map(s=>s.encode).reduceRight(r,e),n=t.map(s=>s.decode).reduce(r,e);return{encode:i,decode:n}}function Zg(t){const e=typeof t=="string"?t.split(""):t,r=e.length;Wn("alphabet",e);const i=new Map(e.map((n,s)=>[n,s]));return{encode:n=>(Vo(n),n.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:n=>(Vo(n),n.map(s=>{Hn("alphabet.decode",s);const o=i.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function Jg(t=""){return Hn("join",t),{encode:e=>(Wn("join.decode",e),e.join(t)),decode:e=>(Hn("join.decode",e),e.split(t))}}function Xg(t,e="="){return Ka(t),Hn("padding",e),{encode(r){for(Wn("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){Wn("padding.decode",r);let i=r.length;if(i*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&r[i-1]===e;i--)if((i-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,i)}}}const ff=(t,e)=>e===0?t:ff(e,t%e),Gn=(t,e)=>t+(e-ff(t,e)),Us=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function kc(t,e,r,i){if(Vo(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Gn(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${Gn(e,r)}`);let n=0,s=0;const o=Us[e],a=Us[r]-1,c=[];for(const l of t){if(Ka(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(n=n<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=r;s-=r)c.push((n>>s-r&a)>>>0);const u=Us[s];if(u===void 0)throw new Error("invalid carry");n&=u-1}if(n=n<<r-s&a,!i&&s>=e)throw new Error("Excess padding");if(!i&&n>0)throw new Error(`Non-zero padding: ${n}`);return i&&s>0&&c.push(n>>>0),c}function Qg(t,e=!1){if(Ka(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Gn(8,t)>32||Gn(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!Wg(r))throw new Error("radix2.encode input should be Uint8Array");return kc(Array.from(r),8,t,!e)},decode:r=>(Gg("radix2.decode",r),Uint8Array.from(kc(r,t,8,e)))}}const ey=Yg(Qg(5),Zg("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Xg(5),Jg(""));var ot=Hg();const Ha=lf(ot);var Fc=function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},ty=(function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t})(),ry=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t})(),iy=(function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t})(),ny=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})(),sy=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})(),oy=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,ay=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,qc=3,cy=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",oy]],Mc=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function ly(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new sy:typeof navigator<"u"?hy(navigator.userAgent):dy()}function uy(t){return t!==""&&cy.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]},!1)}function hy(t){var e=uy(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new ny;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<qc&&(n=Fc(Fc([],n,!0),py(qc-n.length),!0)):n=[];var s=n.join("."),o=fy(t),a=ay.exec(t);return a&&a[1]?new iy(r,s,o,a[1]):new ty(r,s,o)}function fy(t){for(var e=0,r=Mc.length;e<r;e++){var i=Mc[e],n=i[0],s=i[1],o=s.exec(t);if(o)return n}return null}function dy(){var t=typeof process<"u"&&process.version;return t?new ry(process.version.slice(1)):null}function py(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var js={};var Ko=function(t,e){return Ko=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Ko(t,e)};function gy(t,e){Ko(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ho=function(){return Ho=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ho.apply(this,arguments)};function yy(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function wy(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function my(t,e){return function(r,i){e(r,i,t)}}function by(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function vy(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(h){o(h)}}function c(u){try{l(i.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):n(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function Ey(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function xy(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function _y(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Wo(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function df(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function Iy(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(df(arguments[e]));return t}function Sy(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function Gi(t){return this instanceof Gi?(this.v=t,this):new Gi(t)}function $y(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(f){i[f]&&(n[f]=function(p){return new Promise(function(d,y){s.push([f,p,d,y])>1||a(f,p)})})}function a(f,p){try{c(i[f](p))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof Gi?Promise.resolve(f.value.v).then(l,u):h(s[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Oy(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:Gi(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function Dy(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Wo=="function"?Wo(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Ay(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Py(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Cy(t){return t&&t.__esModule?t:{default:t}}function By(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Ty(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const Ry=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ho},__asyncDelegator:Oy,__asyncGenerator:$y,__asyncValues:Dy,__await:Gi,__awaiter:vy,__classPrivateFieldGet:By,__classPrivateFieldSet:Ty,__createBinding:xy,__decorate:wy,__exportStar:_y,__extends:gy,__generator:Ey,__importDefault:Cy,__importStar:Py,__makeTemplateObject:Ay,__metadata:by,__param:my,__read:df,__rest:yy,__spread:Iy,__spreadArrays:Sy,__values:Wo},Symbol.toStringTag,{value:"Module"})),hs=uf(Ry);var ks={},Ii={},Lc;function Ny(){if(Lc)return Ii;Lc=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Ii.delay=t,Ii}var Pr={},Fs={},Cr={},zc;function Uy(){return zc||(zc=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.ONE_THOUSAND=Cr.ONE_HUNDRED=void 0,Cr.ONE_HUNDRED=100,Cr.ONE_THOUSAND=1e3),Cr}var qs={},Vc;function jy(){return Vc||(Vc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365})(qs)),qs}var Kc;function pf(){return Kc||(Kc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=hs;e.__exportStar(Uy(),t),e.__exportStar(jy(),t)})(Fs)),Fs}var Hc;function ky(){if(Hc)return Pr;Hc=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.fromMiliseconds=Pr.toMiliseconds=void 0;const t=pf();function e(i){return i*t.ONE_THOUSAND}Pr.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Pr.fromMiliseconds=r,Pr}var Wc;function Fy(){return Wc||(Wc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=hs;e.__exportStar(Ny(),t),e.__exportStar(ky(),t)})(ks)),ks}var ti={},Gc;function qy(){if(Gc)return ti;Gc=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return ti.Watch=t,ti.default=t,ti}var Ms={},Si={},Yc;function My(){if(Yc)return Si;Yc=1,Object.defineProperty(Si,"__esModule",{value:!0}),Si.IWatch=void 0;class t{}return Si.IWatch=t,Si}var Zc;function Ly(){return Zc||(Zc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),hs.__exportStar(My(),t)})(Ms)),Ms}var Jc;function zy(){return Jc||(Jc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=hs;e.__exportStar(Fy(),t),e.__exportStar(qy(),t),e.__exportStar(Ly(),t),e.__exportStar(pf(),t)})(js)),js}var L=zy(),ne={},Xc;function gf(){if(Xc)return ne;Xc=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.getLocalStorage=ne.getLocalStorageOrThrow=ne.getCrypto=ne.getCryptoOrThrow=ne.getLocation=ne.getLocationOrThrow=ne.getNavigator=ne.getNavigatorOrThrow=ne.getDocument=ne.getDocumentOrThrow=ne.getFromWindowOrThrow=ne.getFromWindow=void 0;function t(f){let p;return typeof window<"u"&&typeof window[f]<"u"&&(p=window[f]),p}ne.getFromWindow=t;function e(f){const p=t(f);if(!p)throw new Error(`${f} is not defined in Window`);return p}ne.getFromWindowOrThrow=e;function r(){return e("document")}ne.getDocumentOrThrow=r;function i(){return t("document")}ne.getDocument=i;function n(){return e("navigator")}ne.getNavigatorOrThrow=n;function s(){return t("navigator")}ne.getNavigator=s;function o(){return e("location")}ne.getLocationOrThrow=o;function a(){return t("location")}ne.getLocation=a;function c(){return e("crypto")}ne.getCryptoOrThrow=c;function l(){return t("crypto")}ne.getCrypto=l;function u(){return e("localStorage")}ne.getLocalStorageOrThrow=u;function h(){return t("localStorage")}return ne.getLocalStorage=h,ne}var sr=gf(),$i={},Qc;function Vy(){if(Qc)return $i;Qc=1,Object.defineProperty($i,"__esModule",{value:!0}),$i.getWindowMetadata=void 0;const t=gf();function e(){let r,i;try{r=t.getDocumentOrThrow(),i=t.getLocationOrThrow()}catch{return null}function n(){const p=r.getElementsByTagName("link"),d=[];for(let y=0;y<p.length;y++){const m=p[y],v=m.getAttribute("rel");if(v&&v.toLowerCase().indexOf("icon")>-1){const I=m.getAttribute("href");if(I)if(I.toLowerCase().indexOf("https:")===-1&&I.toLowerCase().indexOf("http:")===-1&&I.indexOf("//")!==0){let b=i.protocol+"//"+i.host;if(I.indexOf("/")===0)b+=I;else{const E=i.pathname.split("/");E.pop();const D=E.join("/");b+=D+"/"+I}d.push(b)}else if(I.indexOf("//")===0){const b=i.protocol+I;d.push(b)}else d.push(I)}}return d}function s(...p){const d=r.getElementsByTagName("meta");for(let y=0;y<d.length;y++){const m=d[y],v=["itemprop","property","name"].map(I=>m.getAttribute(I)).filter(I=>I?p.includes(I):!1);if(v.length&&v){const I=m.getAttribute("content");if(I)return I}}return""}function o(){let p=s("name","og:site_name","og:title","twitter:title");return p||(p=r.title),p}function a(){return s("description","og:description","twitter:description","keywords")}const c=o(),l=a(),u=i.origin,h=n();return{description:l,url:u,icons:h,name:c}}return $i.getWindowMetadata=e,$i}var Ky=Vy();const Hy="0.1.1";function Wy(){return Hy}class le extends Error{constructor(e,r={}){const i=(()=>{if(r.cause instanceof le){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),n=r.cause instanceof le&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${n??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...i||n?["",i?`Details: ${i}`:void 0,n?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${Wy()}`}),this.cause=r.cause,this.details=i,this.docs=o,this.docsPath=n,this.shortMessage=e}walk(e){return yf(this,e)}}function yf(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?yf(t.cause,e):e?null:t}const Wa=BigInt(0),Go=BigInt(1);function nn(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ga(t){if(!nn(t))throw new Error("Uint8Array expected")}function Yi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function wn(t){const e=t.toString(16);return e.length&1?"0"+e:e}function wf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Wa:BigInt("0x"+t)}const mf=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Gy=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Zi(t){if(Ga(t),mf)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Gy[t[r]];return e}const Lt={_0:48,_9:57,A:65,F:70,a:97,f:102};function el(t){if(t>=Lt._0&&t<=Lt._9)return t-Lt._0;if(t>=Lt.A&&t<=Lt.F)return t-(Lt.A-10);if(t>=Lt.a&&t<=Lt.f)return t-(Lt.a-10)}function Yn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(mf)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=el(t.charCodeAt(s)),a=el(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function Kr(t){return wf(Zi(t))}function bf(t){return Ga(t),wf(Zi(Uint8Array.from(t).reverse()))}function sn(t,e){return Yn(t.toString(16).padStart(e*2,"0"))}function vf(t,e){return sn(t,e).reverse()}function ft(t,e,r){let i;if(typeof e=="string")try{i=Yn(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(nn(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function Zn(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];Ga(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}const Ls=t=>typeof t=="bigint"&&Wa<=t;function Ya(t,e,r){return Ls(t)&&Ls(e)&&Ls(r)&&e<=t&&t<r}function di(t,e,r,i){if(!Ya(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function Yy(t){let e;for(e=0;t>Wa;t>>=Go,e+=1);return e}const fs=t=>(Go<<BigInt(t))-Go,zs=t=>new Uint8Array(t),tl=t=>Uint8Array.from(t);function Zy(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=zs(t),n=zs(t),s=0;const o=()=>{i.fill(1),n.fill(0),s=0},a=(...h)=>r(n,i,...h),c=(h=zs(0))=>{n=a(tl([0]),h),i=a(),h.length!==0&&(n=a(tl([1]),h),i=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){i=a();const p=i.slice();f.push(p),h+=i.length}return Zn(...f)};return(h,f)=>{o(),c(h);let p;for(;!(p=f(l()));)c();return o(),p}}const Jy={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||nn(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ds(t,e,r={}){const i=(n,s,o)=>{const a=Jy[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}function rl(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}function Xy(t,e){if(ol(t)>e)throw new bw({givenSize:ol(t),maxSize:e})}const zt={zero:48,nine:57,A:65,F:70,a:97,f:102};function il(t){if(t>=zt.zero&&t<=zt.nine)return t-zt.zero;if(t>=zt.A&&t<=zt.F)return t-(zt.A-10);if(t>=zt.a&&t<=zt.f)return t-(zt.a-10)}function Qy(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;if(t.length>i)throw new vw({size:t.length,targetSize:i,type:"Bytes"});const n=new Uint8Array(i);for(let s=0;s<i;s++){const o=r==="right";n[o?s:i-s-1]=t[o?s:t.length-s-1]}return n}function Ef(t,e){if($r(t)>e)throw new lw({givenSize:$r(t),maxSize:e})}function ew(t,e){if(typeof e=="number"&&e>0&&e>$r(t)-1)throw new If({offset:e,position:"start",size:$r(t)})}function tw(t,e,r){if(typeof e=="number"&&typeof r=="number"&&$r(t)!==r-e)throw new If({offset:r,position:"end",size:$r(t)})}function xf(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;const n=t.replace("0x","");if(n.length>i*2)throw new uw({size:Math.ceil(n.length/2),targetSize:i,type:"Hex"});return`0x${n[r==="right"?"padEnd":"padStart"](i*2,"0")}`}const rw="#__bigint";function Za(t,e,r){return JSON.stringify(t,(i,n)=>typeof n=="bigint"?n.toString()+rw:n,r)}const iw=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function nw(t,e={}){const{strict:r=!1}=e;if(!t)throw new nl(t);if(typeof t!="string")throw new nl(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new sl(t);if(!t.startsWith("0x"))throw new sl(t)}function sw(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Ja(t){return t instanceof Uint8Array?Jn(t):Array.isArray(t)?Jn(new Uint8Array(t)):t}function Jn(t,e={}){let r="";for(let n=0;n<t.length;n++)r+=iw[t[n]];const i=`0x${r}`;return typeof e.size=="number"?(Ef(i,e.size),_f(i,e.size)):i}function Vs(t,e={}){const{signed:r,size:i}=e,n=BigInt(t);let s;i?r?s=(1n<<BigInt(i)*8n-1n)-1n:s=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&n>s||n<o){const l=typeof t=="bigint"?"n":"";throw new cw({max:s?`${s}${l}`:void 0,min:`${o}${l}`,signed:r,size:i,value:`${t}${l}`})}const c=`0x${(r&&n<0?(1n<<BigInt(i*8))+BigInt(n):n).toString(16)}`;return i?ow(c,i):c}function ow(t,e){return xf(t,{dir:"left",size:e})}function _f(t,e){return xf(t,{dir:"right",size:e})}function Jt(t,e,r,i={}){const{strict:n}=i;ew(t,e);const s=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return n&&tw(s,e,r),s}function $r(t){return Math.ceil((t.length-2)/2)}function aw(t,e={}){const{strict:r=!1}=e;try{return nw(t,{strict:r}),!0}catch{return!1}}class cw extends le{constructor({max:e,min:r,signed:i,size:n,value:s}){super(`Number \`${s}\` is not in safe${n?` ${n*8}-bit`:""}${i?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class nl extends le{constructor(e){super(`Value \`${typeof e=="object"?Za(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class sl extends le{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let lw=class extends le{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class If extends le{constructor({offset:e,position:r,size:i}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${i}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let uw=class extends le{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const hw=new TextEncoder;function fw(t){if(!(t instanceof Uint8Array)){if(!t)throw new mn(t);if(typeof t!="object")throw new mn(t);if(!("BYTES_PER_ELEMENT"in t))throw new mn(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new mn(t)}}function dw(t){return t instanceof Uint8Array?t:typeof t=="string"?gw(t):pw(t)}function pw(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function gw(t,e={}){const{size:r}=e;let i=t;r&&(Ef(t,r),i=_f(t,r));let n=i.slice(2);n.length%2&&(n=`0${n}`);const s=n.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const l=il(n.charCodeAt(c++)),u=il(n.charCodeAt(c++));if(l===void 0||u===void 0)throw new le(`Invalid byte sequence ("${n[c-2]}${n[c-1]}" in "${n}").`);o[a]=l*16+u}return o}function yw(t,e={}){const{size:r}=e,i=hw.encode(t);return typeof r=="number"?(Xy(i,r),ww(i,r)):i}function ww(t,e){return Qy(t,{dir:"right",size:e})}function ol(t){return t.length}function mw(t){try{return fw(t),!0}catch{return!1}}class mn extends le{constructor(e){super(`Value \`${typeof e=="object"?Za(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class bw extends le{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class vw extends le{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function Sf(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,i=Fg(dw(t));return r==="Bytes"?i:Jn(i)}class Ew extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const xw={checksum:new Ew(8192)},Ks=xw.checksum;function $f(t,e={}){const{compressed:r}=e,{prefix:i,x:n,y:s}=t;if(r===!1||typeof n=="bigint"&&typeof s=="bigint"){if(i!==4)throw new al({prefix:i,cause:new Dw});return}if(r===!0||typeof n=="bigint"&&typeof s>"u"){if(i!==3&&i!==2)throw new al({prefix:i,cause:new Ow});return}throw new $w({publicKey:t})}function _w(t){const e=(()=>{if(aw(t))return Of(t);if(mw(t))return Iw(t);const{prefix:r,x:i,y:n}=t;return typeof i=="bigint"&&typeof n=="bigint"?{prefix:r??4,x:i,y:n}:{prefix:r,x:i}})();return $f(e),e}function Iw(t){return Of(Jn(t))}function Of(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new Aw({publicKey:t});if(t.length===130){const i=BigInt(Jt(t,0,32)),n=BigInt(Jt(t,32,64));return{prefix:4,x:i,y:n}}if(t.length===132){const i=Number(Jt(t,0,1)),n=BigInt(Jt(t,1,33)),s=BigInt(Jt(t,33,65));return{prefix:i,x:n,y:s}}const e=Number(Jt(t,0,1)),r=BigInt(Jt(t,1,33));return{prefix:e,x:r}}function Sw(t,e={}){$f(t);const{prefix:r,x:i,y:n}=t,{includePrefix:s=!0}=e;return sw(s?Vs(r,{size:1}):"0x",Vs(i,{size:32}),typeof n=="bigint"?Vs(n,{size:32}):"0x")}class $w extends le{constructor({publicKey:e}){super(`Value \`${Za(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class al extends le{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class Ow extends le{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class Dw extends le{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let Aw=class extends le{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${$r(Ja(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const Pw=/^0x[a-fA-F0-9]{40}$/;function Df(t,e={}){const{strict:r=!0}=e;if(!Pw.test(t))throw new cl({address:t,cause:new Tw});if(r){if(t.toLowerCase()===t)return;if(Af(t)!==t)throw new cl({address:t,cause:new Rw})}}function Af(t){if(Ks.has(t))return Ks.get(t);Df(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=Sf(yw(e),{as:"Bytes"}),i=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&i[s]&&(i[s]=i[s].toUpperCase()),(r[s>>1]&15)>=8&&i[s+1]&&(i[s+1]=i[s+1].toUpperCase());const n=`0x${i.join("")}`;return Ks.set(t,n),n}function Cw(t,e={}){const{checksum:r=!1}=e;return Df(t),r?Af(t):t}function Bw(t,e={}){const r=Sf(`0x${Sw(t).slice(4)}`).substring(26);return Cw(`0x${r}`,e)}class cl extends le{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class Tw extends le{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class Rw extends le{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const Ye=BigInt(0),Fe=BigInt(1),qr=BigInt(2),Nw=BigInt(3),Pf=BigInt(4),Cf=BigInt(5),Bf=BigInt(8);function He(t,e){const r=t%e;return r>=Ye?r:e+r}function ct(t,e,r){let i=t;for(;e-- >Ye;)i*=i,i%=r;return i}function Yo(t,e){if(t===Ye)throw new Error("invert: expected non-zero number");if(e<=Ye)throw new Error("invert: expected positive modulus, got "+e);let r=He(t,e),i=e,n=Ye,s=Fe;for(;r!==Ye;){const a=i/r,c=i%r,l=n-s*a;i=r,r=c,n=s,s=l}if(i!==Fe)throw new Error("invert: does not exist");return He(n,e)}function Tf(t,e){const r=(t.ORDER+Fe)/Pf,i=t.pow(e,r);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function Uw(t,e){const r=(t.ORDER-Cf)/Bf,i=t.mul(e,qr),n=t.pow(i,r),s=t.mul(e,n),o=t.mul(t.mul(s,qr),n),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function jw(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Fe,r=0;for(;e%qr===Ye;)e/=qr,r++;let i=qr;const n=Xa(t);for(;ll(n,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Tf;let s=n.pow(i,e);const o=(e+Fe)/qr;return function(c,l){if(c.is0(l))return l;if(ll(c,l)!==1)throw new Error("Cannot find square root");let u=r,h=c.mul(c.ONE,s),f=c.pow(l,e),p=c.pow(l,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let d=1,y=c.sqr(f);for(;!c.eql(y,c.ONE);)if(d++,y=c.sqr(y),d===u)throw new Error("Cannot find square root");const m=Fe<<BigInt(u-d-1),v=c.pow(h,m);u=d,h=c.sqr(v),f=c.mul(f,h),p=c.mul(p,v)}return p}}function kw(t){return t%Pf===Nw?Tf:t%Bf===Cf?Uw:jw(t)}const Fw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function qw(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Fw.reduce((i,n)=>(i[n]="function",i),e);return ds(t,r)}function Mw(t,e,r){if(r<Ye)throw new Error("invalid exponent, negatives unsupported");if(r===Ye)return t.ONE;if(r===Fe)return e;let i=t.ONE,n=e;for(;r>Ye;)r&Fe&&(i=t.mul(i,n)),n=t.sqr(n),r>>=Fe;return i}function Rf(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),s=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),s),i}function ll(t,e){const r=(t.ORDER-Fe)/qr,i=t.pow(e,r),n=t.eql(i,t.ONE),s=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!n&&!s&&!o)throw new Error("invalid Legendre symbol result");return n?1:s?0:-1}function Nf(t,e){e!==void 0&&qg(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Xa(t,e,r=!1,i={}){if(t<=Ye)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=Nf(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:fs(n),ZERO:Ye,ONE:Fe,create:c=>He(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ye<=c&&c<t},is0:c=>c===Ye,isOdd:c=>(c&Fe)===Fe,neg:c=>He(-c,t),eql:(c,l)=>c===l,sqr:c=>He(c*c,t),add:(c,l)=>He(c+l,t),sub:(c,l)=>He(c-l,t),mul:(c,l)=>He(c*l,t),pow:(c,l)=>Mw(a,c,l),div:(c,l)=>He(c*Yo(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Yo(c,t),sqrt:i.sqrt||(c=>(o||(o=kw(t)),o(a,c))),toBytes:c=>r?vf(c,s):sn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?bf(c):Kr(c)},invertBatch:c=>Rf(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function Uf(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function jf(t){const e=Uf(t);return e+Math.ceil(e/2)}function Lw(t,e,r=!1){const i=t.length,n=Uf(e),s=jf(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=r?bf(t):Kr(t),a=He(o,e-Fe)+Fe;return r?vf(a,n):sn(a,n)}const ul=BigInt(0),Zo=BigInt(1);function Hs(t,e){const r=e.negate();return t?r:e}function kf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ws(t,e){kf(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),n=2**t,s=fs(t),o=BigInt(t);return{windows:r,windowSize:i,mask:s,maxNumber:n,shiftBy:o}}function hl(t,e,r){const{windowSize:i,mask:n,maxNumber:s,shiftBy:o}=r;let a=Number(t&n),c=t>>o;a>i&&(a-=s,c+=Zo);const l=e*i,u=l+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:l}}function zw(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function Vw(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Gs=new WeakMap,Ff=new WeakMap;function Ys(t){return Ff.get(t)||1}function Kw(t,e){return{constTimeNegate:Hs,hasPrecomputes(r){return Ys(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>ul;)i&Zo&&(n=n.add(s)),s=s.double(),i>>=Zo;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=Ws(i,e),o=[];let a=r,c=a;for(let l=0;l<n;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,n){let s=t.ZERO,o=t.BASE;const a=Ws(r,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:d}=hl(n,c,a);n=l,h?o=o.add(Hs(p,i[d])):s=s.add(Hs(f,i[u]))}return{p:s,f:o}},wNAFUnsafe(r,i,n,s=t.ZERO){const o=Ws(r,e);for(let a=0;a<o.windows&&n!==ul;a++){const{nextN:c,offset:l,isZero:u,isNeg:h}=hl(n,a,o);if(n=c,!u){const f=i[l];s=s.add(h?f.negate():f)}}return s},getPrecomputes(r,i,n){let s=Gs.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&Gs.set(i,n(s))),s},wNAFCached(r,i,n){const s=Ys(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=Ys(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){kf(i,e),Ff.set(r,i),Gs.delete(r)}}}function Hw(t,e,r,i){zw(r,t),Vw(i,e);const n=r.length,s=i.length;if(n!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Yy(BigInt(n));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=fs(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let y=0;y<s;y++){const m=i[y],v=Number(m>>BigInt(p)&l);u[v]=u[v].add(r[y])}let d=o;for(let y=u.length-1,m=o;y>0;y--)m=m.add(u[y]),d=d.add(m);if(f=f.add(d),p!==0)for(let y=0;y<c;y++)f=f.double()}return f}function qf(t){return qw(t.Fp),ds(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Nf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function fl(t){t.lowS!==void 0&&Yi("lowS",t.lowS),t.prehash!==void 0&&Yi("prehash",t.prehash)}function Ww(t){const e=qf(t);ds(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:i,a:n}=e;if(r){if(!i.eql(n,i.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class Gw extends Error{constructor(e=""){super(e)}}const Xt={Err:Gw,_tlv:{encode:(t,e)=>{const{Err:r}=Xt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,n=wn(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");const s=i>127?wn(n.length/2|128):"";return wn(t)+s+n+e},decode(t,e){const{Err:r}=Xt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const n=e[i++],s=!!(n&128);let o=0;if(!s)o=n;else{const c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Xt;if(t<er)throw new e("integer: negative integers are not allowed");let r=wn(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Xt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Kr(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Xt,n=ft("signature",t),{v:s,l:o}=i.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,s),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=Xt,i=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),s=i+n;return e.encode(48,s)}};function Zs(t,e){return Zi(sn(t,e))}const er=BigInt(0),_e=BigInt(1);BigInt(2);const Js=BigInt(3),Yw=BigInt(4);function Zw(t){const e=Ww(t),{Fp:r}=e,i=Xa(e.n,e.nBitLength),n=e.toBytes||((b,E,D)=>{const C=E.toAffine();return Zn(Uint8Array.from([4]),r.toBytes(C.x),r.toBytes(C.y))}),s=e.fromBytes||(b=>{const E=b.subarray(1),D=r.fromBytes(E.subarray(0,r.BYTES)),C=r.fromBytes(E.subarray(r.BYTES,2*r.BYTES));return{x:D,y:C}});function o(b){const{a:E,b:D}=e,C=r.sqr(b),T=r.mul(C,b);return r.add(r.add(T,r.mul(b,E)),D)}function a(b,E){const D=r.sqr(E),C=o(b);return r.eql(D,C)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,Js),Yw),l=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,l)))throw new Error("bad curve params: a or b");function u(b){return Ya(b,_e,e.n)}function h(b){const{allowedPrivateKeyLengths:E,nByteLength:D,wrapPrivateKey:C,n:T}=e;if(E&&typeof b!="bigint"){if(nn(b)&&(b=Zi(b)),typeof b!="string"||!E.includes(b.length))throw new Error("invalid private key");b=b.padStart(D*2,"0")}let R;try{R=typeof b=="bigint"?b:Kr(ft("private key",b,D))}catch{throw new Error("invalid private key, expected hex or "+D+" bytes, got "+typeof b)}return C&&(R=He(R,T)),di("private key",R,_e,T),R}function f(b){if(!(b instanceof y))throw new Error("ProjectivePoint expected")}const p=rl((b,E)=>{const{px:D,py:C,pz:T}=b;if(r.eql(T,r.ONE))return{x:D,y:C};const R=b.is0();E==null&&(E=R?r.ONE:r.inv(T));const A=r.mul(D,E),k=r.mul(C,E),U=r.mul(T,E);if(R)return{x:r.ZERO,y:r.ZERO};if(!r.eql(U,r.ONE))throw new Error("invZ was invalid");return{x:A,y:k}}),d=rl(b=>{if(b.is0()){if(e.allowInfinityPoint&&!r.is0(b.py))return;throw new Error("bad point: ZERO")}const{x:E,y:D}=b.toAffine();if(!r.isValid(E)||!r.isValid(D))throw new Error("bad point: x or y not FE");if(!a(E,D))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class y{constructor(E,D,C){if(E==null||!r.isValid(E))throw new Error("x required");if(D==null||!r.isValid(D)||r.is0(D))throw new Error("y required");if(C==null||!r.isValid(C))throw new Error("z required");this.px=E,this.py=D,this.pz=C,Object.freeze(this)}static fromAffine(E){const{x:D,y:C}=E||{};if(!E||!r.isValid(D)||!r.isValid(C))throw new Error("invalid affine point");if(E instanceof y)throw new Error("projective point not allowed");const T=R=>r.eql(R,r.ZERO);return T(D)&&T(C)?y.ZERO:new y(D,C,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(E){const D=Rf(r,E.map(C=>C.pz));return E.map((C,T)=>C.toAffine(D[T])).map(y.fromAffine)}static fromHex(E){const D=y.fromAffine(s(ft("pointHex",E)));return D.assertValidity(),D}static fromPrivateKey(E){return y.BASE.multiply(h(E))}static msm(E,D){return Hw(y,i,E,D)}_setWindowSize(E){I.setWindowSize(this,E)}assertValidity(){d(this)}hasEvenY(){const{y:E}=this.toAffine();if(r.isOdd)return!r.isOdd(E);throw new Error("Field doesn't support isOdd")}equals(E){f(E);const{px:D,py:C,pz:T}=this,{px:R,py:A,pz:k}=E,U=r.eql(r.mul(D,k),r.mul(R,T)),B=r.eql(r.mul(C,k),r.mul(A,T));return U&&B}negate(){return new y(this.px,r.neg(this.py),this.pz)}double(){const{a:E,b:D}=e,C=r.mul(D,Js),{px:T,py:R,pz:A}=this;let k=r.ZERO,U=r.ZERO,B=r.ZERO,$=r.mul(T,T),P=r.mul(R,R),g=r.mul(A,A),w=r.mul(T,R);return w=r.add(w,w),B=r.mul(T,A),B=r.add(B,B),k=r.mul(E,B),U=r.mul(C,g),U=r.add(k,U),k=r.sub(P,U),U=r.add(P,U),U=r.mul(k,U),k=r.mul(w,k),B=r.mul(C,B),g=r.mul(E,g),w=r.sub($,g),w=r.mul(E,w),w=r.add(w,B),B=r.add($,$),$=r.add(B,$),$=r.add($,g),$=r.mul($,w),U=r.add(U,$),g=r.mul(R,A),g=r.add(g,g),$=r.mul(g,w),k=r.sub(k,$),B=r.mul(g,P),B=r.add(B,B),B=r.add(B,B),new y(k,U,B)}add(E){f(E);const{px:D,py:C,pz:T}=this,{px:R,py:A,pz:k}=E;let U=r.ZERO,B=r.ZERO,$=r.ZERO;const P=e.a,g=r.mul(e.b,Js);let w=r.mul(D,R),x=r.mul(C,A),O=r.mul(T,k),_=r.add(D,C),S=r.add(R,A);_=r.mul(_,S),S=r.add(w,x),_=r.sub(_,S),S=r.add(D,T);let N=r.add(R,k);return S=r.mul(S,N),N=r.add(w,O),S=r.sub(S,N),N=r.add(C,T),U=r.add(A,k),N=r.mul(N,U),U=r.add(x,O),N=r.sub(N,U),$=r.mul(P,S),U=r.mul(g,O),$=r.add(U,$),U=r.sub(x,$),$=r.add(x,$),B=r.mul(U,$),x=r.add(w,w),x=r.add(x,w),O=r.mul(P,O),S=r.mul(g,S),x=r.add(x,O),O=r.sub(w,O),O=r.mul(P,O),S=r.add(S,O),w=r.mul(x,S),B=r.add(B,w),w=r.mul(N,S),U=r.mul(_,U),U=r.sub(U,w),w=r.mul(_,x),$=r.mul(N,$),$=r.add($,w),new y(U,B,$)}subtract(E){return this.add(E.negate())}is0(){return this.equals(y.ZERO)}wNAF(E){return I.wNAFCached(this,E,y.normalizeZ)}multiplyUnsafe(E){const{endo:D,n:C}=e;di("scalar",E,er,C);const T=y.ZERO;if(E===er)return T;if(this.is0()||E===_e)return this;if(!D||I.hasPrecomputes(this))return I.wNAFCachedUnsafe(this,E,y.normalizeZ);let{k1neg:R,k1:A,k2neg:k,k2:U}=D.splitScalar(E),B=T,$=T,P=this;for(;A>er||U>er;)A&_e&&(B=B.add(P)),U&_e&&($=$.add(P)),P=P.double(),A>>=_e,U>>=_e;return R&&(B=B.negate()),k&&($=$.negate()),$=new y(r.mul($.px,D.beta),$.py,$.pz),B.add($)}multiply(E){const{endo:D,n:C}=e;di("scalar",E,_e,C);let T,R;if(D){const{k1neg:A,k1:k,k2neg:U,k2:B}=D.splitScalar(E);let{p:$,f:P}=this.wNAF(k),{p:g,f:w}=this.wNAF(B);$=I.constTimeNegate(A,$),g=I.constTimeNegate(U,g),g=new y(r.mul(g.px,D.beta),g.py,g.pz),T=$.add(g),R=P.add(w)}else{const{p:A,f:k}=this.wNAF(E);T=A,R=k}return y.normalizeZ([T,R])[0]}multiplyAndAddUnsafe(E,D,C){const T=y.BASE,R=(k,U)=>U===er||U===_e||!k.equals(T)?k.multiplyUnsafe(U):k.multiply(U),A=R(this,D).add(R(E,C));return A.is0()?void 0:A}toAffine(E){return p(this,E)}isTorsionFree(){const{h:E,isTorsionFree:D}=e;if(E===_e)return!0;if(D)return D(y,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:E,clearCofactor:D}=e;return E===_e?this:D?D(y,this):this.multiplyUnsafe(e.h)}toRawBytes(E=!0){return Yi("isCompressed",E),this.assertValidity(),n(y,this,E)}toHex(E=!0){return Yi("isCompressed",E),Zi(this.toRawBytes(E))}}y.BASE=new y(e.Gx,e.Gy,r.ONE),y.ZERO=new y(r.ZERO,r.ONE,r.ZERO);const{endo:m,nBitLength:v}=e,I=Kw(y,m?Math.ceil(v/2):v);return{CURVE:e,ProjectivePoint:y,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:u}}function Jw(t){const e=qf(t);return ds(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Xw(t){const e=Jw(t),{Fp:r,n:i,nByteLength:n,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(g){return He(g,i)}function l(g){return Yo(g,i)}const{ProjectivePoint:u,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:p}=Zw({...e,toBytes(g,w,x){const O=w.toAffine(),_=r.toBytes(O.x),S=Zn;return Yi("isCompressed",x),x?S(Uint8Array.from([w.hasEvenY()?2:3]),_):S(Uint8Array.from([4]),_,r.toBytes(O.y))},fromBytes(g){const w=g.length,x=g[0],O=g.subarray(1);if(w===o&&(x===2||x===3)){const _=Kr(O);if(!Ya(_,_e,r.ORDER))throw new Error("Point is not on curve");const S=f(_);let N;try{N=r.sqrt(S)}catch(q){const M=q instanceof Error?": "+q.message:"";throw new Error("Point is not on curve"+M)}const j=(N&_e)===_e;return(x&1)===1!==j&&(N=r.neg(N)),{x:_,y:N}}else if(w===a&&x===4){const _=r.fromBytes(O.subarray(0,r.BYTES)),S=r.fromBytes(O.subarray(r.BYTES,2*r.BYTES));return{x:_,y:S}}else{const _=o,S=a;throw new Error("invalid Point, expected length of "+_+", or uncompressed "+S+", got "+w)}}});function d(g){const w=i>>_e;return g>w}function y(g){return d(g)?c(-g):g}const m=(g,w,x)=>Kr(g.slice(w,x));class v{constructor(w,x,O){di("r",w,_e,i),di("s",x,_e,i),this.r=w,this.s=x,O!=null&&(this.recovery=O),Object.freeze(this)}static fromCompact(w){const x=n;return w=ft("compactSignature",w,x*2),new v(m(w,0,x),m(w,x,2*x))}static fromDER(w){const{r:x,s:O}=Xt.toSig(ft("DER",w));return new v(x,O)}assertValidity(){}addRecoveryBit(w){return new v(this.r,this.s,w)}recoverPublicKey(w){const{r:x,s:O,recovery:_}=this,S=T(ft("msgHash",w));if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");const N=_===2||_===3?x+e.n:x;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const j=(_&1)===0?"02":"03",V=u.fromHex(j+Zs(N,r.BYTES)),q=l(N),M=c(-S*q),H=c(O*q),G=u.BASE.multiplyAndAddUnsafe(V,M,H);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Yn(this.toDERHex())}toDERHex(){return Xt.hexFromSig(this)}toCompactRawBytes(){return Yn(this.toCompactHex())}toCompactHex(){const w=n;return Zs(this.r,w)+Zs(this.s,w)}}const I={isValidPrivateKey(g){try{return h(g),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const g=jf(e.n);return Lw(e.randomBytes(g),e.n)},precompute(g=8,w=u.BASE){return w._setWindowSize(g),w.multiply(BigInt(3)),w}};function b(g,w=!0){return u.fromPrivateKey(g).toRawBytes(w)}function E(g){if(typeof g=="bigint")return!1;if(g instanceof u)return!0;const x=ft("key",g).length,O=r.BYTES,_=O+1,S=2*O+1;if(!(e.allowedPrivateKeyLengths||n===_))return x===_||x===S}function D(g,w,x=!0){if(E(g)===!0)throw new Error("first arg must be private key");if(E(w)===!1)throw new Error("second arg must be public key");return u.fromHex(w).multiply(h(g)).toRawBytes(x)}const C=e.bits2int||function(g){if(g.length>8192)throw new Error("input is too large");const w=Kr(g),x=g.length*8-s;return x>0?w>>BigInt(x):w},T=e.bits2int_modN||function(g){return c(C(g))},R=fs(s);function A(g){return di("num < 2^"+s,g,er,R),sn(g,n)}function k(g,w,x=U){if(["recovered","canonical"].some(W=>W in x))throw new Error("sign() legacy options not supported");const{hash:O,randomBytes:_}=e;let{lowS:S,prehash:N,extraEntropy:j}=x;S==null&&(S=!0),g=ft("msgHash",g),fl(x),N&&(g=ft("prehashed msgHash",O(g)));const V=T(g),q=h(w),M=[A(q),A(V)];if(j!=null&&j!==!1){const W=j===!0?_(r.BYTES):j;M.push(ft("extraEntropy",W))}const H=Zn(...M),G=V;function Z(W){const J=C(W);if(!p(J))return;const ue=l(J),ye=u.BASE.multiply(J).toAffine(),be=c(ye.x);if(be===er)return;const ke=c(ue*c(G+be*q));if(ke===er)return;let Ot=(ye.x===be?0:2)|Number(ye.y&_e),yn=ke;return S&&d(ke)&&(yn=y(ke),Ot^=1),new v(be,yn,Ot)}return{seed:H,k2sig:Z}}const U={lowS:e.lowS,prehash:!1},B={lowS:e.lowS,prehash:!1};function $(g,w,x=U){const{seed:O,k2sig:_}=k(g,w,x),S=e;return Zy(S.hash.outputLen,S.nByteLength,S.hmac)(O,_)}u.BASE._setWindowSize(8);function P(g,w,x,O=B){const _=g;w=ft("msgHash",w),x=ft("publicKey",x);const{lowS:S,prehash:N,format:j}=O;if(fl(O),"strict"in O)throw new Error("options.strict was renamed to lowS");if(j!==void 0&&j!=="compact"&&j!=="der")throw new Error("format must be compact or der");const V=typeof _=="string"||nn(_),q=!V&&!j&&typeof _=="object"&&_!==null&&typeof _.r=="bigint"&&typeof _.s=="bigint";if(!V&&!q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let M,H;try{if(q&&(M=new v(_.r,_.s)),V){try{j!=="compact"&&(M=v.fromDER(_))}catch(Ot){if(!(Ot instanceof Xt.Err))throw Ot}!M&&j!=="der"&&(M=v.fromCompact(_))}H=u.fromHex(x)}catch{return!1}if(!M||S&&M.hasHighS())return!1;N&&(w=e.hash(w));const{r:G,s:Z}=M,W=T(w),J=l(Z),ue=c(W*J),ye=c(G*J),be=u.BASE.multiplyAndAddUnsafe(H,ue,ye)?.toAffine();return be?c(be.x)===G:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:D,sign:$,verify:P,ProjectivePoint:u,Signature:v,utils:I}}function Qw(t){return{hash:t,hmac:(e,...r)=>Lg(t,e,zg(...r)),randomBytes:Mg}}function em(t,e){const r=i=>Xw({...t,...Qw(i)});return{...r(e),create:r}}const Mf=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),dl=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),tm=BigInt(0),rm=BigInt(1),Jo=BigInt(2),pl=(t,e)=>(t+e/Jo)/e;function im(t){const e=Mf,r=BigInt(3),i=BigInt(6),n=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,h=ct(u,r,e)*u%e,f=ct(h,r,e)*u%e,p=ct(f,Jo,e)*l%e,d=ct(p,n,e)*p%e,y=ct(d,s,e)*d%e,m=ct(y,a,e)*y%e,v=ct(m,c,e)*m%e,I=ct(v,a,e)*y%e,b=ct(I,r,e)*u%e,E=ct(b,o,e)*d%e,D=ct(E,i,e)*l%e,C=ct(D,Jo,e);if(!Xo.eql(Xo.sqr(C),t))throw new Error("Cannot find square root");return C}const Xo=Xa(Mf,void 0,void 0,{sqrt:im}),nm=em({a:tm,b:BigInt(7),Fp:Xo,n:dl,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=dl,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-rm*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=pl(s*t,e),c=pl(-i*t,e);let l=He(t-a*r-c*n,e),u=He(-a*i-c*s,e);const h=l>o,f=u>o;if(h&&(l=e-l),f&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}}},Vg);function sm(t){if(t.length!==130&&t.length!==132)throw new am({signature:t});const e=BigInt(Jt(t,0,32)),r=BigInt(Jt(t,32,64)),i=(()=>{const n=+`0x${t.slice(130)}`;if(!Number.isNaN(n))try{return om(n)}catch{throw new cm({value:n})}})();return typeof i>"u"?{r:e,s:r}:{r:e,s:r,yParity:i}}function om(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new lm({value:t})}class am extends le{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${$r(Ja(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class cm extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class lm extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function um(t){return Bw(hm(t))}function hm(t){const{payload:e,signature:r}=t,{r:i,s:n,yParity:s}=r,a=new nm.Signature(BigInt(i),BigInt(n)).addRecoveryBit(s).recoverPublicKey(Ja(e).substring(2));return _w(a)}function fm(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const r=t.length,i=t.charAt(0),n=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,f=0;const p=l.length;for(;f!==p&&l[f]===0;)f++,u++;const d=(p-f)*s+1>>>0,y=new Uint8Array(d);for(;f!==p;){let I=l[f],b=0;for(let E=d-1;(I!==0||b<h)&&E!==-1;E--,b++)I+=256*y[E]>>>0,y[E]=I%r>>>0,I=I/r>>>0;if(I!==0)throw new Error("Non-zero carry");h=b,f++}let m=d-h;for(;m!==d&&y[m]===0;)m++;let v=i.repeat(u);for(;m<d;++m)v+=t.charAt(y[m]);return v}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,f=0;for(;l[u]===i;)h++,u++;const p=(l.length-u)*n+1>>>0,d=new Uint8Array(p);for(;u<l.length;){const I=l.charCodeAt(u);if(I>255)return;let b=e[I];if(b===255)return;let E=0;for(let D=p-1;(b!==0||E<f)&&D!==-1;D--,E++)b+=r*d[D]>>>0,d[D]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");f=E,u++}let y=p-f;for(;y!==p&&d[y]===0;)y++;const m=new Uint8Array(h+(p-y));let v=h;for(;y!==p;)m[v++]=d[y++];return m}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var dm="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const on=fm(dm);function pm(t){const e=t.length;let r=0,i=0;for(;i<e;){let n=t.charCodeAt(i++);if((n&4294967168)===0){r++;continue}else if((n&4294965248)===0)r+=2;else{if(n>=55296&&n<=56319&&i<e){const s=t.charCodeAt(i);(s&64512)===56320&&(++i,n=((n&1023)<<10)+(s&1023)+65536)}(n&4294901760)===0?r+=3:r+=4}}return r}function gm(t,e,r){const i=t.length;let n=r,s=0;for(;s<i;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[n++]=o;continue}else if((o&4294965248)===0)e[n++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<i){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[n++]=o>>12&15|224,e[n++]=o>>6&63|128):(e[n++]=o>>18&7|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128)}e[n++]=o&63|128}}const ym=new TextEncoder,wm=50;function mm(t,e,r){ym.encodeInto(t,e.subarray(r))}function bm(t,e,r){t.length>wm?mm(t,e,r):gm(t,e,r)}const vm=4096;function Lf(t,e,r){let i=e;const n=i+r,s=[];let o="";for(;i<n;){const a=t[i++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[i++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[i++]&63,l=t[i++]&63;s.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[i++]&63,l=t[i++]&63,u=t[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=vm&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const Em=new TextDecoder,xm=200;function _m(t,e,r){const i=t.subarray(e,e+r);return Em.decode(i)}function Im(t,e,r){return r>xm?_m(t,e,r):Lf(t,e,r)}class bn{type;data;constructor(e,r){this.type=e,this.data=r}}class it extends Error{constructor(e){super(e);const r=Object.create(it.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:it.name})}}const Oi=4294967295;function Sm(t,e,r){const i=r/4294967296,n=r;t.setUint32(e,i),t.setUint32(e+4,n)}function zf(t,e,r){const i=Math.floor(r/4294967296),n=r;t.setUint32(e,i),t.setUint32(e+4,n)}function Vf(t,e){const r=t.getInt32(e),i=t.getUint32(e+4);return r*4294967296+i}function $m(t,e){const r=t.getUint32(e),i=t.getUint32(e+4);return r*4294967296+i}const Om=-1,Dm=4294967296-1,Am=17179869184-1;function Pm({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=Am)if(e===0&&t<=Dm){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,i=t&4294967295,n=new Uint8Array(8),s=new DataView(n.buffer);return s.setUint32(0,e<<2|r&3),s.setUint32(4,i),n}else{const r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,e),zf(i,4,t),r}}function Cm(t){const e=t.getTime(),r=Math.floor(e/1e3),i=(e-r*1e3)*1e6,n=Math.floor(i/1e9);return{sec:r+n,nsec:i-n*1e9}}function Bm(t){if(t instanceof Date){const e=Cm(t);return Pm(e)}else return null}function Tm(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),i=e.getUint32(4),n=(r&3)*4294967296+i,s=r>>>2;return{sec:n,nsec:s}}case 12:{const r=Vf(e,4),i=e.getUint32(0);return{sec:r,nsec:i}}default:throw new it(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function Rm(t){const e=Tm(t);return new Date(e.sec*1e3+e.nsec/1e6)}const Nm={type:Om,encode:Bm,decode:Rm};class ps{static defaultCodec=new ps;__brand;builtInEncoders=[];builtInDecoders=[];encoders=[];decoders=[];constructor(){this.register(Nm)}register({type:e,encode:r,decode:i}){if(e>=0)this.encoders[e]=r,this.decoders[e]=i;else{const n=-1-e;this.builtInEncoders[n]=r,this.builtInDecoders[n]=i}}tryToEncode(e,r){for(let i=0;i<this.builtInEncoders.length;i++){const n=this.builtInEncoders[i];if(n!=null){const s=n(e,r);if(s!=null){const o=-1-i;return new bn(o,s)}}}for(let i=0;i<this.encoders.length;i++){const n=this.encoders[i];if(n!=null){const s=n(e,r);if(s!=null){const o=i;return new bn(o,s)}}}return e instanceof bn?e:null}decode(e,r,i){const n=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return n?n(e,r,i):new bn(r,e)}}function Um(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Qo(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Um(t)?new Uint8Array(t):Uint8Array.from(t)}const jm=100,km=2048;let Fm=class Kf{extensionCodec;context;useBigInt64;maxDepth;initialBufferSize;sortKeys;forceFloat32;ignoreUndefined;forceIntegerToFloat;pos;view;bytes;entered=!1;constructor(e){this.extensionCodec=e?.extensionCodec??ps.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??jm,this.initialBufferSize=e?.initialBufferSize??km,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Kf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),i=new Uint8Array(r),n=new DataView(r);i.set(this.bytes),this.view=n,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=pm(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),bm(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,r){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const i=Qo(e);this.writeU8a(i)}encodeArray(e,r){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const n of e)this.doEncode(n,r+1)}countWithoutUndefined(e,r){let i=0;for(const n of r)e[n]!==void 0&&i++;return i}encodeMap(e,r){const i=Object.keys(e);this.sortKeys&&i.sort();const n=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error(`Too large map object: ${n}`);for(const s of i){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),n=i.length;if(n>=4294967296)throw new Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(i);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),Sm(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),zf(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function qm(t,e){return new Fm(e).encodeSharedRef(t)}function Xs(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const Mm=16,Lm=16;class zm{hit=0;miss=0;caches;maxKeyLength;maxLengthPerKey;constructor(e=Mm,r=Lm){this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,i){const n=this.caches[i-1];e:for(const s of n){const o=s.bytes;for(let a=0;a<i;a++)if(o[a]!==e[r+a])continue e;return s.str}return null}store(e,r){const i=this.caches[e.length-1],n={bytes:e,str:r};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=n:i.push(n)}decode(e,r,i){const n=this.find(e,r,i);if(n!=null)return this.hit++,n;this.miss++;const s=Lf(e,r,i),o=Uint8Array.prototype.slice.call(e,r,r+i);return this.store(o,s),s}}const ea="array",Li="map_key",Hf="map_value",Vm=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new it("The type of key must be string or number but "+typeof t)};class Km{stack=[];stackHeadPosition=-1;get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=ea,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=Li,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===ea){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===Li||e.type===Hf){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Di=-1,Qa=new DataView(new ArrayBuffer(0)),Hm=new Uint8Array(Qa.buffer);try{Qa.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const gl=new RangeError("Insufficient data"),Wm=new zm;let Gm=class Wf{extensionCodec;context;useBigInt64;rawStrings;maxStrLength;maxBinLength;maxArrayLength;maxMapLength;maxExtLength;keyDecoder;mapKeyConverter;totalPos=0;pos=0;view=Qa;bytes=Hm;headByte=Di;stack=new Km;entered=!1;constructor(e){this.extensionCodec=e?.extensionCodec??ps.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??Oi,this.maxBinLength=e?.maxBinLength??Oi,this.maxArrayLength=e?.maxArrayLength??Oi,this.maxMapLength=e?.maxMapLength??Oi,this.maxExtLength=e?.maxExtLength??Oi,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:Wm,this.mapKeyConverter=e?.mapKeyConverter??Vm}clone(){return new Wf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Di,this.stack.reset()}setBuffer(e){const r=Qo(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Di&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),i=Qo(e),n=new Uint8Array(r.length+i.length);n.set(r),n.set(i,r.length),this.setBuffer(n)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:i}=this;return new RangeError(`Extra ${r.byteLength-i} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,i;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:n,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Xs(n)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let i=r,n=-1;for await(const s of e){if(r&&n===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),i&&(n=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--n!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const n=e-128;if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e<160){const n=e-144;if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else{const n=e-160;r=this.decodeString(n,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const n=this.lookU8();r=this.decodeString(n,1)}else if(e===218){const n=this.lookU16();r=this.decodeString(n,2)}else if(e===219){const n=this.lookU32();r=this.decodeString(n,4)}else if(e===220){const n=this.readU16();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===221){const n=this.readU32();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===222){const n=this.readU16();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===223){const n=this.readU32();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===196){const n=this.lookU8();r=this.decodeBinary(n,1)}else if(e===197){const n=this.lookU16();r=this.decodeBinary(n,2)}else if(e===198){const n=this.lookU32();r=this.decodeBinary(n,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const n=this.lookU8();r=this.decodeExtension(n,1)}else if(e===200){const n=this.lookU16();r=this.decodeExtension(n,2)}else if(e===201){const n=this.lookU32();r=this.decodeExtension(n,4)}else throw new it(`Unrecognized type byte: ${Xs(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const n=i.top();if(n.type===ea)if(n.array[n.position]=r,n.position++,n.position===n.size)r=n.array,i.release(n);else continue e;else if(n.type===Li){if(r==="__proto__")throw new it("The key __proto__ is not allowed");n.key=this.mapKeyConverter(r),n.type=Hf;continue e}else if(n.map[n.key]=r,n.readCount++,n.readCount===n.size)r=n.map,i.release(n);else{n.key=null,n.type=Li;continue e}}return r}}readHeadByte(){return this.headByte===Di&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Di}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new it(`Unrecognized array type byte: ${Xs(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new it(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new it(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){if(e>this.maxStrLength)throw new it(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw gl;const i=this.pos+r;let n;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?n=this.keyDecoder.decode(this.bytes,i,e):n=Im(this.bytes,i,e),this.pos+=r+e,n}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Li:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new it(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw gl;const i=this.pos+r,n=this.bytes.subarray(i,i+e);return this.pos+=r+e,n}decodeExtension(e,r){if(e>this.maxExtLength)throw new it(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+r),n=this.decodeBinary(e,r+1);return this.extensionCodec.decode(n,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=$m(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Vf(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function Ym(t,e){return new Gm(e).decode(t)}const Zm=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Jm=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function Hr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Jm(t)}catch{return t}}function Wr(t){return typeof t=="string"?t:Zm(t)||""}function Xm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Gf(t,...e){if(!Xm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function yl(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Qm(t,e){Gf(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const ri=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Qs=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function e0(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Yf(t){return typeof t=="string"&&(t=e0(t)),Gf(t),t}let t0=class{clone(){return this._cloneInto()}};function r0(t){const e=i=>t().update(Yf(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Zf(t=32){if(ri&&typeof ri.getRandomValues=="function")return ri.getRandomValues(new Uint8Array(t));if(ri&&typeof ri.randomBytes=="function")return ri.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function i0(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}let n0=class extends t0{constructor(e,r,i,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Qs(this.buffer)}update(e){yl(this);const{view:r,buffer:i,blockLen:n}=this;e=Yf(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=Qs(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){yl(this),Qm(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(i,0),o=0);for(let h=o;h<n;h++)r[h]=0;i0(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=Qs(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=s,e.destroyed=o,n%r&&e.buffer.set(i),e}};const vn=BigInt(2**32-1),ta=BigInt(32);function Jf(t,e=!1){return e?{h:Number(t&vn),l:Number(t>>ta&vn)}:{h:Number(t>>ta&vn)|0,l:Number(t&vn)|0}}function s0(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=Jf(t[n],e);[r[n],i[n]]=[s,o]}return[r,i]}const o0=(t,e)=>BigInt(t>>>0)<<ta|BigInt(e>>>0),a0=(t,e,r)=>t>>>r,c0=(t,e,r)=>t<<32-r|e>>>r,l0=(t,e,r)=>t>>>r|e<<32-r,u0=(t,e,r)=>t<<32-r|e>>>r,h0=(t,e,r)=>t<<64-r|e>>>r-32,f0=(t,e,r)=>t>>>r-32|e<<64-r,d0=(t,e)=>e,p0=(t,e)=>t,g0=(t,e,r)=>t<<r|e>>>32-r,y0=(t,e,r)=>e<<r|t>>>32-r,w0=(t,e,r)=>e<<r-32|t>>>64-r,m0=(t,e,r)=>t<<r-32|e>>>64-r;function b0(t,e,r,i){const n=(e>>>0)+(i>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const v0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),E0=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,x0=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),_0=(t,e,r,i,n)=>e+r+i+n+(t/2**32|0)|0,I0=(t,e,r,i,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(n>>>0),S0=(t,e,r,i,n,s)=>e+r+i+n+s+(t/2**32|0)|0,Y={fromBig:Jf,split:s0,toBig:o0,shrSH:a0,shrSL:c0,rotrSH:l0,rotrSL:u0,rotrBH:h0,rotrBL:f0,rotr32H:d0,rotr32L:p0,rotlSH:g0,rotlSL:y0,rotlBH:w0,rotlBL:m0,add:b0,add3L:v0,add3H:E0,add4L:x0,add4H:_0,add5H:S0,add5L:I0},[$0,O0]=Y.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ar=new Uint32Array(80),cr=new Uint32Array(80);let D0=class extends n0{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:p,Gl:d,Hh:y,Hl:m}=this;return[e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m]}set(e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=y|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)ar[b]=e.getUint32(r),cr[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const E=ar[b-15]|0,D=cr[b-15]|0,C=Y.rotrSH(E,D,1)^Y.rotrSH(E,D,8)^Y.shrSH(E,D,7),T=Y.rotrSL(E,D,1)^Y.rotrSL(E,D,8)^Y.shrSL(E,D,7),R=ar[b-2]|0,A=cr[b-2]|0,k=Y.rotrSH(R,A,19)^Y.rotrBH(R,A,61)^Y.shrSH(R,A,6),U=Y.rotrSL(R,A,19)^Y.rotrBL(R,A,61)^Y.shrSL(R,A,6),B=Y.add4L(T,U,cr[b-7],cr[b-16]),$=Y.add4H(B,C,k,ar[b-7],ar[b-16]);ar[b]=$|0,cr[b]=B|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:p,Fl:d,Gh:y,Gl:m,Hh:v,Hl:I}=this;for(let b=0;b<80;b++){const E=Y.rotrSH(h,f,14)^Y.rotrSH(h,f,18)^Y.rotrBH(h,f,41),D=Y.rotrSL(h,f,14)^Y.rotrSL(h,f,18)^Y.rotrBL(h,f,41),C=h&p^~h&y,T=f&d^~f&m,R=Y.add5L(I,D,T,O0[b],cr[b]),A=Y.add5H(R,v,E,C,$0[b],ar[b]),k=R|0,U=Y.rotrSH(i,n,28)^Y.rotrBH(i,n,34)^Y.rotrBH(i,n,39),B=Y.rotrSL(i,n,28)^Y.rotrBL(i,n,34)^Y.rotrBL(i,n,39),$=i&s^i&a^s&a,P=n&o^n&c^o&c;v=y|0,I=m|0,y=p|0,m=d|0,p=h|0,d=f|0,{h,l:f}=Y.add(l|0,u|0,A|0,k|0),l=a|0,u=c|0,a=s|0,c=o|0,s=i|0,o=n|0;const g=Y.add3L(k,B,P);i=Y.add3H(g,A,U,$),n=g|0}({h:i,l:n}=Y.add(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=Y.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Y.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Y.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=Y.add(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=Y.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:y,l:m}=Y.add(this.Gh|0,this.Gl|0,y|0,m|0),{h:v,l:I}=Y.add(this.Hh|0,this.Hl|0,v|0,I|0),this.set(i,n,s,o,a,c,l,u,h,f,p,d,y,m,v,I)}roundClean(){ar.fill(0),cr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const A0=r0(()=>new D0);const ec=BigInt(0),Xf=BigInt(1),P0=BigInt(2);function tc(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function rc(t){if(!tc(t))throw new Error("Uint8Array expected")}function eo(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const C0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ic(t){rc(t);let e="";for(let r=0;r<t.length;r++)e+=C0[t[r]];return e}function Qf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ec:BigInt("0x"+t)}const Vt={_0:48,_9:57,A:65,F:70,a:97,f:102};function wl(t){if(t>=Vt._0&&t<=Vt._9)return t-Vt._0;if(t>=Vt.A&&t<=Vt.F)return t-(Vt.A-10);if(t>=Vt.a&&t<=Vt.f)return t-(Vt.a-10)}function ed(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=wl(t.charCodeAt(s)),a=wl(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function B0(t){return Qf(ic(t))}function Fn(t){return rc(t),Qf(ic(Uint8Array.from(t).reverse()))}function td(t,e){return ed(t.toString(16).padStart(e*2,"0"))}function ra(t,e){return td(t,e).reverse()}function Kt(t,e,r){let i;if(typeof e=="string")try{i=ed(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(tc(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function ml(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];rc(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}const to=t=>typeof t=="bigint"&&ec<=t;function T0(t,e,r){return to(t)&&to(e)&&to(r)&&e<=t&&t<r}function Ai(t,e,r,i){if(!T0(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function R0(t){let e;for(e=0;t>ec;t>>=Xf,e+=1);return e}const N0=t=>(P0<<BigInt(t-1))-Xf,U0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||tc(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function nc(t,e,r={}){const i=(n,s,o)=>{const a=U0[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}function bl(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}const Se=BigInt(0),he=BigInt(1),kr=BigInt(2),j0=BigInt(3),ia=BigInt(4),vl=BigInt(5),El=BigInt(8);function me(t,e){const r=t%e;return r>=Se?r:e+r}function k0(t,e,r){if(e<Se)throw new Error("invalid exponent, negatives unsupported");if(r<=Se)throw new Error("invalid modulus");if(r===he)return Se;let i=he;for(;e>Se;)e&he&&(i=i*t%r),t=t*t%r,e>>=he;return i}function Dt(t,e,r){let i=t;for(;e-- >Se;)i*=i,i%=r;return i}function xl(t,e){if(t===Se)throw new Error("invert: expected non-zero number");if(e<=Se)throw new Error("invert: expected positive modulus, got "+e);let r=me(t,e),i=e,n=Se,s=he;for(;r!==Se;){const o=i/r,a=i%r,c=n-s*o;i=r,r=a,n=s,s=c}if(i!==he)throw new Error("invert: does not exist");return me(n,e)}function F0(t){const e=(t-he)/kr;let r,i,n;for(r=t-he,i=0;r%kr===Se;r/=kr,i++);for(n=kr;n<t&&k0(n,e,t)!==t-he;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+he)/ia;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const s=(r+he)/kr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,l=o.pow(o.mul(o.ONE,n),r),u=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(h);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const p=o.pow(l,he<<BigInt(c-f-1));l=o.sqr(p),u=o.mul(u,p),h=o.mul(h,l),c=f}return u}}function q0(t){if(t%ia===j0){const e=(t+he)/ia;return function(r,i){const n=r.pow(i,e);if(!r.eql(r.sqr(n),i))throw new Error("Cannot find square root");return n}}if(t%El===vl){const e=(t-vl)/El;return function(r,i){const n=r.mul(i,kr),s=r.pow(n,e),o=r.mul(i,s),a=r.mul(r.mul(o,kr),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return F0(t)}const M0=(t,e)=>(me(t,e)&he)===he,L0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function z0(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=L0.reduce((i,n)=>(i[n]="function",i),e);return nc(t,r)}function V0(t,e,r){if(r<Se)throw new Error("invalid exponent, negatives unsupported");if(r===Se)return t.ONE;if(r===he)return e;let i=t.ONE,n=e;for(;r>Se;)r&he&&(i=t.mul(i,n)),n=t.sqr(n),r>>=he;return i}function K0(t,e){const r=new Array(e.length),i=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),n=t.inv(i);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),n),r}function rd(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function id(t,e,r=!1,i={}){if(t<=Se)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=rd(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:N0(n),ZERO:Se,ONE:he,create:c=>me(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Se<=c&&c<t},is0:c=>c===Se,isOdd:c=>(c&he)===he,neg:c=>me(-c,t),eql:(c,l)=>c===l,sqr:c=>me(c*c,t),add:(c,l)=>me(c+l,t),sub:(c,l)=>me(c-l,t),mul:(c,l)=>me(c*l,t),pow:(c,l)=>V0(a,c,l),div:(c,l)=>me(c*xl(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>xl(c,t),sqrt:i.sqrt||(c=>(o||(o=q0(t)),o(a,c))),invertBatch:c=>K0(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>r?ra(c,s):td(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Fn(c):B0(c)}});return Object.freeze(a)}const _l=BigInt(0),En=BigInt(1);function ro(t,e){const r=e.negate();return t?r:e}function nd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function io(t,e){nd(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function H0(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function W0(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const no=new WeakMap,sd=new WeakMap;function so(t){return sd.get(t)||1}function G0(t,e){return{constTimeNegate:ro,hasPrecomputes(r){return so(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>_l;)i&En&&(n=n.add(s)),s=s.double(),i>>=En;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=io(i,e),o=[];let a=r,c=a;for(let l=0;l<n;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,n){const{windows:s,windowSize:o}=io(r,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let f=0;f<s;f++){const p=f*o;let d=Number(n&l);n>>=h,d>o&&(d-=u,n+=En);const y=p,m=p+Math.abs(d)-1,v=f%2!==0,I=d<0;d===0?c=c.add(ro(v,i[y])):a=a.add(ro(I,i[m]))}return{p:a,f:c}},wNAFUnsafe(r,i,n,s=t.ZERO){const{windows:o,windowSize:a}=io(r,e),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(n===_l)break;let p=Number(n&c);if(n>>=u,p>a&&(p-=l,n+=En),p===0)continue;let d=i[f+Math.abs(p)-1];p<0&&(d=d.negate()),s=s.add(d)}return s},getPrecomputes(r,i,n){let s=no.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&no.set(i,n(s))),s},wNAFCached(r,i,n){const s=so(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=so(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){nd(i,e),sd.set(r,i),no.delete(r)}}}function Y0(t,e,r,i){if(H0(r,t),W0(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const n=t.ZERO,s=R0(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n),l=Math.floor((e.BITS-1)/o)*o;let u=n;for(let h=l;h>=0;h-=o){c.fill(n);for(let p=0;p<i.length;p++){const d=i[p],y=Number(d>>BigInt(h)&BigInt(a));c[y]=c[y].add(r[p])}let f=n;for(let p=c.length-1,d=n;p>0;p--)d=d.add(c[p]),f=f.add(d);if(u=u.add(f),h!==0)for(let p=0;p<o;p++)u=u.double()}return u}function Z0(t){return z0(t.Fp),nc(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...rd(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const mt=BigInt(0),Le=BigInt(1),xn=BigInt(2),J0=BigInt(8),X0={zip215:!0};function Q0(t){const e=Z0(t);return nc(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function eb(t){const e=Q0(t),{Fp:r,n:i,prehash:n,hash:s,randomBytes:o,nByteLength:a,h:c}=e,l=xn<<BigInt(a*8)-Le,u=r.create,h=id(e.n,e.nBitLength),f=e.uvRatio||((g,w)=>{try{return{isValid:!0,value:r.sqrt(g*r.inv(w))}}catch{return{isValid:!1,value:mt}}}),p=e.adjustScalarBytes||(g=>g),d=e.domain||((g,w,x)=>{if(eo("phflag",x),w.length||x)throw new Error("Contexts/pre-hash are not supported");return g});function y(g,w){Ai("coordinate "+g,w,mt,l)}function m(g){if(!(g instanceof b))throw new Error("ExtendedPoint expected")}const v=bl((g,w)=>{const{ex:x,ey:O,ez:_}=g,S=g.is0();w==null&&(w=S?J0:r.inv(_));const N=u(x*w),j=u(O*w),V=u(_*w);if(S)return{x:mt,y:Le};if(V!==Le)throw new Error("invZ was invalid");return{x:N,y:j}}),I=bl(g=>{const{a:w,d:x}=e;if(g.is0())throw new Error("bad point: ZERO");const{ex:O,ey:_,ez:S,et:N}=g,j=u(O*O),V=u(_*_),q=u(S*S),M=u(q*q),H=u(j*w),G=u(q*u(H+V)),Z=u(M+u(x*u(j*V)));if(G!==Z)throw new Error("bad point: equation left != right (1)");const W=u(O*_),J=u(S*N);if(W!==J)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(w,x,O,_){this.ex=w,this.ey=x,this.ez=O,this.et=_,y("x",w),y("y",x),y("z",O),y("t",_),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof b)throw new Error("extended point not allowed");const{x,y:O}=w||{};return y("x",x),y("y",O),new b(x,O,Le,u(x*O))}static normalizeZ(w){const x=r.invertBatch(w.map(O=>O.ez));return w.map((O,_)=>O.toAffine(x[_])).map(b.fromAffine)}static msm(w,x){return Y0(b,h,w,x)}_setWindowSize(w){C.setWindowSize(this,w)}assertValidity(){I(this)}equals(w){m(w);const{ex:x,ey:O,ez:_}=this,{ex:S,ey:N,ez:j}=w,V=u(x*j),q=u(S*_),M=u(O*j),H=u(N*_);return V===q&&M===H}is0(){return this.equals(b.ZERO)}negate(){return new b(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:w}=e,{ex:x,ey:O,ez:_}=this,S=u(x*x),N=u(O*O),j=u(xn*u(_*_)),V=u(w*S),q=x+O,M=u(u(q*q)-S-N),H=V+N,G=H-j,Z=V-N,W=u(M*G),J=u(H*Z),ue=u(M*Z),ye=u(G*H);return new b(W,J,ye,ue)}add(w){m(w);const{a:x,d:O}=e,{ex:_,ey:S,ez:N,et:j}=this,{ex:V,ey:q,ez:M,et:H}=w;if(x===BigInt(-1)){const Cc=u((S-_)*(q+V)),Bc=u((S+_)*(q-V)),Ns=u(Bc-Cc);if(Ns===mt)return this.double();const Tc=u(N*xn*H),Rc=u(j*xn*M),Nc=Rc+Tc,Uc=Bc+Cc,jc=Rc-Tc,Ng=u(Nc*Ns),Ug=u(Uc*jc),jg=u(Nc*jc),kg=u(Ns*Uc);return new b(Ng,Ug,kg,jg)}const G=u(_*V),Z=u(S*q),W=u(j*O*H),J=u(N*M),ue=u((_+S)*(V+q)-G-Z),ye=J-W,be=J+W,ke=u(Z-x*G),Ot=u(ue*ye),yn=u(be*ke),Tg=u(ue*ke),Rg=u(ye*be);return new b(Ot,yn,Rg,Tg)}subtract(w){return this.add(w.negate())}wNAF(w){return C.wNAFCached(this,w,b.normalizeZ)}multiply(w){const x=w;Ai("scalar",x,Le,i);const{p:O,f:_}=this.wNAF(x);return b.normalizeZ([O,_])[0]}multiplyUnsafe(w,x=b.ZERO){const O=w;return Ai("scalar",O,mt,i),O===mt?D:this.is0()||O===Le?this:C.wNAFCachedUnsafe(this,O,b.normalizeZ,x)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return C.unsafeLadder(this,i).is0()}toAffine(w){return v(this,w)}clearCofactor(){const{h:w}=e;return w===Le?this:this.multiplyUnsafe(w)}static fromHex(w,x=!1){const{d:O,a:_}=e,S=r.BYTES;w=Kt("pointHex",w,S),eo("zip215",x);const N=w.slice(),j=w[S-1];N[S-1]=j&-129;const V=Fn(N),q=x?l:r.ORDER;Ai("pointHex.y",V,mt,q);const M=u(V*V),H=u(M-Le),G=u(O*M-_);let{isValid:Z,value:W}=f(H,G);if(!Z)throw new Error("Point.fromHex: invalid y coordinate");const J=(W&Le)===Le,ue=(j&128)!==0;if(!x&&W===mt&&ue)throw new Error("Point.fromHex: x=0 and x_0=1");return ue!==J&&(W=u(-W)),b.fromAffine({x:W,y:V})}static fromPrivateKey(w){return A(w).point}toRawBytes(){const{x:w,y:x}=this.toAffine(),O=ra(x,r.BYTES);return O[O.length-1]|=w&Le?128:0,O}toHex(){return ic(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,Le,u(e.Gx*e.Gy)),b.ZERO=new b(mt,Le,Le,mt);const{BASE:E,ZERO:D}=b,C=G0(b,a*8);function T(g){return me(g,i)}function R(g){return T(Fn(g))}function A(g){const w=r.BYTES;g=Kt("private key",g,w);const x=Kt("hashed private key",s(g),2*w),O=p(x.slice(0,w)),_=x.slice(w,2*w),S=R(O),N=E.multiply(S),j=N.toRawBytes();return{head:O,prefix:_,scalar:S,point:N,pointBytes:j}}function k(g){return A(g).pointBytes}function U(g=new Uint8Array,...w){const x=ml(...w);return R(s(d(x,Kt("context",g),!!n)))}function B(g,w,x={}){g=Kt("message",g),n&&(g=n(g));const{prefix:O,scalar:_,pointBytes:S}=A(w),N=U(x.context,O,g),j=E.multiply(N).toRawBytes(),V=U(x.context,j,S,g),q=T(N+V*_);Ai("signature.s",q,mt,i);const M=ml(j,ra(q,r.BYTES));return Kt("result",M,r.BYTES*2)}const $=X0;function P(g,w,x,O=$){const{context:_,zip215:S}=O,N=r.BYTES;g=Kt("signature",g,2*N),w=Kt("message",w),x=Kt("publicKey",x,N),S!==void 0&&eo("zip215",S),n&&(w=n(w));const j=Fn(g.slice(N,2*N));let V,q,M;try{V=b.fromHex(x,S),q=b.fromHex(g.slice(0,N),S),M=E.multiplyUnsafe(j)}catch{return!1}if(!S&&V.isSmallOrder())return!1;const H=U(_,q.toRawBytes(),V.toRawBytes(),w);return q.add(V.multiplyUnsafe(H)).subtract(M).clearCofactor().equals(b.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:k,sign:B,verify:P,ExtendedPoint:b,utils:{getExtendedPublicKey:A,randomPrivateKey:()=>o(r.BYTES),precompute(g=8,w=b.BASE){return w._setWindowSize(g),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const sc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Il=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const tb=BigInt(1),Sl=BigInt(2);BigInt(3);const rb=BigInt(5),ib=BigInt(8);function nb(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=sc,o=t*t%s*t%s,a=Dt(o,Sl,s)*o%s,c=Dt(a,tb,s)*t%s,l=Dt(c,rb,s)*c%s,u=Dt(l,e,s)*l%s,h=Dt(u,r,s)*u%s,f=Dt(h,i,s)*h%s,p=Dt(f,n,s)*f%s,d=Dt(p,n,s)*f%s,y=Dt(d,e,s)*l%s;return{pow_p_5_8:Dt(y,Sl,s)*t%s,b2:o}}function sb(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function ob(t,e){const r=sc,i=me(e*e*e,r),n=me(i*i*e,r),s=nb(t*n).pow_p_5_8;let o=me(t*i*s,r);const a=me(e*o*o,r),c=o,l=me(o*Il,r),u=a===t,h=a===me(-t,r),f=a===me(-t*Il,r);return u&&(o=c),(h||f)&&(o=l),M0(o,r)&&(o=me(-o,r)),{isValid:u||h,value:o}}const ab=id(sc,void 0,!0),cb={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:ab,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:ib,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:A0,randomBytes:Zf,adjustScalarBytes:sb,uvRatio:ob},od=eb(cb),lb="EdDSA",ub="JWT",Xn=".",gs="base64url",ad="utf8",cd="utf8",hb=":",fb="did",db="key",$l="base58btc",pb="z",gb="K36",yb=32;function oc(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function ld(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?oc(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ud(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=ld(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return oc(r)}function wb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var y=0,m=0,v=0,I=d.length;v!==I&&d[v]===0;)v++,y++;for(var b=(I-v)*u+1>>>0,E=new Uint8Array(b);v!==I;){for(var D=d[v],C=0,T=b-1;(D!==0||C<m)&&T!==-1;T--,C++)D+=256*E[T]>>>0,E[T]=D%a>>>0,D=D/a>>>0;if(D!==0)throw new Error("Non-zero carry");m=C,v++}for(var R=b-m;R!==b&&E[R]===0;)R++;for(var A=c.repeat(y);R<b;++R)A+=t.charAt(E[R]);return A}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var y=0;if(d[y]!==" "){for(var m=0,v=0;d[y]===c;)m++,y++;for(var I=(d.length-y)*l+1>>>0,b=new Uint8Array(I);d[y];){var E=r[d.charCodeAt(y)];if(E===255)return;for(var D=0,C=I-1;(E!==0||D<v)&&C!==-1;C--,D++)E+=a*b[C]>>>0,b[C]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");v=D,y++}if(d[y]!==" "){for(var T=I-v;T!==I&&b[T]===0;)T++;for(var R=new Uint8Array(m+(I-T)),A=m;T!==I;)R[A++]=b[T++];return R}}}function p(d){var y=f(d);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var mb=wb,bb=mb;const hd=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},vb=t=>new TextEncoder().encode(t),Eb=t=>new TextDecoder().decode(t);let xb=class{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},_b=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return fd(this,e)}},Ib=class{constructor(e){this.decoders=e}or(e){return fd(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const fd=(t,e)=>new Ib({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let Sb=class{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new xb(e,r,i),this.decoder=new _b(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const ys=({name:t,prefix:e,encode:r,decode:i})=>new Sb(t,e,r,i),an=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=bb(r,e);return ys({prefix:t,name:e,encode:i,decode:s=>hd(n(s))})},$b=(t,e,r,i)=>{const n={};for(let u=0;u<e.length;++u)n[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=n[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Ob=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Pe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ys({prefix:e,name:t,encode(n){return Ob(n,i,r)},decode(n){return $b(n,i,r,t)}}),Db=ys({prefix:"\0",name:"identity",encode:t=>Eb(t),decode:t=>vb(t)});var Ab=Object.freeze({__proto__:null,identity:Db});const Pb=Pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Cb=Object.freeze({__proto__:null,base2:Pb});const Bb=Pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Tb=Object.freeze({__proto__:null,base8:Bb});const Rb=an({prefix:"9",name:"base10",alphabet:"0123456789"});var Nb=Object.freeze({__proto__:null,base10:Rb});const Ub=Pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),jb=Pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var kb=Object.freeze({__proto__:null,base16:Ub,base16upper:jb});const Fb=Pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),qb=Pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Mb=Pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Lb=Pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),zb=Pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Vb=Pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Kb=Pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Hb=Pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Wb=Pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Gb=Object.freeze({__proto__:null,base32:Fb,base32upper:qb,base32pad:Mb,base32padupper:Lb,base32hex:zb,base32hexupper:Vb,base32hexpad:Kb,base32hexpadupper:Hb,base32z:Wb});const Yb=an({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Zb=an({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Jb=Object.freeze({__proto__:null,base36:Yb,base36upper:Zb});const Xb=an({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Qb=an({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var e1=Object.freeze({__proto__:null,base58btc:Xb,base58flickr:Qb});const t1=Pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),r1=Pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),i1=Pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),n1=Pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var s1=Object.freeze({__proto__:null,base64:t1,base64pad:r1,base64url:i1,base64urlpad:n1});const dd=Array.from(""),o1=dd.reduce((t,e,r)=>(t[r]=e,t),[]),a1=dd.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function c1(t){return t.reduce((e,r)=>(e+=o1[r],e),"")}function l1(t){const e=[];for(const r of t){const i=a1[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const u1=ys({prefix:"",name:"base256emoji",encode:c1,decode:l1});var h1=Object.freeze({__proto__:null,base256emoji:u1}),f1=pd,Ol=128,d1=-128,p1=Math.pow(2,31);function pd(t,e,r){e=e||[],r=r||0;for(var i=r;t>=p1;)e[r++]=t&255|Ol,t/=128;for(;t&d1;)e[r++]=t&255|Ol,t>>>=7;return e[r]=t|0,pd.bytes=r-i+1,e}var g1=na,y1=128,Dl=127;function na(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw na.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&Dl)<<n:(o&Dl)*Math.pow(2,n),n+=7}while(o>=y1);return na.bytes=s-i,r}var w1=Math.pow(2,7),m1=Math.pow(2,14),b1=Math.pow(2,21),v1=Math.pow(2,28),E1=Math.pow(2,35),x1=Math.pow(2,42),_1=Math.pow(2,49),I1=Math.pow(2,56),S1=Math.pow(2,63),$1=function(t){return t<w1?1:t<m1?2:t<b1?3:t<v1?4:t<E1?5:t<x1?6:t<_1?7:t<I1?8:t<S1?9:10},O1={encode:f1,decode:g1,encodingLength:$1},gd=O1;const Al=(t,e,r=0)=>(gd.encode(t,e,r),e),Pl=t=>gd.encodingLength(t),sa=(t,e)=>{const r=e.byteLength,i=Pl(t),n=i+Pl(r),s=new Uint8Array(n+r);return Al(t,s,0),Al(r,s,i),s.set(e,n),new D1(t,r,e,s)};let D1=class{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}};const yd=({name:t,code:e,encode:r})=>new A1(t,e,r);let A1=class{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?sa(this.code,r):r.then(i=>sa(this.code,i))}else throw Error("Unknown type, must be binary type")}};const wd=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),P1=yd({name:"sha2-256",code:18,encode:wd("SHA-256")}),C1=yd({name:"sha2-512",code:19,encode:wd("SHA-512")});var B1=Object.freeze({__proto__:null,sha256:P1,sha512:C1});const md=0,T1="identity",bd=hd,R1=t=>sa(md,bd(t)),N1={code:md,name:T1,encode:bd,digest:R1};var U1=Object.freeze({__proto__:null,identity:N1});new TextEncoder,new TextDecoder;const Cl={...Ab,...Cb,...Tb,...Nb,...kb,...Gb,...Jb,...e1,...s1,...h1};({...B1,...U1});function vd(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Bl=vd("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),oo=vd("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=ld(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Ed={utf8:Bl,"utf-8":Bl,hex:Cl.base16,latin1:oo,ascii:oo,binary:oo,...Cl};function ws(t,e="utf8"){const r=Ed[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Ei(t,e="utf8"){const r=Ed[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?oc(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Tl(t){return Hr(ws(Ei(t,gs),ad))}function Qn(t){return ws(Ei(Wr(t),ad),gs)}function xd(t){const e=Ei(gb,$l),r=pb+ws(ud([e,t]),$l);return[fb,db,r].join(hb)}function j1(t){return ws(t,gs)}function k1(t){return Ei(t,gs)}function F1(t){return Ei([Qn(t.header),Qn(t.payload)].join(Xn),cd)}function q1(t){return[Qn(t.header),Qn(t.payload),j1(t.signature)].join(Xn)}function oa(t){const e=t.split(Xn),r=Tl(e[0]),i=Tl(e[1]),n=k1(e[2]),s=Ei(e.slice(0,2).join(Xn),cd);return{header:r,payload:i,signature:n,data:s}}function Rl(t=Zf(yb)){const e=od.getPublicKey(t);return{secretKey:ud([t,e]),publicKey:e}}async function M1(t,e,r,i,n=L.fromMiliseconds(Date.now())){const s={alg:lb,typ:ub},o=xd(i.publicKey),a=n+r,c={iss:o,sub:t,aud:e,iat:n,exp:a},l=F1({header:s,payload:c}),u=od.sign(l,i.secretKey.slice(0,32));return q1({header:s,payload:c,signature:u})}function ac(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function _d(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ac(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function zi(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=_d(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return ac(r)}function L1(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var y=0,m=0,v=0,I=d.length;v!==I&&d[v]===0;)v++,y++;for(var b=(I-v)*u+1>>>0,E=new Uint8Array(b);v!==I;){for(var D=d[v],C=0,T=b-1;(D!==0||C<m)&&T!==-1;T--,C++)D+=256*E[T]>>>0,E[T]=D%a>>>0,D=D/a>>>0;if(D!==0)throw new Error("Non-zero carry");m=C,v++}for(var R=b-m;R!==b&&E[R]===0;)R++;for(var A=c.repeat(y);R<b;++R)A+=t.charAt(E[R]);return A}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var y=0;if(d[y]!==" "){for(var m=0,v=0;d[y]===c;)m++,y++;for(var I=(d.length-y)*l+1>>>0,b=new Uint8Array(I);d[y];){var E=r[d.charCodeAt(y)];if(E===255)return;for(var D=0,C=I-1;(E!==0||D<v)&&C!==-1;C--,D++)E+=a*b[C]>>>0,b[C]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");v=D,y++}if(d[y]!==" "){for(var T=I-v;T!==I&&b[T]===0;)T++;for(var R=new Uint8Array(m+(I-T)),A=m;T!==I;)R[A++]=b[T++];return R}}}function p(d){var y=f(d);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var z1=L1,V1=z1;const K1=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},H1=t=>new TextEncoder().encode(t),W1=t=>new TextDecoder().decode(t);class G1{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Y1{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Id(this,e)}}class Z1{constructor(e){this.decoders=e}or(e){return Id(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Id=(t,e)=>new Z1({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class J1{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new G1(e,r,i),this.decoder=new Y1(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ms=({name:t,prefix:e,encode:r,decode:i})=>new J1(t,e,r,i),cn=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=V1(r,e);return ms({prefix:t,name:e,encode:i,decode:s=>K1(n(s))})},X1=(t,e,r,i)=>{const n={};for(let u=0;u<e.length;++u)n[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=n[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Q1=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Ce=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ms({prefix:e,name:t,encode(n){return Q1(n,i,r)},decode(n){return X1(n,i,r,t)}}),ev=ms({prefix:"\0",name:"identity",encode:t=>W1(t),decode:t=>H1(t)}),tv=Object.freeze(Object.defineProperty({__proto__:null,identity:ev},Symbol.toStringTag,{value:"Module"})),rv=Ce({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),iv=Object.freeze(Object.defineProperty({__proto__:null,base2:rv},Symbol.toStringTag,{value:"Module"})),nv=Ce({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),sv=Object.freeze(Object.defineProperty({__proto__:null,base8:nv},Symbol.toStringTag,{value:"Module"})),ov=cn({prefix:"9",name:"base10",alphabet:"0123456789"}),av=Object.freeze(Object.defineProperty({__proto__:null,base10:ov},Symbol.toStringTag,{value:"Module"})),cv=Ce({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),lv=Ce({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),uv=Object.freeze(Object.defineProperty({__proto__:null,base16:cv,base16upper:lv},Symbol.toStringTag,{value:"Module"})),hv=Ce({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),fv=Ce({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),dv=Ce({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),pv=Ce({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),gv=Ce({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),yv=Ce({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),wv=Ce({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),mv=Ce({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),bv=Ce({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),vv=Object.freeze(Object.defineProperty({__proto__:null,base32:hv,base32hex:gv,base32hexpad:wv,base32hexpadupper:mv,base32hexupper:yv,base32pad:dv,base32padupper:pv,base32upper:fv,base32z:bv},Symbol.toStringTag,{value:"Module"})),Ev=cn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),xv=cn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),_v=Object.freeze(Object.defineProperty({__proto__:null,base36:Ev,base36upper:xv},Symbol.toStringTag,{value:"Module"})),Iv=cn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Sv=cn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),$v=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Iv,base58flickr:Sv},Symbol.toStringTag,{value:"Module"})),Ov=Ce({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Dv=Ce({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Av=Ce({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Pv=Ce({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Cv=Object.freeze(Object.defineProperty({__proto__:null,base64:Ov,base64pad:Dv,base64url:Av,base64urlpad:Pv},Symbol.toStringTag,{value:"Module"})),Sd=Array.from(""),Bv=Sd.reduce((t,e,r)=>(t[r]=e,t),[]),Tv=Sd.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Rv(t){return t.reduce((e,r)=>(e+=Bv[r],e),"")}function Nv(t){const e=[];for(const r of t){const i=Tv[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Uv=ms({prefix:"",name:"base256emoji",encode:Rv,decode:Nv}),jv=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Uv},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Nl={...tv,...iv,...sv,...av,...uv,...vv,..._v,...$v,...Cv,...jv};function $d(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Ul=$d("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ao=$d("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=_d(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Od={utf8:Ul,"utf-8":Ul,hex:Nl.base16,latin1:ao,ascii:ao,binary:ao,...Nl};function gt(t,e="utf8"){const r=Od[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ac(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Je(t,e="utf8"){const r=Od[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const kv={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var co,jl;function Dd(){if(jl)return co;jl=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function r(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function i(o){return(4294967296+o).toString(16).substring(1)}function n(o,a,c){let l=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)l+=i(a[u]).toUpperCase(),l+=" ",l+=i(a[u+1]).toUpperCase();else if(c===64)l+=i(a[u+1]).toUpperCase(),l+=i(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?l+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(l+=" ")}console.log(l)}function s(o,a,c){let l=new Date().getTime();const u=new Uint8Array(a);for(let f=0;f<a;f++)u[f]=f%256;const h=new Date().getTime();console.log("Generated random input in "+(h-l)+"ms"),l=h;for(let f=0;f<c;f++){const p=o(u),d=new Date().getTime(),y=d-l;l=d,console.log("Hashed in "+y+"ms: "+p.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(y/1e3)*100)/100+" MB PER SECOND")}}return co={normalizeInput:e,toHex:r,debugPrint:n,testSpeed:s},co}var lo,kl;function Fv(){if(kl)return lo;kl=1;const t=Dd();function e(v,I,b){const E=v[I]+v[b];let D=v[I+1]+v[b+1];E>=4294967296&&D++,v[I]=E,v[I+1]=D}function r(v,I,b,E){let D=v[I]+b;b<0&&(D+=4294967296);let C=v[I+1]+E;D>=4294967296&&C++,v[I]=D,v[I+1]=C}function i(v,I){return v[I]^v[I+1]<<8^v[I+2]<<16^v[I+3]<<24}function n(v,I,b,E,D,C){const T=l[D],R=l[D+1],A=l[C],k=l[C+1];e(c,v,I),r(c,v,T,R);let U=c[E]^c[v],B=c[E+1]^c[v+1];c[E]=B,c[E+1]=U,e(c,b,E),U=c[I]^c[b],B=c[I+1]^c[b+1],c[I]=U>>>24^B<<8,c[I+1]=B>>>24^U<<8,e(c,v,I),r(c,v,A,k),U=c[E]^c[v],B=c[E+1]^c[v+1],c[E]=U>>>16^B<<16,c[E+1]=B>>>16^U<<16,e(c,b,E),U=c[I]^c[b],B=c[I+1]^c[b+1],c[I]=B>>>31^U<<1,c[I+1]=U>>>31^B<<1}const s=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(v){return v*2})),c=new Uint32Array(32),l=new Uint32Array(32);function u(v,I){let b=0;for(b=0;b<16;b++)c[b]=v.h[b],c[b+16]=s[b];for(c[24]=c[24]^v.t,c[25]=c[25]^v.t/4294967296,I&&(c[28]=~c[28],c[29]=~c[29]),b=0;b<32;b++)l[b]=i(v.b,4*b);for(b=0;b<12;b++)n(0,8,16,24,a[b*16+0],a[b*16+1]),n(2,10,18,26,a[b*16+2],a[b*16+3]),n(4,12,20,28,a[b*16+4],a[b*16+5]),n(6,14,22,30,a[b*16+6],a[b*16+7]),n(0,10,20,30,a[b*16+8],a[b*16+9]),n(2,12,22,24,a[b*16+10],a[b*16+11]),n(4,14,16,26,a[b*16+12],a[b*16+13]),n(6,8,18,28,a[b*16+14],a[b*16+15]);for(b=0;b<16;b++)v.h[b]=v.h[b]^c[b]^c[b+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function f(v,I,b,E){if(v===0||v>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(I&&I.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(b&&b.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(E&&E.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const D={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:v};h.fill(0),h[0]=v,I&&(h[1]=I.length),h[2]=1,h[3]=1,b&&h.set(b,32),E&&h.set(E,48);for(let C=0;C<16;C++)D.h[C]=s[C]^i(h,C*4);return I&&(p(D,I),D.c=128),D}function p(v,I){for(let b=0;b<I.length;b++)v.c===128&&(v.t+=v.c,u(v,!1),v.c=0),v.b[v.c++]=I[b]}function d(v){for(v.t+=v.c;v.c<128;)v.b[v.c++]=0;u(v,!0);const I=new Uint8Array(v.outlen);for(let b=0;b<v.outlen;b++)I[b]=v.h[b>>2]>>8*(b&3);return I}function y(v,I,b,E,D){b=b||64,v=t.normalizeInput(v),E&&(E=t.normalizeInput(E)),D&&(D=t.normalizeInput(D));const C=f(b,I,E,D);return p(C,v),d(C)}function m(v,I,b,E,D){const C=y(v,I,b,E,D);return t.toHex(C)}return lo={blake2b:y,blake2bHex:m,blake2bInit:f,blake2bUpdate:p,blake2bFinal:d},lo}var uo,Fl;function qv(){if(Fl)return uo;Fl=1;const t=Dd();function e(d,y){return d[y]^d[y+1]<<8^d[y+2]<<16^d[y+3]<<24}function r(d,y,m,v,I,b){o[d]=o[d]+o[y]+I,o[v]=i(o[v]^o[d],16),o[m]=o[m]+o[v],o[y]=i(o[y]^o[m],12),o[d]=o[d]+o[y]+b,o[v]=i(o[v]^o[d],8),o[m]=o[m]+o[v],o[y]=i(o[y]^o[m],7)}function i(d,y){return d>>>y^d<<32-y}const n=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),s=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(d,y){let m=0;for(m=0;m<8;m++)o[m]=d.h[m],o[m+8]=n[m];for(o[12]^=d.t,o[13]^=d.t/4294967296,y&&(o[14]=~o[14]),m=0;m<16;m++)a[m]=e(d.b,4*m);for(m=0;m<10;m++)r(0,4,8,12,a[s[m*16+0]],a[s[m*16+1]]),r(1,5,9,13,a[s[m*16+2]],a[s[m*16+3]]),r(2,6,10,14,a[s[m*16+4]],a[s[m*16+5]]),r(3,7,11,15,a[s[m*16+6]],a[s[m*16+7]]),r(0,5,10,15,a[s[m*16+8]],a[s[m*16+9]]),r(1,6,11,12,a[s[m*16+10]],a[s[m*16+11]]),r(2,7,8,13,a[s[m*16+12]],a[s[m*16+13]]),r(3,4,9,14,a[s[m*16+14]],a[s[m*16+15]]);for(m=0;m<8;m++)d.h[m]^=o[m]^o[m+8]}function l(d,y){if(!(d>0&&d<=32))throw new Error("Incorrect output length, should be in [1, 32]");const m=y?y.length:0;if(y&&!(m>0&&m<=32))throw new Error("Incorrect key length, should be in [1, 32]");const v={h:new Uint32Array(n),b:new Uint8Array(64),c:0,t:0,outlen:d};return v.h[0]^=16842752^m<<8^d,m>0&&(u(v,y),v.c=64),v}function u(d,y){for(let m=0;m<y.length;m++)d.c===64&&(d.t+=d.c,c(d,!1),d.c=0),d.b[d.c++]=y[m]}function h(d){for(d.t+=d.c;d.c<64;)d.b[d.c++]=0;c(d,!0);const y=new Uint8Array(d.outlen);for(let m=0;m<d.outlen;m++)y[m]=d.h[m>>2]>>8*(m&3)&255;return y}function f(d,y,m){m=m||32,d=t.normalizeInput(d);const v=l(m,y);return u(v,d),h(v)}function p(d,y,m){const v=f(d,y,m);return t.toHex(v)}return uo={blake2s:f,blake2sHex:p,blake2sInit:l,blake2sUpdate:u,blake2sFinal:h},uo}var ho,ql;function Mv(){if(ql)return ho;ql=1;const t=Fv(),e=qv();return ho={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},ho}var Lv=Mv(),jt={exports:{}};function zv(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Vv=Kv;function Kv(t,e,r){var i=r&&r.stringify||zv,n=1;if(typeof t=="object"&&t!==null){var s=e.length+n;if(s===1)return t;var o=new Array(s);o[0]=i(t);for(var a=1;a<s;a++)o[a]=i(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var l="",u=1-n,h=-1,f=t&&t.length||0,p=0;p<f;){if(t.charCodeAt(p)===37&&p+1<f){switch(h=h>-1?h:0,t.charCodeAt(p+1)){case 100:case 102:if(u>=c||e[u]==null)break;h<p&&(l+=t.slice(h,p)),l+=Number(e[u]),h=p+2,p++;break;case 105:if(u>=c||e[u]==null)break;h<p&&(l+=t.slice(h,p)),l+=Math.floor(Number(e[u])),h=p+2,p++;break;case 79:case 111:case 106:if(u>=c||e[u]===void 0)break;h<p&&(l+=t.slice(h,p));var d=typeof e[u];if(d==="string"){l+="'"+e[u]+"'",h=p+2,p++;break}if(d==="function"){l+=e[u].name||"<anonymous>",h=p+2,p++;break}l+=i(e[u]),h=p+2,p++;break;case 115:if(u>=c)break;h<p&&(l+=t.slice(h,p)),l+=String(e[u]),h=p+2,p++;break;case 37:h<p&&(l+=t.slice(h,p)),l+="%",h=p+2,p++,u--;break}++u}++p}return h===-1?t:(h<f&&(l+=t.slice(h)),l)}const Ml=Vv;jt.exports=rr;const Ji=oE().console||{},Hv={mapHttpRequest:_n,mapHttpResponse:_n,wrapRequestSerializer:fo,wrapResponseSerializer:fo,wrapErrorSerializer:fo,req:_n,res:_n,err:zl,errWithCause:zl};function Er(t,e){return t==="silent"?1/0:e.levels.values[t]}const cc=Symbol("pino.logFuncs"),aa=Symbol("pino.hierarchy"),Wv={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function Ll(t,e){const r={logger:e,parent:t[aa]};e[aa]=r}function Gv(t,e,r){const i={};e.forEach(n=>{i[n]=r[n]?r[n]:Ji[n]||Ji[Wv[n]||"log"]||pi}),t[cc]=i}function Yv(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function rr(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Ji;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},n=Yv(t.browser.serialize,i);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(y){r[y]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",l=Object.create(r);l.log||(l.log=pi),Gv(l,a,r),Ll({},l),Object.defineProperty(l,"levelVal",{get:h}),Object.defineProperty(l,"level",{get:f,set:p});const u={transmit:e,serialize:n,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:iE(t),messageKey:t.messageKey||"msg",onChild:t.onChild||pi};l.levels=Zv(t),l.level=c,l.isLevelEnabled=function(y){return this.levels.values[y]?this.levels.values[y]>=this.levels.values[this.level]:!1},l.setMaxListeners=l.getMaxListeners=l.emit=l.addListener=l.on=l.prependListener=l.once=l.prependOnceListener=l.removeListener=l.removeAllListeners=l.listeners=l.listenerCount=l.eventNames=l.write=l.flush=pi,l.serializers=i,l._serialize=n,l._stdErrSerialize=s,l.child=function(...y){return d.call(this,u,...y)},e&&(l._logEvent=ca());function h(){return Er(this.level,this)}function f(){return this._level}function p(y){if(y!=="silent"&&!this.levels.values[y])throw Error("unknown level "+y);this._level=y,Br(this,u,l,"error"),Br(this,u,l,"fatal"),Br(this,u,l,"warn"),Br(this,u,l,"info"),Br(this,u,l,"debug"),Br(this,u,l,"trace"),o.forEach(m=>{Br(this,u,l,m)})}function d(y,m,v){if(!m)throw new Error("missing bindings for child Pino");v=v||{},n&&m.serializers&&(v.serializers=m.serializers);const I=v.serializers;if(n&&I){var b=Object.assign({},i,I),E=t.browser.serialize===!0?Object.keys(b):n;delete m.serializers,lc([m],E,b,this._stdErrSerialize)}function D(T){this._childLevel=(T._childLevel|0)+1,this.bindings=m,b&&(this.serializers=b,this._serialize=E),e&&(this._logEvent=ca([].concat(T._logEvent.bindings,m)))}D.prototype=this;const C=new D(this);return Ll(this,C),C.child=function(...T){return d.call(this,y,...T)},C.level=v.level||this.level,y.onChild(C),C}return l}function Zv(t){const e=t.customLevels||{},r=Object.assign({},rr.levels.values,e),i=Object.assign({},rr.levels.labels,Jv(e));return{values:r,labels:i}}function Jv(t){const e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}rr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},rr.stdSerializers=Hv,rr.stdTimeFunctions=Object.assign({},{nullTime:Ad,epochTime:Pd,unixTime:nE,isoTime:sE});function Xv(t){const e=[];t.bindings&&e.push(t.bindings);let r=t[aa];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function Br(t,e,r,i){if(Object.defineProperty(t,i,{value:Er(t.level,r)>Er(i,r)?pi:r[cc][i],writable:!0,enumerable:!0,configurable:!0}),t[i]===pi){if(!e.transmit)return;const s=e.transmit.level||t.level,o=Er(s,r);if(Er(i,r)<o)return}t[i]=eE(t,e,r,i);const n=Xv(t);n.length!==0&&(t[i]=Qv(n,t[i]))}function Qv(t,e){return function(){return e.apply(this,[...t,...arguments])}}function eE(t,e,r,i){return(function(n){return function(){const s=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Ji?Ji:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var l=!1;if(e.serialize&&(lc(o,this._serialize,this.serializers,this._stdErrSerialize),l=!0),e.asObject||e.formatters?n.call(a,...tE(this,i,o,s,e)):n.apply(a,o),e.transmit){const u=e.transmit.level||t._level,h=Er(u,r),f=Er(i,r);if(f<h)return;rE(this,{ts:s,methodLevel:i,methodValue:f,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:Er(t._level,r)},o,l)}}})(t[cc][i])}function tE(t,e,r,i,n){const{level:s,log:o=h=>h}=n.formatters||{},a=r.slice();let c=a[0];const l={};let u=(t._childLevel|0)+1;if(u<1&&(u=1),i&&(l.time=i),s){const h=s(e,t.levels.values[e]);Object.assign(l,h)}else l.level=t.levels.values[e];if(n.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;u--&&typeof a[0]=="object";)Object.assign(l,a.shift());return[o(l),...a]}else{if(c!==null&&typeof c=="object"){for(;u--&&typeof a[0]=="object";)Object.assign(l,a.shift());c=a.length?Ml(a.shift(),a):void 0}else typeof c=="string"&&(c=Ml(a.shift(),a));return c!==void 0&&(l[n.messageKey]=c),[o(l)]}}function lc(t,e,r,i){for(const n in t)if(i&&t[n]instanceof Error)t[n]=rr.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n])&&e)for(const s in t[n])e.indexOf(s)>-1&&s in r&&(t[n][s]=r[s](t[n][s]))}function rE(t,e,r,i=!1){const n=e.send,s=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,l=t._logEvent.bindings;i||lc(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(u){return l.indexOf(u)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,n(o,t._logEvent,c),t._logEvent=ca(l)}function ca(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function zl(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function iE(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Ad:Pd}function _n(){return{}}function fo(t){return t}function pi(){}function Ad(){return!1}function Pd(){return Date.now()}function nE(){return Math.round(Date.now()/1e3)}function sE(){return new Date(Date.now()).toISOString()}function oE(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}jt.exports.default=rr;jt.exports.pino=rr;const aE={level:"info"},bs="custom_context",uc=1e3*1024;var cE=Object.defineProperty,lE=(t,e,r)=>e in t?cE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mr=(t,e,r)=>lE(t,typeof e!="symbol"?e+"":e,r);let uE=class{constructor(e){mr(this,"nodeValue"),mr(this,"sizeInBytes"),mr(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Vl=class{constructor(e){mr(this,"lengthInNodes"),mr(this,"sizeInBytes"),mr(this,"head"),mr(this,"tail"),mr(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new uE(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};const hE=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r);function Kl(t){return typeof t=="string"?t:hE(t)||""}var fE=Object.defineProperty,dE=(t,e,r)=>e in t?fE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,In=(t,e,r)=>dE(t,typeof e!="symbol"?e+"":e,r);let Cd=class{constructor(e,r=uc){In(this,"logs"),In(this,"level"),In(this,"levelValue"),In(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=jt.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Vl(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===jt.exports.levels.values.error?console.error(e):r===jt.exports.levels.values.warn?console.warn(e):r===jt.exports.levels.values.debug?console.debug(e):r===jt.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Kl({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Vl(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Kl({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var pE=Object.defineProperty,gE=(t,e,r)=>e in t?pE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yE=(t,e,r)=>gE(t,e+"",r);let wE=class{constructor(e,r=uc){yE(this,"baseChunkLogger"),this.baseChunkLogger=new Cd(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}};var mE=Object.defineProperty,bE=(t,e,r)=>e in t?mE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vE=(t,e,r)=>bE(t,e+"",r);let EE=class{constructor(e,r=uc){vE(this,"baseChunkLogger"),this.baseChunkLogger=new Cd(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var xE=Object.defineProperty,_E=Object.defineProperties,IE=Object.getOwnPropertyDescriptors,Hl=Object.getOwnPropertySymbols,SE=Object.prototype.hasOwnProperty,$E=Object.prototype.propertyIsEnumerable,Wl=(t,e,r)=>e in t?xE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_r=(t,e)=>{for(var r in e||(e={}))SE.call(e,r)&&Wl(t,r,e[r]);if(Hl)for(var r of Hl(e))$E.call(e,r)&&Wl(t,r,e[r]);return t},Ir=(t,e)=>_E(t,IE(e));function OE(t){return Ir(_r({},t),{level:t?.level||aE.level})}function DE(t,e,r=bs){return t[r]=e,t}function Xe(t,e=bs){return t[e]||""}function AE(t,e,r=bs){const i=Xe(t,r);return i.trim()?`${i}/${e}`:e}function at(t,e,r=bs){const i=AE(t,e,r),n=t.child({context:i});return DE(n,i,r)}function PE(t){var e,r;const i=new wE((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:jt.exports(Ir(_r({},t.opts),{level:"trace",browser:Ir(_r({},(r=t.opts)==null?void 0:r.browser),{write:n=>i.write(n)})})),chunkLoggerController:i}}function CE(t){var e,r;const i=new EE((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:jt.exports(Ir(_r({},t.opts),{level:"trace",browser:Ir(_r({},(r=t.opts)==null?void 0:r.browser),{write:n=>i.write(n)})}),i),chunkLoggerController:i}}function Bd(t){var e;if(typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string")return{logger:t.loggerOverride,chunkLoggerController:null};const r=Ir(_r({},t.opts),{level:typeof t.loggerOverride=="string"?t.loggerOverride:(e=t.opts)==null?void 0:e.level});return typeof window<"u"?PE(Ir(_r({},t),{opts:r})):CE(Ir(_r({},t),{opts:r}))}var BE={};const TE=":";function ir(t){const[e,r]=t.split(TE);return{namespace:e,reference:r}}function Gl(t,e=[]){const r=[];return Object.keys(t).forEach(i=>{if(e.length&&!e.includes(i))return;const n=t[i];r.push(...n.accounts)}),r}function Td(t,e){return t.includes(":")?[t]:e.chains||[]}var RE=Object.defineProperty,NE=Object.defineProperties,UE=Object.getOwnPropertyDescriptors,Yl=Object.getOwnPropertySymbols,jE=Object.prototype.hasOwnProperty,kE=Object.prototype.propertyIsEnumerable,la=(t,e,r)=>e in t?RE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zl=(t,e)=>{for(var r in e||(e={}))jE.call(e,r)&&la(t,r,e[r]);if(Yl)for(var r of Yl(e))kE.call(e,r)&&la(t,r,e[r]);return t},FE=(t,e)=>NE(t,UE(e)),Jl=(t,e,r)=>la(t,typeof e!="symbol"?e+"":e,r);const qE="ReactNative",st={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},ME="js";function es(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Dr(){return!sr.getDocument()&&!!sr.getNavigator()&&navigator.product===qE}function LE(){return Dr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function zE(){return Dr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function xi(){return!es()&&!!sr.getNavigator()&&!!sr.getDocument()}function ln(){return Dr()?st.reactNative:es()?st.node:xi()?st.browser:st.unknown}function Xl(){var t;try{return Dr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function VE(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([i],[n])=>i.localeCompare(n)).forEach(([i,n])=>{n!=null&&r.set(i,String(n))}),r.toString()}function KE(t){var e,r;const i=Rd();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(n=>n!=="")),FE(Zl(Zl({},i),t),{url:t?.url||i.url,name:t?.name||i.name,description:t?.description||i.description,icons:(r=t?.icons)!=null&&r.length&&t.icons.length>0?t.icons:i.icons})}catch(n){return console.warn("Error populating app metadata",n),t||i}}function Rd(){return Ky.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function HE(){if(ln()===st.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=ly();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function WE(){var t;const e=ln();return e===st.browser?[e,((t=sr.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function Nd(t,e,r){const i=HE(),n=WE();return[[t,e].join("-"),[ME,r].join("-"),i,n].join("/")}function GE({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=r.split("?"),u=Nd(t,e,i),h={auth:n,ua:u,projectId:s,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=VE(l[1]||"",h);return l[0]+"?"+f}function Mr(t,e){return t.filter(r=>e.includes(r)).length===t.length}function ua(t){return Object.fromEntries(t.entries())}function ha(t){return new Map(Object.entries(t))}function Ur(t=L.FIVE_MINUTES,e){const r=L.toMiliseconds(t||L.FIVE_MINUTES);let i,n,s,o;return{resolve:a=>{s&&i&&(clearTimeout(s),i(a),o=Promise.resolve(a))},reject:a=>{s&&n&&(clearTimeout(s),n(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},r),i=a,n=c})}}function kt(t,e,r){return new Promise(async(i,n)=>{const s=setTimeout(()=>n(new Error(r)),e);try{const o=await t;i(o)}catch(o){n(o)}clearTimeout(s)})}function Ud(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function YE(t){return Ud("topic",t)}function ZE(t){return Ud("id",t)}function jd(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function de(t,e){return L.fromMiliseconds(Date.now()+L.toMiliseconds(t))}function Ut(t){return Date.now()>=L.toMiliseconds(t)}function ie(t,e){return`${t}${e?`:${e}`:""}`}function Ft(t=[],e=[]){return[...new Set([...t,...e])]}async function JE({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const n=typeof r=="string"?JSON.parse(r):r,s=n?.href;if(typeof s!="string")return;const o=XE(s,t,e),a=ln();if(a===st.browser){if(!((i=sr.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}QE(o)}else a===st.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(n){console.error(n)}}function XE(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let n=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";n=`${n}${s}${i2(i,!0)}`}else n=`${n}/wc?${i}`;return n}function QE(t){let e="_self";r2()?e="_top":(t2()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function e2(t,e){let r="";try{if(xi()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function Ql(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function eu(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function hc(){return typeof process<"u"&&BE.IS_VITEST==="true"}function t2(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function r2(){try{return window.self!==window.top}catch{return!1}}function i2(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function kd(t){return Buffer.from(t,"base64").toString("utf-8")}function n2(t){return new Promise(e=>setTimeout(e,t))}let s2=class{constructor({limit:e}){Jl(this,"limit"),Jl(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const Sn=BigInt(2**32-1),tu=BigInt(32);function Fd(t,e=!1){return e?{h:Number(t&Sn),l:Number(t>>tu&Sn)}:{h:Number(t>>tu&Sn)|0,l:Number(t&Sn)|0}}function qd(t,e=!1){const r=t.length;let i=new Uint32Array(r),n=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=Fd(t[s],e);[i[s],n[s]]=[o,a]}return[i,n]}const ru=(t,e,r)=>t>>>r,iu=(t,e,r)=>t<<32-r|e>>>r,gr=(t,e,r)=>t>>>r|e<<32-r,yr=(t,e,r)=>t<<32-r|e>>>r,Fi=(t,e,r)=>t<<64-r|e>>>r-32,qi=(t,e,r)=>t>>>r-32|e<<64-r,o2=(t,e)=>e,a2=(t,e)=>t,c2=(t,e,r)=>t<<r|e>>>32-r,l2=(t,e,r)=>e<<r|t>>>32-r,u2=(t,e,r)=>e<<r-32|t>>>64-r,h2=(t,e,r)=>t<<r-32|e>>>64-r;function xt(t,e,r,i){const n=(e>>>0)+(i>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const fc=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),dc=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,f2=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),d2=(t,e,r,i,n)=>e+r+i+n+(t/2**32|0)|0,p2=(t,e,r,i,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(n>>>0),g2=(t,e,r,i,n,s)=>e+r+i+n+s+(t/2**32|0)|0,ii=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function vs(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function or(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function $t(t,...e){if(!vs(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Es(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");or(t.outputLen),or(t.blockLen)}function Or(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function pc(t,e){$t(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Xi(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function wt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function po(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function At(t,e){return t<<32-e|t>>>e}const Md=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ld(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Yt=Md?t=>t:t=>Ld(t);function y2(t){for(let e=0;e<t.length;e++)t[e]=Ld(t[e]);return t}const wr=Md?t=>t:y2,zd=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",w2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function gi(t){if($t(t),zd)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=w2[t[r]];return e}const Ht={_0:48,_9:57,A:65,F:70,a:97,f:102};function nu(t){if(t>=Ht._0&&t<=Ht._9)return t-Ht._0;if(t>=Ht.A&&t<=Ht.F)return t-(Ht.A-10);if(t>=Ht.a&&t<=Ht.f)return t-(Ht.a-10)}function ts(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(zd)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=nu(t.charCodeAt(s)),a=nu(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function Vd(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function St(t){return typeof t=="string"&&(t=Vd(t)),$t(t),t}function br(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];$t(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}let xs=class{};function un(t){const e=i=>t().update(St(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function m2(t){const e=(i,n)=>t(n).update(St(i)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}function Zr(t=32){if(ii&&typeof ii.getRandomValues=="function")return ii.getRandomValues(new Uint8Array(t));if(ii&&typeof ii.randomBytes=="function")return Uint8Array.from(ii.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const b2=BigInt(0),Pi=BigInt(1),v2=BigInt(2),E2=BigInt(7),x2=BigInt(256),_2=BigInt(113),Kd=[],Hd=[],Wd=[];for(let t=0,e=Pi,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Kd.push(2*(5*i+r)),Hd.push((t+1)*(t+2)/2%64);let n=b2;for(let s=0;s<7;s++)e=(e<<Pi^(e>>E2)*_2)%x2,e&v2&&(n^=Pi<<(Pi<<BigInt(s))-Pi);Wd.push(n)}const Gd=qd(Wd,!0),I2=Gd[0],S2=Gd[1],su=(t,e,r)=>r>32?u2(t,e,r):c2(t,e,r),ou=(t,e,r)=>r>32?h2(t,e,r):l2(t,e,r);function $2(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=su(l,u,1)^r[a],f=ou(l,u,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let n=t[2],s=t[3];for(let o=0;o<24;o++){const a=Hd[o],c=su(n,s,a),l=ou(n,s,a),u=Kd[o];n=t[u],s=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=I2[i],t[1]^=S2[i]}wt(r)}let O2=class Yd extends xs{constructor(e,r,i,n=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=n,this.rounds=s,or(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Xi(this.state)}clone(){return this._cloneInto()}keccak(){wr(this.state32),$2(this.state32,this.rounds),wr(this.state32),this.posOut=0,this.pos=0}update(e){Or(this),e=St(e),$t(e);const{blockLen:r,state:i}=this,n=e.length;for(let s=0;s<n;){const o=Math.min(r-this.pos,n-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:n}=this;e[i]^=r,(r&128)!==0&&i===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Or(this,!1),$t(e),this.finish();const r=this.state,{blockLen:i}=this;for(let n=0,s=e.length;n<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return or(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(pc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,wt(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new Yd(r,i,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}};const D2=(t,e,r)=>un(()=>new O2(e,t,r)),A2=D2(1,136,256/8);function P2(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}function C2(t,e,r){return t&e^~t&r}function B2(t,e,r){return t&e^t&r^e&r}let Zd=class extends xs{constructor(e,r,i,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.buffer=new Uint8Array(e),this.view=po(this.buffer)}update(e){Or(this),e=St(e),$t(e);const{view:r,buffer:i,blockLen:n}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=po(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Or(this),pc(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,wt(this.buffer.subarray(o)),this.padOffset>n-o&&(this.process(i,0),o=0);for(let h=o;h<n;h++)r[h]=0;P2(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=po(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=n,e.pos=a,n%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const lr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Te=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Re=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),T2=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ur=new Uint32Array(64);class R2 extends Zd{constructor(e=32){super(64,e,8,!1),this.A=lr[0]|0,this.B=lr[1]|0,this.C=lr[2]|0,this.D=lr[3]|0,this.E=lr[4]|0,this.F=lr[5]|0,this.G=lr[6]|0,this.H=lr[7]|0}get(){const{A:e,B:r,C:i,D:n,E:s,F:o,G:a,H:c}=this;return[e,r,i,n,s,o,a,c]}set(e,r,i,n,s,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=n|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)ur[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=ur[h-15],p=ur[h-2],d=At(f,7)^At(f,18)^f>>>3,y=At(p,17)^At(p,19)^p>>>10;ur[h]=y+ur[h-7]+d+ur[h-16]|0}let{A:i,B:n,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=At(a,6)^At(a,11)^At(a,25),p=u+f+C2(a,c,l)+T2[h]+ur[h]|0,d=(At(i,2)^At(i,13)^At(i,22))+B2(i,n,s)|0;u=l,l=c,c=a,a=o+p|0,o=s,s=n,n=i,i=p+d|0}i=i+this.A|0,n=n+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(i,n,s,o,a,c,l,u)}roundClean(){wt(ur)}destroy(){this.set(0,0,0,0,0,0,0,0),wt(this.buffer)}}const Jd=qd(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),N2=Jd[0],U2=Jd[1],hr=new Uint32Array(80),fr=new Uint32Array(80);let gc=class extends Zd{constructor(e=64){super(128,e,16,!1),this.Ah=Re[0]|0,this.Al=Re[1]|0,this.Bh=Re[2]|0,this.Bl=Re[3]|0,this.Ch=Re[4]|0,this.Cl=Re[5]|0,this.Dh=Re[6]|0,this.Dl=Re[7]|0,this.Eh=Re[8]|0,this.El=Re[9]|0,this.Fh=Re[10]|0,this.Fl=Re[11]|0,this.Gh=Re[12]|0,this.Gl=Re[13]|0,this.Hh=Re[14]|0,this.Hl=Re[15]|0}get(){const{Ah:e,Al:r,Bh:i,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:p,Gl:d,Hh:y,Hl:m}=this;return[e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m]}set(e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=y|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)hr[b]=e.getUint32(r),fr[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const E=hr[b-15]|0,D=fr[b-15]|0,C=gr(E,D,1)^gr(E,D,8)^ru(E,D,7),T=yr(E,D,1)^yr(E,D,8)^iu(E,D,7),R=hr[b-2]|0,A=fr[b-2]|0,k=gr(R,A,19)^Fi(R,A,61)^ru(R,A,6),U=yr(R,A,19)^qi(R,A,61)^iu(R,A,6),B=f2(T,U,fr[b-7],fr[b-16]),$=d2(B,C,k,hr[b-7],hr[b-16]);hr[b]=$|0,fr[b]=B|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:p,Fl:d,Gh:y,Gl:m,Hh:v,Hl:I}=this;for(let b=0;b<80;b++){const E=gr(h,f,14)^gr(h,f,18)^Fi(h,f,41),D=yr(h,f,14)^yr(h,f,18)^qi(h,f,41),C=h&p^~h&y,T=f&d^~f&m,R=p2(I,D,T,U2[b],fr[b]),A=g2(R,v,E,C,N2[b],hr[b]),k=R|0,U=gr(i,n,28)^Fi(i,n,34)^Fi(i,n,39),B=yr(i,n,28)^qi(i,n,34)^qi(i,n,39),$=i&s^i&a^s&a,P=n&o^n&c^o&c;v=y|0,I=m|0,y=p|0,m=d|0,p=h|0,d=f|0,{h,l:f}=xt(l|0,u|0,A|0,k|0),l=a|0,u=c|0,a=s|0,c=o|0,s=i|0,o=n|0;const g=fc(k,B,P);i=dc(g,A,U,$),n=g|0}({h:i,l:n}=xt(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=xt(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=xt(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=xt(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=xt(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=xt(this.Fh|0,this.Fl|0,p|0,d|0),{h:y,l:m}=xt(this.Gh|0,this.Gl|0,y|0,m|0),{h:v,l:I}=xt(this.Hh|0,this.Hl|0,v|0,I|0),this.set(i,n,s,o,a,c,l,u,h,f,p,d,y,m,v,I)}roundClean(){wt(hr,fr)}destroy(){wt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class j2 extends gc{constructor(){super(48),this.Ah=Te[0]|0,this.Al=Te[1]|0,this.Bh=Te[2]|0,this.Bl=Te[3]|0,this.Ch=Te[4]|0,this.Cl=Te[5]|0,this.Dh=Te[6]|0,this.Dl=Te[7]|0,this.Eh=Te[8]|0,this.El=Te[9]|0,this.Fh=Te[10]|0,this.Fl=Te[11]|0,this.Gh=Te[12]|0,this.Gl=Te[13]|0,this.Hh=Te[14]|0,this.Hl=Te[15]|0}}const Ne=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class k2 extends gc{constructor(){super(32),this.Ah=Ne[0]|0,this.Al=Ne[1]|0,this.Bh=Ne[2]|0,this.Bl=Ne[3]|0,this.Ch=Ne[4]|0,this.Cl=Ne[5]|0,this.Dh=Ne[6]|0,this.Dl=Ne[7]|0,this.Eh=Ne[8]|0,this.El=Ne[9]|0,this.Fh=Ne[10]|0,this.Fl=Ne[11]|0,this.Gh=Ne[12]|0,this.Gl=Ne[13]|0,this.Hh=Ne[14]|0,this.Hl=Ne[15]|0}}const _s=un(()=>new R2),F2=un(()=>new gc),q2=un(()=>new j2),M2=un(()=>new k2),L2=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),we=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),K=new Uint32Array(32);function dr(t,e,r,i,n,s){const o=n[s],a=n[s+1];let c=K[2*t],l=K[2*t+1],u=K[2*e],h=K[2*e+1],f=K[2*r],p=K[2*r+1],d=K[2*i],y=K[2*i+1],m=fc(c,u,o);l=dc(m,l,h,a),c=m|0,{Dh:y,Dl:d}={Dh:y^l,Dl:d^c},{Dh:y,Dl:d}={Dh:o2(y,d),Dl:a2(y)},{h:p,l:f}=xt(p,f,y,d),{Bh:h,Bl:u}={Bh:h^p,Bl:u^f},{Bh:h,Bl:u}={Bh:gr(h,u,24),Bl:yr(h,u,24)},K[2*t]=c,K[2*t+1]=l,K[2*e]=u,K[2*e+1]=h,K[2*r]=f,K[2*r+1]=p,K[2*i]=d,K[2*i+1]=y}function pr(t,e,r,i,n,s){const o=n[s],a=n[s+1];let c=K[2*t],l=K[2*t+1],u=K[2*e],h=K[2*e+1],f=K[2*r],p=K[2*r+1],d=K[2*i],y=K[2*i+1],m=fc(c,u,o);l=dc(m,l,h,a),c=m|0,{Dh:y,Dl:d}={Dh:y^l,Dl:d^c},{Dh:y,Dl:d}={Dh:gr(y,d,16),Dl:yr(y,d,16)},{h:p,l:f}=xt(p,f,y,d),{Bh:h,Bl:u}={Bh:h^p,Bl:u^f},{Bh:h,Bl:u}={Bh:Fi(h,u,63),Bl:qi(h,u,63)},K[2*t]=c,K[2*t+1]=l,K[2*e]=u,K[2*e+1]=h,K[2*r]=f,K[2*r+1]=p,K[2*i]=d,K[2*i+1]=y}function z2(t,e={},r,i,n){if(or(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==n)throw new Error("personalization must be undefined or "+n)}class V2 extends xs{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,or(e),or(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Xi(this.buffer)}update(e){Or(this),e=St(e),$t(e);const{blockLen:r,buffer:i,buffer32:n}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(wr(n),this.compress(n,0,!1),wr(n),this.pos=0);const l=Math.min(r-this.pos,s-c),u=o+c;if(l===r&&!(u%4)&&c+l<s){const h=new Uint32Array(a,u,Math.floor((s-c)/4));wr(h);for(let f=0;c+r<s;f+=n.length,c+=r)this.length+=r,this.compress(h,f,!1);wr(h);continue}i.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Or(this),pc(e,this);const{pos:r,buffer32:i}=this;this.finished=!0,wt(this.buffer.subarray(r)),wr(i),this.compress(i,0,!0),wr(i);const n=Xi(e);this.get().forEach((s,o)=>n[o]=Yt(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){const{buffer:r,length:i,finished:n,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=n,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class K2 extends V2{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=we[0]|0,this.v0h=we[1]|0,this.v1l=we[2]|0,this.v1h=we[3]|0,this.v2l=we[4]|0,this.v2h=we[5]|0,this.v3l=we[6]|0,this.v3h=we[7]|0,this.v4l=we[8]|0,this.v4h=we[9]|0,this.v5l=we[10]|0,this.v5h=we[11]|0,this.v6l=we[12]|0,this.v6h=we[13]|0,this.v7l=we[14]|0,this.v7h=we[15]|0,z2(r,e,64,16,16);let{key:i,personalization:n,salt:s}=e,o=0;if(i!==void 0&&(i=St(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=St(s);const a=Xi(s);this.v4l^=Yt(a[0]),this.v4h^=Yt(a[1]),this.v5l^=Yt(a[2]),this.v5h^=Yt(a[3])}if(n!==void 0){n=St(n);const a=Xi(n);this.v6l^=Yt(a[0]),this.v6h^=Yt(a[1]),this.v7l^=Yt(a[2]),this.v7h^=Yt(a[3])}if(i!==void 0){const a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:i,v1h:n,v2l:s,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:f,v6l:p,v6h:d,v7l:y,v7h:m}=this;return[e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m]}set(e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m){this.v0l=e|0,this.v0h=r|0,this.v1l=i|0,this.v1h=n|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=f|0,this.v6l=p|0,this.v6h=d|0,this.v7l=y|0,this.v7h=m|0}compress(e,r,i){this.get().forEach((c,l)=>K[l]=c),K.set(we,16);let{h:n,l:s}=Fd(BigInt(this.length));K[24]=we[8]^s,K[25]=we[9]^n,i&&(K[28]=~K[28],K[29]=~K[29]);let o=0;const a=L2;for(let c=0;c<12;c++)dr(0,4,8,12,e,r+2*a[o++]),pr(0,4,8,12,e,r+2*a[o++]),dr(1,5,9,13,e,r+2*a[o++]),pr(1,5,9,13,e,r+2*a[o++]),dr(2,6,10,14,e,r+2*a[o++]),pr(2,6,10,14,e,r+2*a[o++]),dr(3,7,11,15,e,r+2*a[o++]),pr(3,7,11,15,e,r+2*a[o++]),dr(0,5,10,15,e,r+2*a[o++]),pr(0,5,10,15,e,r+2*a[o++]),dr(1,6,11,12,e,r+2*a[o++]),pr(1,6,11,12,e,r+2*a[o++]),dr(2,7,8,13,e,r+2*a[o++]),pr(2,7,8,13,e,r+2*a[o++]),dr(3,4,9,14,e,r+2*a[o++]),pr(3,4,9,14,e,r+2*a[o++]);this.v0l^=K[0]^K[16],this.v0h^=K[1]^K[17],this.v1l^=K[2]^K[18],this.v1h^=K[3]^K[19],this.v2l^=K[4]^K[20],this.v2h^=K[5]^K[21],this.v3l^=K[6]^K[22],this.v3h^=K[7]^K[23],this.v4l^=K[8]^K[24],this.v4h^=K[9]^K[25],this.v5l^=K[10]^K[26],this.v5h^=K[11]^K[27],this.v6l^=K[12]^K[28],this.v6h^=K[13]^K[29],this.v7l^=K[14]^K[30],this.v7h^=K[15]^K[31],wt(K)}destroy(){this.destroyed=!0,wt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const H2=m2(t=>new K2(t)),W2="https://rpc.walletconnect.org/v1";function Xd(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(A2(r)).toString("hex")}async function G2(t,e,r,i,n,s){switch(r.t){case"eip191":return await Y2(t,e,r.s);case"eip1271":return await Z2(t,e,r.s,i,n,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function Y2(t,e,r){const i=sm(r);return um({payload:Xd(e),signature:i}).toLowerCase()===t.toLowerCase()}async function Z2(t,e,r,i,n,s){const o=ir(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=r.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:Xd(e)).substring(2),f=a+h+c+u+l,p=await fetch(`${s||W2}/?chainId=${i}&projectId=${n}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:J2(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function J2(){return Date.now()+Math.floor(Math.random()*1e3)}function X2(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const i=r[0];if(i===0)throw new Error("No signatures found");const n=1+i*64;if(r.length<n)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return on.encode(s)}function Q2(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),i=new Uint8Array(r.length+e.length);i.set(r),i.set(e,r.length);const n=H2(i,{dkLen:32});return on.encode(n)}function au(t){const e=new Uint8Array(_s(ex(t)));return on.encode(e)}function ex(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function cu(t){const e=Buffer.from(t,"base64"),r=Ym(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const i=qm(r),n=Buffer.from("TX"),s=Buffer.concat([n,Buffer.from(i)]),o=M2(s);return ey.encode(o).replace(/=+$/,"")}function go(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function tx(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),i=Buffer.from(t.signature.signature,"base64"),n=[];n.push(Buffer.from([10])),n.push(go(e.length)),n.push(e),n.push(Buffer.from([18])),n.push(go(r.length)),n.push(r),n.push(Buffer.from([26])),n.push(go(i.length)),n.push(i);const s=Buffer.concat(n),o=_s(s);return Buffer.from(o).toString("hex").toUpperCase()}function rx(t){var e,r;const i=[];try{if(typeof t=="string")return i.push(t),i;if(typeof t!="object")return i;t!=null&&t.id&&i.push(t.id);const n=(r=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;n&&i.push(...n)}catch(n){console.warn("getWalletSendCallsHashes failed: ",n)}return i}var ix=Object.defineProperty,nx=Object.defineProperties,sx=Object.getOwnPropertyDescriptors,lu=Object.getOwnPropertySymbols,ox=Object.prototype.hasOwnProperty,ax=Object.prototype.propertyIsEnumerable,uu=(t,e,r)=>e in t?ix(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cx=(t,e)=>{for(var r in e||(e={}))ox.call(e,r)&&uu(t,r,e[r]);if(lu)for(var r of lu(e))ax.call(e,r)&&uu(t,r,e[r]);return t},lx=(t,e)=>nx(t,sx(e));const Qd="did:pkh:",ux={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},hx=t=>t?ux[t]||t:"",Is=t=>t?.split(":"),fx=t=>{const e=t&&Is(t);if(e)return t.includes(Qd)?e[3]:e[1]},dx=t=>{const e=t&&Is(t);if(e)return t.includes(Qd)?e[2]:e[0]},fa=t=>{const e=t&&Is(t);if(e)return e[2]+":"+e[3]},rs=t=>{const e=t&&Is(t);if(e)return e.pop()};async function hu(t){const{cacao:e,projectId:r}=t,{s:i,p:n}=e,s=ep(n,n.iss),o=rs(n.iss);return await G2(o,s,i,fa(n.iss),r)}const ep=(t,e)=>{const r=dx(e);if(!r)throw new Error("Invalid issuer: "+e);const i=`${t.domain} wants you to sign in with your ${hx(r)} account:`,n=rs(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${fx(e)}`,l=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,f=t.nbf?`Not Before: ${t.nbf}`:void 0,p=t.requestId?`Request ID: ${t.requestId}`:void 0,d=t.resources?`Resources:${t.resources.map(m=>`
- ${m}`).join("")}`:void 0,y=qn(t.resources);if(y){const m=Qi(y);s=xx(s,m)}return[i,n,"",s,"",o,a,c,l,u,h,f,p,d].filter(m=>m!=null).join(`
`)};function px(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function gx(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Gr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(n=>{const s=i[n];if(!Array.isArray(s))throw new Error(`Ability limits ${n} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${n} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${n}) must be an array of objects, found: ${o}`)})})})}function yx(t,e,r,i={}){return r?.sort((n,s)=>n.localeCompare(s)),{att:{[t]:wx(e,r,i)}}}function wx(t,e,r={}){e=e?.sort((n,s)=>n.localeCompare(s));const i=e.map(n=>({[`${t}/${n}`]:[r]}));return Object.assign({},...i)}function tp(t){return Gr(t),`urn:recap:${px(t).replace(/=/g,"")}`}function Qi(t){const e=gx(t.replace("urn:recap:",""));return Gr(e),e}function mx(t,e,r){const i=yx(t,e,r);return tp(i)}function bx(t){return t&&t.includes("urn:recap:")}function vx(t,e){const r=Qi(t),i=Qi(e),n=Ex(r,i);return tp(n)}function Ex(t,e){Gr(t),Gr(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((n,s)=>n.localeCompare(s)),i={att:{}};return r.forEach(n=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[n])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[n])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;i.att[n]=lx(cx({},i.att[n]),{[a]:((c=t.att[n])==null?void 0:c[a])||((l=e.att[n])==null?void 0:l[a])})})}),i}function xx(t="",e){Gr(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let n=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(n++,`(${n}) '${h}': '${l[h].join("', '")}' for '${a}'.`));i.push(u.join(", ").replace(".,","."))});const s=i.join(" "),o=`${r}${s}`;return`${t?t+" ":""}${o}`}function fu(t){var e;const r=Qi(t);Gr(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(n=>n.split("/")[1]):[]}function du(t){const e=Qi(t);Gr(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(n=>{var s;(s=n?.[0])!=null&&s.chains&&r.push(n[0].chains)})}),[...new Set(r.flat())]}function qn(t){if(!t)return;const e=t?.[t.length-1];return bx(e)?e:void 0}function rp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function da(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function yo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function We(t,...e){if(!rp(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function pu(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function _x(t,e){We(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Sr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function bi(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Ix(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const Sx=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function $x(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function pa(t){if(typeof t=="string")t=$x(t);else if(rp(t))t=ga(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function Ox(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Dx(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const Ax=(t,e)=>{function r(i,...n){if(We(i),!Sx)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=n[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?We(l):We(l,t.nonceLength)}const s=t.tagLength;s&&n[1]!==void 0&&We(n[1]);const o=e(i,...n),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");We(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,We(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(We(l),s&&l.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(r,t),r};function gu(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!Cx(e))throw new Error("invalid output, must be aligned");return e}function yu(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s);t.setUint32(e+4,o,i),t.setUint32(e+0,a,i)}function Px(t,e,r){da(r);const i=new Uint8Array(16),n=Ix(i);return yu(n,0,BigInt(e),r),yu(n,8,BigInt(t),r),i}function Cx(t){return t.byteOffset%4===0}function ga(t){return Uint8Array.from(t)}const ip=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),Bx=ip("expand 16-byte k"),Tx=ip("expand 32-byte k"),Rx=Sr(Bx),Nx=Sr(Tx);function ee(t,e){return t<<e|t>>>32-e}function ya(t){return t.byteOffset%4===0}const $n=64,Ux=16,np=2**32-1,wu=new Uint32Array;function jx(t,e,r,i,n,s,o,a){const c=n.length,l=new Uint8Array($n),u=Sr(l),h=ya(n)&&ya(s),f=h?Sr(n):wu,p=h?Sr(s):wu;for(let d=0;d<c;o++){if(t(e,r,i,u,o,a),o>=np)throw new Error("arx: counter overflow");const y=Math.min($n,c-d);if(h&&y===$n){const m=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let v=0,I;v<Ux;v++)I=m+v,p[I]=f[I]^u[v];d+=$n;continue}for(let m=0,v;m<y;m++)v=d+m,s[v]=n[v]^l[m];d+=y}}function kx(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:n,counterRight:s,rounds:o}=Ox({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return yo(n),yo(o),da(s),da(r),(a,c,l,u,h=0)=>{We(a),We(c),We(l);const f=l.length;if(u===void 0&&(u=new Uint8Array(f)),We(u),yo(h),h<0||h>=np)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const p=[];let d=a.length,y,m;if(d===32)p.push(y=ga(a)),m=Nx;else if(d===16&&r)y=new Uint8Array(32),y.set(a),y.set(a,16),m=Rx,p.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);ya(c)||p.push(c=ga(c));const v=Sr(y);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(m,v,Sr(c.subarray(0,16)),v),c=c.subarray(16)}const I=16-n;if(I!==c.length)throw new Error(`arx: nonce must be ${I} or 16 bytes`);if(I!==12){const E=new Uint8Array(12);E.set(c,s?0:12-c.length),c=E,p.push(c)}const b=Sr(c);return jx(t,m,v,b,l,u,h,o),bi(...p),u}}const $e=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class Fx{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=pa(e),We(e,32);const r=$e(e,0),i=$e(e,2),n=$e(e,4),s=$e(e,6),o=$e(e,8),a=$e(e,10),c=$e(e,12),l=$e(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|n<<6)&7939,this.r[3]=(n>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=$e(e,16+2*u)}process(e,r,i=!1){const n=i?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],f=o[5],p=o[6],d=o[7],y=o[8],m=o[9],v=$e(e,r+0),I=$e(e,r+2),b=$e(e,r+4),E=$e(e,r+6),D=$e(e,r+8),C=$e(e,r+10),T=$e(e,r+12),R=$e(e,r+14);let A=s[0]+(v&8191),k=s[1]+((v>>>13|I<<3)&8191),U=s[2]+((I>>>10|b<<6)&8191),B=s[3]+((b>>>7|E<<9)&8191),$=s[4]+((E>>>4|D<<12)&8191),P=s[5]+(D>>>1&8191),g=s[6]+((D>>>14|C<<2)&8191),w=s[7]+((C>>>11|T<<5)&8191),x=s[8]+((T>>>8|R<<8)&8191),O=s[9]+(R>>>5|n),_=0,S=_+A*a+k*(5*m)+U*(5*y)+B*(5*d)+$*(5*p);_=S>>>13,S&=8191,S+=P*(5*f)+g*(5*h)+w*(5*u)+x*(5*l)+O*(5*c),_+=S>>>13,S&=8191;let N=_+A*c+k*a+U*(5*m)+B*(5*y)+$*(5*d);_=N>>>13,N&=8191,N+=P*(5*p)+g*(5*f)+w*(5*h)+x*(5*u)+O*(5*l),_+=N>>>13,N&=8191;let j=_+A*l+k*c+U*a+B*(5*m)+$*(5*y);_=j>>>13,j&=8191,j+=P*(5*d)+g*(5*p)+w*(5*f)+x*(5*h)+O*(5*u),_+=j>>>13,j&=8191;let V=_+A*u+k*l+U*c+B*a+$*(5*m);_=V>>>13,V&=8191,V+=P*(5*y)+g*(5*d)+w*(5*p)+x*(5*f)+O*(5*h),_+=V>>>13,V&=8191;let q=_+A*h+k*u+U*l+B*c+$*a;_=q>>>13,q&=8191,q+=P*(5*m)+g*(5*y)+w*(5*d)+x*(5*p)+O*(5*f),_+=q>>>13,q&=8191;let M=_+A*f+k*h+U*u+B*l+$*c;_=M>>>13,M&=8191,M+=P*a+g*(5*m)+w*(5*y)+x*(5*d)+O*(5*p),_+=M>>>13,M&=8191;let H=_+A*p+k*f+U*h+B*u+$*l;_=H>>>13,H&=8191,H+=P*c+g*a+w*(5*m)+x*(5*y)+O*(5*d),_+=H>>>13,H&=8191;let G=_+A*d+k*p+U*f+B*h+$*u;_=G>>>13,G&=8191,G+=P*l+g*c+w*a+x*(5*m)+O*(5*y),_+=G>>>13,G&=8191;let Z=_+A*y+k*d+U*p+B*f+$*h;_=Z>>>13,Z&=8191,Z+=P*u+g*l+w*c+x*a+O*(5*m),_+=Z>>>13,Z&=8191;let W=_+A*m+k*y+U*d+B*p+$*f;_=W>>>13,W&=8191,W+=P*h+g*u+w*l+x*c+O*a,_+=W>>>13,W&=8191,_=(_<<2)+_|0,_=_+S|0,S=_&8191,_=_>>>13,N+=_,s[0]=S,s[1]=N,s[2]=j,s[3]=V,s[4]=q,s[5]=M,s[6]=H,s[7]=G,s[8]=Z,s[9]=W}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let n=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=n,n=e[a]>>>13,e[a]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,i[0]=e[0]+5,n=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+n,n=i[a]>>>13,i[a]&=8191;i[9]-=8192;let s=(n^1)-1;for(let a=0;a<10;a++)i[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;bi(i)}update(e){pu(this),e=pa(e),We(e);const{buffer:r,blockLen:i}=this,n=e.length;for(let s=0;s<n;){const o=Math.min(i-this.pos,n-s);if(o===i){for(;i<=n-s;s+=i)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){bi(this.h,this.r,this.buffer,this.pad)}digestInto(e){pu(this),_x(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:n}=this;if(n){for(r[n++]=1;n<16;n++)r[n]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=i[o]>>>0,e[s++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}}function qx(t){const e=(i,n)=>t(n).update(pa(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const Mx=qx(t=>new Fx(t));function Lx(t,e,r,i,n,s=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],f=e[2],p=e[3],d=e[4],y=e[5],m=e[6],v=e[7],I=n,b=r[0],E=r[1],D=r[2],C=o,T=a,R=c,A=l,k=u,U=h,B=f,$=p,P=d,g=y,w=m,x=v,O=I,_=b,S=E,N=D;for(let V=0;V<s;V+=2)C=C+k|0,O=ee(O^C,16),P=P+O|0,k=ee(k^P,12),C=C+k|0,O=ee(O^C,8),P=P+O|0,k=ee(k^P,7),T=T+U|0,_=ee(_^T,16),g=g+_|0,U=ee(U^g,12),T=T+U|0,_=ee(_^T,8),g=g+_|0,U=ee(U^g,7),R=R+B|0,S=ee(S^R,16),w=w+S|0,B=ee(B^w,12),R=R+B|0,S=ee(S^R,8),w=w+S|0,B=ee(B^w,7),A=A+$|0,N=ee(N^A,16),x=x+N|0,$=ee($^x,12),A=A+$|0,N=ee(N^A,8),x=x+N|0,$=ee($^x,7),C=C+U|0,N=ee(N^C,16),w=w+N|0,U=ee(U^w,12),C=C+U|0,N=ee(N^C,8),w=w+N|0,U=ee(U^w,7),T=T+B|0,O=ee(O^T,16),x=x+O|0,B=ee(B^x,12),T=T+B|0,O=ee(O^T,8),x=x+O|0,B=ee(B^x,7),R=R+$|0,_=ee(_^R,16),P=P+_|0,$=ee($^P,12),R=R+$|0,_=ee(_^R,8),P=P+_|0,$=ee($^P,7),A=A+k|0,S=ee(S^A,16),g=g+S|0,k=ee(k^g,12),A=A+k|0,S=ee(S^A,8),g=g+S|0,k=ee(k^g,7);let j=0;i[j++]=o+C|0,i[j++]=a+T|0,i[j++]=c+R|0,i[j++]=l+A|0,i[j++]=u+k|0,i[j++]=h+U|0,i[j++]=f+B|0,i[j++]=p+$|0,i[j++]=d+P|0,i[j++]=y+g|0,i[j++]=m+w|0,i[j++]=v+x|0,i[j++]=I+O|0,i[j++]=b+_|0,i[j++]=E+S|0,i[j++]=D+N|0}const zx=kx(Lx,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Vx=new Uint8Array(16),mu=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(Vx.subarray(r))},Kx=new Uint8Array(32);function bu(t,e,r,i,n){const s=t(e,r,Kx),o=Mx.create(s);n&&mu(o,n),mu(o,i);const a=Px(i.length,n?n.length:0,!0);o.update(a);const c=o.digest();return bi(s,a),c}const Hx=t=>(e,r,i)=>({encrypt(n,s){const o=n.length;s=gu(o+16,s,!1),s.set(n);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=bu(t,e,r,a,i);return s.set(c,o),bi(c),s},decrypt(n,s){s=gu(n.length-16,s,!1);const o=n.subarray(0,-16),a=n.subarray(-16),c=bu(t,e,r,o,i);if(!Dx(a,c))throw new Error("invalid tag");return s.set(n.subarray(0,-16)),t(e,r,s,s,1),bi(c),s}}),sp=Ax({blockSize:64,nonceLength:12,tagLength:16},Hx(zx));let op=class extends xs{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Es(e);const i=St(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(i.length>n?e.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),wt(s)}update(e){return Or(this),this.iHash.update(e),this}digestInto(e){Or(this),$t(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:n,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Ss=(t,e,r)=>new op(t,e).update(r).digest();Ss.create=(t,e)=>new op(t,e);function Wx(t,e,r){return Es(t),r===void 0&&(r=new Uint8Array(t.outputLen)),Ss(t,St(r),St(e))}const wo=Uint8Array.from([0]),vu=Uint8Array.of();function Gx(t,e,r,i=32){Es(t),or(i);const n=t.outputLen;if(i>255*n)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/n);r===void 0&&(r=vu);const o=new Uint8Array(s*n),a=Ss.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)wo[0]=u+1,c.update(u===0?vu:l).update(r).update(wo).digestInto(l),o.set(l,n*u),a._cloneInto(c);return a.destroy(),c.destroy(),wt(l,wo),o.slice(0,i)}const Yx=(t,e,r,i,n)=>Gx(t,Wx(t,e,r),i,n),$s=_s,yc=BigInt(0),wa=BigInt(1);function is(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Lr(t,e,r=""){const i=vs(t),n=t?.length,s=e!==void 0;if(!i||s&&n!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=i?`length=${n}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function On(t){const e=t.toString(16);return e.length&1?"0"+e:e}function ap(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?yc:BigInt("0x"+t)}function Os(t){return ap(gi(t))}function ns(t){return $t(t),ap(gi(Uint8Array.from(t).reverse()))}function wc(t,e){return ts(t.toString(16).padStart(e*2,"0"))}function mc(t,e){return wc(t,e).reverse()}function je(t,e,r){let i;if(typeof e=="string")try{i=ts(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(vs(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}const mo=t=>typeof t=="bigint"&&yc<=t;function Zx(t,e,r){return mo(t)&&mo(e)&&mo(r)&&e<=t&&t<r}function ma(t,e,r,i){if(!Zx(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function cp(t){let e;for(e=0;t>yc;t>>=wa,e+=1);return e}const hn=t=>(wa<<BigInt(t))-wa;function Jx(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const i=f=>new Uint8Array(f),n=f=>Uint8Array.of(f);let s=i(t),o=i(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},l=(...f)=>r(o,s,...f),u=(f=i(0))=>{o=l(n(0),f),s=l(),f.length!==0&&(o=l(n(1),f),s=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){s=l();const d=s.slice();p.push(d),f+=s.length}return br(...p)};return(f,p)=>{c(),u(f);let d;for(;!(d=p(h()));)u();return c(),d}}function Ds(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function i(n,s,o){const a=t[n];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${n}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([n,s])=>i(n,s,!1)),Object.entries(r).forEach(([n,s])=>i(n,s,!0))}function Eu(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}const Ze=BigInt(0),qe=BigInt(1),zr=BigInt(2),lp=BigInt(3),up=BigInt(4),hp=BigInt(5),Xx=BigInt(7),fp=BigInt(8),Qx=BigInt(9),dp=BigInt(16);function nt(t,e){const r=t%e;return r>=Ze?r:e+r}function Et(t,e,r){let i=t;for(;e-- >Ze;)i*=i,i%=r;return i}function xu(t,e){if(t===Ze)throw new Error("invert: expected non-zero number");if(e<=Ze)throw new Error("invert: expected positive modulus, got "+e);let r=nt(t,e),i=e,n=Ze,s=qe;for(;r!==Ze;){const o=i/r,a=i%r,c=n-s*o;i=r,r=a,n=s,s=c}if(i!==qe)throw new Error("invert: does not exist");return nt(n,e)}function bc(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function pp(t,e){const r=(t.ORDER+qe)/up,i=t.pow(e,r);return bc(t,i,e),i}function e_(t,e){const r=(t.ORDER-hp)/fp,i=t.mul(e,zr),n=t.pow(i,r),s=t.mul(e,n),o=t.mul(t.mul(s,zr),n),a=t.mul(s,t.sub(o,t.ONE));return bc(t,a,e),a}function t_(t){const e=Ar(t),r=gp(t),i=r(e,e.neg(e.ONE)),n=r(e,i),s=r(e,e.neg(i)),o=(t+Xx)/dp;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,i);const h=a.mul(l,n),f=a.mul(l,s),p=a.eql(a.sqr(u),c),d=a.eql(a.sqr(h),c);l=a.cmov(l,u,p),u=a.cmov(f,h,d);const y=a.eql(a.sqr(u),c),m=a.cmov(l,u,y);return bc(a,m,c),m}}function gp(t){if(t<lp)throw new Error("sqrt is not defined for small field");let e=t-qe,r=0;for(;e%zr===Ze;)e/=zr,r++;let i=zr;const n=Ar(t);for(;_u(n,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return pp;let s=n.pow(i,e);const o=(e+qe)/zr;return function(a,c){if(a.is0(c))return c;if(_u(a,c)!==1)throw new Error("Cannot find square root");let l=r,u=a.mul(a.ONE,s),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,d=a.sqr(h);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===l)throw new Error("Cannot find square root");const y=qe<<BigInt(l-p-1),m=a.pow(u,y);l=p,u=a.sqr(m),h=a.mul(h,u),f=a.mul(f,m)}return f}}function r_(t){return t%up===lp?pp:t%fp===hp?e_:t%dp===Qx?t_(t):gp(t)}const i_=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function n_(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=i_.reduce((i,n)=>(i[n]="function",i),e);return Ds(t,r),t}function s_(t,e,r){if(r<Ze)throw new Error("invalid exponent, negatives unsupported");if(r===Ze)return t.ONE;if(r===qe)return e;let i=t.ONE,n=e;for(;r>Ze;)r&qe&&(i=t.mul(i,n)),n=t.sqr(n),r>>=qe;return i}function yp(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),s=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),s),i}function _u(t,e){const r=(t.ORDER-qe)/zr,i=t.pow(e,r),n=t.eql(i,t.ONE),s=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!n&&!s&&!o)throw new Error("invalid Legendre symbol result");return n?1:s?0:-1}function wp(t,e){e!==void 0&&or(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Ar(t,e,r=!1,i={}){if(t<=Ze)throw new Error("invalid field: expected ORDER > 0, got "+t);let n,s,o=!1,a;if(typeof e=="object"&&e!=null){if(i.sqrt||r)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(n=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(n=e),i.sqrt&&(s=i.sqrt);const{nBitLength:c,nByteLength:l}=wp(t,n);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:l,MASK:hn(c),ZERO:Ze,ONE:qe,allowedLengths:a,create:f=>nt(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ze<=f&&f<t},is0:f=>f===Ze,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&qe)===qe,neg:f=>nt(-f,t),eql:(f,p)=>f===p,sqr:f=>nt(f*f,t),add:(f,p)=>nt(f+p,t),sub:(f,p)=>nt(f-p,t),mul:(f,p)=>nt(f*p,t),pow:(f,p)=>s_(h,f,p),div:(f,p)=>nt(f*xu(p,t),t),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>xu(f,t),sqrt:s||(f=>(u||(u=r_(t)),u(h,f))),toBytes:f=>r?mc(f,l):wc(f,l),fromBytes:(f,p=!0)=>{if(a){if(!a.includes(f.length)||f.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const y=new Uint8Array(l);y.set(f,r?0:y.length-f.length),f=y}if(f.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+f.length);let d=r?ns(f):Os(f);if(o&&(d=nt(d,t)),!p&&!h.isValid(d))throw new Error("invalid field element: outside of range 0..ORDER");return d},invertBatch:f=>yp(h,f),cmov:(f,p,d)=>d?p:f});return Object.freeze(h)}function mp(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function bp(t){const e=mp(t);return e+Math.ceil(e/2)}function o_(t,e,r=!1){const i=t.length,n=mp(e),s=bp(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=r?ns(t):Os(t),a=nt(o,e-qe)+qe;return r?mc(a,n):wc(a,n)}const vi=BigInt(0),Vr=BigInt(1);function ss(t,e){const r=e.negate();return t?r:e}function bo(t,e){const r=yp(t.Fp,e.map(i=>i.Z));return e.map((i,n)=>t.fromAffine(i.toAffine(r[n])))}function vp(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function vo(t,e){vp(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),n=2**t,s=hn(t),o=BigInt(t);return{windows:r,windowSize:i,mask:s,maxNumber:n,shiftBy:o}}function Iu(t,e,r){const{windowSize:i,mask:n,maxNumber:s,shiftBy:o}=r;let a=Number(t&n),c=t>>o;a>i&&(a-=s,c+=Vr);const l=e*i,u=l+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:l}}function a_(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function c_(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Eo=new WeakMap,Ep=new WeakMap;function xo(t){return Ep.get(t)||1}function Su(t){if(t!==vi)throw new Error("invalid wNAF")}class l_{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,i=this.ZERO){let n=e;for(;r>vi;)r&Vr&&(i=i.add(n)),n=n.double(),r>>=Vr;return i}precomputeWindow(e,r){const{windows:i,windowSize:n}=vo(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<i;c++){a=o,s.push(a);for(let l=1;l<n;l++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,i){if(!this.Fn.isValid(i))throw new Error("invalid scalar");let n=this.ZERO,s=this.BASE;const o=vo(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:f,offsetF:p}=Iu(i,a,o);i=c,u?s=s.add(ss(f,r[p])):n=n.add(ss(h,r[l]))}return Su(i),{p:n,f:s}}wNAFUnsafe(e,r,i,n=this.ZERO){const s=vo(e,this.bits);for(let o=0;o<s.windows&&i!==vi;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=Iu(i,o,s);if(i=a,!l){const h=r[c];n=n.add(u?h.negate():h)}}return Su(i),n}getPrecomputes(e,r,i){let n=Eo.get(r);return n||(n=this.precomputeWindow(r,e),e!==1&&(typeof i=="function"&&(n=i(n)),Eo.set(r,n))),n}cached(e,r,i){const n=xo(e);return this.wNAF(n,this.getPrecomputes(n,e,i),r)}unsafe(e,r,i,n){const s=xo(e);return s===1?this._unsafeLadder(e,r,n):this.wNAFUnsafe(s,this.getPrecomputes(s,e,i),r,n)}createCache(e,r){vp(r,this.bits),Ep.set(e,r),Eo.delete(e)}hasCache(e){return xo(e)!==1}}function u_(t,e,r,i){let n=e,s=t.ZERO,o=t.ZERO;for(;r>vi||i>vi;)r&Vr&&(s=s.add(n)),i&Vr&&(o=o.add(n)),n=n.double(),r>>=Vr,i>>=Vr;return{p1:s,p2:o}}function h_(t,e,r,i){a_(r,t),c_(i,e);const n=r.length,s=i.length;if(n!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=cp(BigInt(n));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=hn(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let y=0;y<s;y++){const m=i[y],v=Number(m>>BigInt(p)&l);u[v]=u[v].add(r[y])}let d=o;for(let y=u.length-1,m=o;y>0;y--)m=m.add(u[y]),d=d.add(m);if(f=f.add(d),p!==0)for(let y=0;y<c;y++)f=f.double()}return f}function $u(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return n_(e),e}else return Ar(t,{isLE:r})}function f_(t,e,r={},i){if(i===void 0&&(i=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>vi))throw new Error(`CURVE.${a} must be positive bigint`)}const n=$u(e.p,r.Fp,i),s=$u(e.n,r.Fn,i),o=["Gx","Gy","a","b"];for(const a of o)if(!n.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:n,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Vd("HashToScalar-");const Ci=BigInt(0),ni=BigInt(1),Dn=BigInt(2);function d_(t){return Ds(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function p_(t){const e=d_(t),{P:r,type:i,adjustScalarBytes:n,powPminus2:s,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const c=o||Zr,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),p=a?Dn**BigInt(254):Dn**BigInt(447),d=a?BigInt(8)*Dn**BigInt(251)-ni:BigInt(4)*Dn**BigInt(445)-ni,y=p+d+ni,m=B=>nt(B,r),v=I(h);function I(B){return mc(m(B),u)}function b(B){const $=je("u coordinate",B,u);return a&&($[31]&=127),m(ns($))}function E(B){return ns(n(je("scalar",B,u)))}function D(B,$){const P=R(b($),E(B));if(P===Ci)throw new Error("invalid private or public key received");return I(P)}function C(B){return D(B,v)}function T(B,$,P){const g=m(B*($-P));return $=m($-g),P=m(P+g),{x_2:$,x_3:P}}function R(B,$){ma("u",B,Ci,r),ma("scalar",$,p,y);const P=$,g=B;let w=ni,x=Ci,O=B,_=ni,S=Ci;for(let j=BigInt(l-1);j>=Ci;j--){const V=P>>j&ni;S^=V,{x_2:w,x_3:O}=T(S,w,O),{x_2:x,x_3:_}=T(S,x,_),S=V;const q=w+x,M=m(q*q),H=w-x,G=m(H*H),Z=M-G,W=O+_,J=O-_,ue=m(J*q),ye=m(W*H),be=ue+ye,ke=ue-ye;O=m(be*be),_=m(g*m(ke*ke)),w=m(M*G),x=m(Z*(M+m(f*Z)))}({x_2:w,x_3:O}=T(S,w,O)),{x_2:x,x_3:_}=T(S,x,_);const N=s(x);return m(w*N)}const A={secretKey:u,publicKey:u,seed:u},k=(B=c(u))=>($t(B,A.seed),B);function U(B){const $=k(B);return{secretKey:$,publicKey:C($)}}return{keygen:U,getSharedSecret:(B,$)=>D(B,$),getPublicKey:B=>C(B),scalarMult:D,scalarMultBase:C,utils:{randomSecretKey:k,randomPrivateKey:k},GuBytes:v.slice(),lengths:A}}const g_=BigInt(1),Ou=BigInt(2),y_=BigInt(3),w_=BigInt(5);BigInt(8);const xp=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),m_={p:xp,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function b_(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=xp,o=t*t%s*t%s,a=Et(o,Ou,s)*o%s,c=Et(a,g_,s)*t%s,l=Et(c,w_,s)*c%s,u=Et(l,e,s)*l%s,h=Et(u,r,s)*u%s,f=Et(h,i,s)*h%s,p=Et(f,n,s)*f%s,d=Et(p,n,s)*f%s,y=Et(d,e,s)*l%s;return{pow_p_5_8:Et(y,Ou,s)*t%s,b2:o}}function v_(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const E_=Ar(m_.p,{isLE:!0}),ba=(()=>{const t=E_.ORDER;return p_({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:i}=b_(e);return nt(Et(r,y_,t)*i,t)},adjustScalarBytes:v_})})(),Du=(t,e)=>(t+(t>=0?e:-e)/_p)/e;function x_(t,e,r){const[[i,n],[s,o]]=e,a=Du(o*t,r),c=Du(-n*t,r);let l=t-a*i-c*s,u=-a*n-c*o;const h=l<tr,f=u<tr;h&&(l=-l),f&&(u=-u);const p=hn(Math.ceil(cp(r)/2))+yi;if(l<tr||l>=p||u<tr||u>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}function va(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function _o(t,e){const r={};for(let i of Object.keys(e))r[i]=t[i]===void 0?e[i]:t[i];return is(r.lowS,"lowS"),is(r.prehash,"prehash"),r.format!==void 0&&va(r.format),r}class __ extends Error{constructor(e=""){super(e)}}const Qt={Err:__,_tlv:{encode:(t,e)=>{const{Err:r}=Qt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,n=On(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");const s=i>127?On(n.length/2|128):"";return On(t)+s+n+e},decode(t,e){const{Err:r}=Qt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const n=e[i++],s=!!(n&128);let o=0;if(!s)o=n;else{const c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Qt;if(t<tr)throw new e("integer: negative integers are not allowed");let r=On(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Qt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Os(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Qt,n=je("signature",t),{v:s,l:o}=i.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,s),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=Qt,i=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),s=i+n;return e.encode(48,s)}},tr=BigInt(0),yi=BigInt(1),_p=BigInt(2),An=BigInt(3),I_=BigInt(4);function li(t,e){const{BYTES:r}=t;let i;if(typeof e=="bigint")i=e;else{let n=je("private key",e);try{i=t.fromBytes(n)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}function S_(t,e={}){const r=f_("weierstrass",t,e),{Fp:i,Fn:n}=r;let s=r.CURVE;const{h:o,n:a}=s;Ds(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!i.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=Sp(i,n);function u(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(B,$,P){const{x:g,y:w}=$.toAffine(),x=i.toBytes(g);if(is(P,"isCompressed"),P){u();const O=!i.isOdd(w);return br(Ip(O),x)}else return br(Uint8Array.of(4),x,i.toBytes(w))}function f(B){Lr(B,void 0,"Point");const{publicKey:$,publicKeyUncompressed:P}=l,g=B.length,w=B[0],x=B.subarray(1);if(g===$&&(w===2||w===3)){const O=i.fromBytes(x);if(!i.isValid(O))throw new Error("bad point: is not on curve, wrong x");const _=y(O);let S;try{S=i.sqrt(_)}catch(j){const V=j instanceof Error?": "+j.message:"";throw new Error("bad point: is not on curve, sqrt error"+V)}u();const N=i.isOdd(S);return(w&1)===1!==N&&(S=i.neg(S)),{x:O,y:S}}else if(g===P&&w===4){const O=i.BYTES,_=i.fromBytes(x.subarray(0,O)),S=i.fromBytes(x.subarray(O,O*2));if(!m(_,S))throw new Error("bad point: is not on curve");return{x:_,y:S}}else throw new Error(`bad point: got length ${g}, expected compressed=${$} or uncompressed=${P}`)}const p=e.toBytes||h,d=e.fromBytes||f;function y(B){const $=i.sqr(B),P=i.mul($,B);return i.add(i.add(P,i.mul(B,s.a)),s.b)}function m(B,$){const P=i.sqr($),g=y(B);return i.eql(P,g)}if(!m(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const v=i.mul(i.pow(s.a,An),I_),I=i.mul(i.sqr(s.b),BigInt(27));if(i.is0(i.add(v,I)))throw new Error("bad curve params: a or b");function b(B,$,P=!1){if(!i.isValid($)||P&&i.is0($))throw new Error(`bad point coordinate ${B}`);return $}function E(B){if(!(B instanceof A))throw new Error("ProjectivePoint expected")}function D(B){if(!c||!c.basises)throw new Error("no endo");return x_(B,c.basises,n.ORDER)}const C=Eu((B,$)=>{const{X:P,Y:g,Z:w}=B;if(i.eql(w,i.ONE))return{x:P,y:g};const x=B.is0();$==null&&($=x?i.ONE:i.inv(w));const O=i.mul(P,$),_=i.mul(g,$),S=i.mul(w,$);if(x)return{x:i.ZERO,y:i.ZERO};if(!i.eql(S,i.ONE))throw new Error("invZ was invalid");return{x:O,y:_}}),T=Eu(B=>{if(B.is0()){if(e.allowInfinityPoint&&!i.is0(B.Y))return;throw new Error("bad point: ZERO")}const{x:$,y:P}=B.toAffine();if(!i.isValid($)||!i.isValid(P))throw new Error("bad point: x or y not field elements");if(!m($,P))throw new Error("bad point: equation left != right");if(!B.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(B,$,P,g,w){return P=new A(i.mul(P.X,B),P.Y,P.Z),$=ss(g,$),P=ss(w,P),$.add(P)}class A{constructor($,P,g){this.X=b("x",$),this.Y=b("y",P,!0),this.Z=b("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine($){const{x:P,y:g}=$||{};if(!$||!i.isValid(P)||!i.isValid(g))throw new Error("invalid affine point");if($ instanceof A)throw new Error("projective point not allowed");return i.is0(P)&&i.is0(g)?A.ZERO:new A(P,g,i.ONE)}static fromBytes($){const P=A.fromAffine(d(Lr($,void 0,"point")));return P.assertValidity(),P}static fromHex($){return A.fromBytes(je("pointHex",$))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute($=8,P=!0){return U.createCache(this,$),P||this.multiply(An),this}assertValidity(){T(this)}hasEvenY(){const{y:$}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd($)}equals($){E($);const{X:P,Y:g,Z:w}=this,{X:x,Y:O,Z:_}=$,S=i.eql(i.mul(P,_),i.mul(x,w)),N=i.eql(i.mul(g,_),i.mul(O,w));return S&&N}negate(){return new A(this.X,i.neg(this.Y),this.Z)}double(){const{a:$,b:P}=s,g=i.mul(P,An),{X:w,Y:x,Z:O}=this;let _=i.ZERO,S=i.ZERO,N=i.ZERO,j=i.mul(w,w),V=i.mul(x,x),q=i.mul(O,O),M=i.mul(w,x);return M=i.add(M,M),N=i.mul(w,O),N=i.add(N,N),_=i.mul($,N),S=i.mul(g,q),S=i.add(_,S),_=i.sub(V,S),S=i.add(V,S),S=i.mul(_,S),_=i.mul(M,_),N=i.mul(g,N),q=i.mul($,q),M=i.sub(j,q),M=i.mul($,M),M=i.add(M,N),N=i.add(j,j),j=i.add(N,j),j=i.add(j,q),j=i.mul(j,M),S=i.add(S,j),q=i.mul(x,O),q=i.add(q,q),j=i.mul(q,M),_=i.sub(_,j),N=i.mul(q,V),N=i.add(N,N),N=i.add(N,N),new A(_,S,N)}add($){E($);const{X:P,Y:g,Z:w}=this,{X:x,Y:O,Z:_}=$;let S=i.ZERO,N=i.ZERO,j=i.ZERO;const V=s.a,q=i.mul(s.b,An);let M=i.mul(P,x),H=i.mul(g,O),G=i.mul(w,_),Z=i.add(P,g),W=i.add(x,O);Z=i.mul(Z,W),W=i.add(M,H),Z=i.sub(Z,W),W=i.add(P,w);let J=i.add(x,_);return W=i.mul(W,J),J=i.add(M,G),W=i.sub(W,J),J=i.add(g,w),S=i.add(O,_),J=i.mul(J,S),S=i.add(H,G),J=i.sub(J,S),j=i.mul(V,W),S=i.mul(q,G),j=i.add(S,j),S=i.sub(H,j),j=i.add(H,j),N=i.mul(S,j),H=i.add(M,M),H=i.add(H,M),G=i.mul(V,G),W=i.mul(q,W),H=i.add(H,G),G=i.sub(M,G),G=i.mul(V,G),W=i.add(W,G),M=i.mul(H,W),N=i.add(N,M),M=i.mul(J,W),S=i.mul(Z,S),S=i.sub(S,M),M=i.mul(Z,H),j=i.mul(J,j),j=i.add(j,M),new A(S,N,j)}subtract($){return this.add($.negate())}is0(){return this.equals(A.ZERO)}multiply($){const{endo:P}=e;if(!n.isValidNot0($))throw new Error("invalid scalar: out of range");let g,w;const x=O=>U.cached(this,O,_=>bo(A,_));if(P){const{k1neg:O,k1:_,k2neg:S,k2:N}=D($),{p:j,f:V}=x(_),{p:q,f:M}=x(N);w=V.add(M),g=R(P.beta,j,q,O,S)}else{const{p:O,f:_}=x($);g=O,w=_}return bo(A,[g,w])[0]}multiplyUnsafe($){const{endo:P}=e,g=this;if(!n.isValid($))throw new Error("invalid scalar: out of range");if($===tr||g.is0())return A.ZERO;if($===yi)return g;if(U.hasCache(this))return this.multiply($);if(P){const{k1neg:w,k1:x,k2neg:O,k2:_}=D($),{p1:S,p2:N}=u_(A,g,x,_);return R(P.beta,S,N,w,O)}else return U.unsafe(g,$)}multiplyAndAddUnsafe($,P,g){const w=this.multiplyUnsafe(P).add($.multiplyUnsafe(g));return w.is0()?void 0:w}toAffine($){return C(this,$)}isTorsionFree(){const{isTorsionFree:$}=e;return o===yi?!0:$?$(A,this):U.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:$}=e;return o===yi?this:$?$(A,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes($=!0){return is($,"isCompressed"),this.assertValidity(),p(A,this,$)}toHex($=!0){return gi(this.toBytes($))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes($=!0){return this.toBytes($)}_setWindowSize($){this.precompute($)}static normalizeZ($){return bo(A,$)}static msm($,P){return h_(A,n,$,P)}static fromPrivateKey($){return A.BASE.multiply(li(n,$))}}A.BASE=new A(s.Gx,s.Gy,i.ONE),A.ZERO=new A(i.ZERO,i.ONE,i.ZERO),A.Fp=i,A.Fn=n;const k=n.BITS,U=new l_(A,e.endo?Math.ceil(k/2):k);return A.BASE.precompute(8),A}function Ip(t){return Uint8Array.of(t?2:3)}function Sp(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function $_(t,e={}){const{Fn:r}=t,i=e.randomBytes||Zr,n=Object.assign(Sp(t.Fp,r),{seed:bp(r.ORDER)});function s(f){try{return!!li(r,f)}catch{return!1}}function o(f,p){const{publicKey:d,publicKeyUncompressed:y}=n;try{const m=f.length;return p===!0&&m!==d||p===!1&&m!==y?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=i(n.seed)){return o_(Lr(f,n.seed,"seed"),r.ORDER)}function c(f,p=!0){return t.BASE.multiply(li(r,f)).toBytes(p)}function l(f){const p=a(f);return{secretKey:p,publicKey:c(p)}}function u(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:p,publicKey:d,publicKeyUncompressed:y}=n;if(r.allowedLengths||p===d)return;const m=je("key",f).length;return m===d||m===y}function h(f,p,d=!0){if(u(f)===!0)throw new Error("first arg must be private key");if(u(p)===!1)throw new Error("second arg must be public key");const y=li(r,f);return t.fromHex(p).multiply(y).toBytes(d)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:f=>li(r,f),precompute(f=8,p=t.BASE){return p.precompute(f,!1)}},lengths:n})}function O_(t,e,r={}){Es(e),Ds(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=r.randomBytes||Zr,n=r.hmac||((P,...g)=>Ss(e,P,br(...g))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:p}=$_(t,r),d={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},y="compact";function m(P){const g=a>>yi;return P>g}function v(P,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${P}: out of range 1..Point.Fn.ORDER`);return g}function I(P,g){va(g);const w=p.signature,x=g==="compact"?w:g==="recovered"?w+1:void 0;return Lr(P,x,`${g} signature`)}class b{constructor(g,w,x){this.r=v("r",g),this.s=v("s",w),x!=null&&(this.recovery=x),Object.freeze(this)}static fromBytes(g,w=y){I(g,w);let x;if(w==="der"){const{r:N,s:j}=Qt.toSig(Lr(g));return new b(N,j)}w==="recovered"&&(x=g[0],w="compact",g=g.subarray(1));const O=o.BYTES,_=g.subarray(0,O),S=g.subarray(O,O*2);return new b(o.fromBytes(_),o.fromBytes(S),x)}static fromHex(g,w){return this.fromBytes(ts(g),w)}addRecoveryBit(g){return new b(this.r,this.s,g)}recoverPublicKey(g){const w=s.ORDER,{r:x,s:O,recovery:_}=this;if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");if(a*_p<w&&_>1)throw new Error("recovery id is ambiguous for h>1 curve");const S=_===2||_===3?x+a:x;if(!s.isValid(S))throw new Error("recovery id 2 or 3 invalid");const N=s.toBytes(S),j=t.fromBytes(br(Ip((_&1)===0),N)),V=o.inv(S),q=D(je("msgHash",g)),M=o.create(-q*V),H=o.create(O*V),G=t.BASE.multiplyUnsafe(M).add(j.multiplyUnsafe(H));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return m(this.s)}toBytes(g=y){if(va(g),g==="der")return ts(Qt.hexFromSig(this));const w=o.toBytes(this.r),x=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return br(Uint8Array.of(this.recovery),w,x)}return br(w,x)}toHex(g){return gi(this.toBytes(g))}assertValidity(){}static fromCompact(g){return b.fromBytes(je("sig",g),"compact")}static fromDER(g){return b.fromBytes(je("sig",g),"der")}normalizeS(){return this.hasHighS()?new b(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return gi(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return gi(this.toBytes("compact"))}}const E=r.bits2int||function(P){if(P.length>8192)throw new Error("input is too large");const g=Os(P),w=P.length*8-c;return w>0?g>>BigInt(w):g},D=r.bits2int_modN||function(P){return o.create(E(P))},C=hn(c);function T(P){return ma("num < 2^"+c,P,tr,C),o.toBytes(P)}function R(P,g){return Lr(P,void 0,"message"),g?Lr(e(P),void 0,"prehashed message"):P}function A(P,g,w){if(["recovered","canonical"].some(H=>H in w))throw new Error("sign() legacy options not supported");const{lowS:x,prehash:O,extraEntropy:_}=_o(w,d);P=R(P,O);const S=D(P),N=li(o,g),j=[T(N),T(S)];if(_!=null&&_!==!1){const H=_===!0?i(p.secretKey):_;j.push(je("extraEntropy",H))}const V=br(...j),q=S;function M(H){const G=E(H);if(!o.isValidNot0(G))return;const Z=o.inv(G),W=t.BASE.multiply(G).toAffine(),J=o.create(W.x);if(J===tr)return;const ue=o.create(Z*o.create(q+J*N));if(ue===tr)return;let ye=(W.x===J?0:2)|Number(W.y&yi),be=ue;return x&&m(ue)&&(be=o.neg(ue),ye^=1),new b(J,be,ye)}return{seed:V,k2sig:M}}function k(P,g,w={}){P=je("message",P);const{seed:x,k2sig:O}=A(P,g,w);return Jx(e.outputLen,o.BYTES,n)(x,O)}function U(P){let g;const w=typeof P=="string"||vs(P),x=!w&&P!==null&&typeof P=="object"&&typeof P.r=="bigint"&&typeof P.s=="bigint";if(!w&&!x)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(x)g=new b(P.r,P.s);else if(w){try{g=b.fromBytes(je("sig",P),"der")}catch(O){if(!(O instanceof Qt.Err))throw O}if(!g)try{g=b.fromBytes(je("sig",P),"compact")}catch{return!1}}return g||!1}function B(P,g,w,x={}){const{lowS:O,prehash:_,format:S}=_o(x,d);if(w=je("publicKey",w),g=R(je("message",g),_),"strict"in x)throw new Error("options.strict was renamed to lowS");const N=S===void 0?U(P):b.fromBytes(je("sig",P),S);if(N===!1)return!1;try{const j=t.fromBytes(w);if(O&&N.hasHighS())return!1;const{r:V,s:q}=N,M=D(g),H=o.inv(q),G=o.create(M*H),Z=o.create(V*H),W=t.BASE.multiplyUnsafe(G).add(j.multiplyUnsafe(Z));return W.is0()?!1:o.create(W.x)===V}catch{return!1}}function $(P,g,w={}){const{prehash:x}=_o(w,d);return g=R(g,x),b.fromBytes(P,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:p,Point:t,sign:k,verify:B,recoverPublicKey:$,Signature:b,hash:e})}function D_(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let i=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const n=Ar(e.n,{BITS:t.nBitLength,allowedLengths:i,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:n,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function A_(t){const{CURVE:e,curveOpts:r}=D_(t),i={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:i}}function P_(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,wp(r.Fn.ORDER,r.Fn.BITS))})}function C_(t){const{CURVE:e,curveOpts:r,hash:i,ecdsaOpts:n}=A_(t),s=S_(e,r),o=O_(s,i,n);return P_(t,o)}function Ea(t,e){const r=i=>C_({...t,hash:i});return{...r(e),create:r}}const $p={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Op={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Dp={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},B_=Ar($p.p),T_=Ar(Op.p),R_=Ar(Dp.p),N_=Ea({...$p,Fp:B_,lowS:!1},_s);Ea({...Op,Fp:T_,lowS:!1},q2),Ea({...Dp,Fp:R_,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},F2);const U_=N_,Ap="base10",Me="base16",Ge="base64pad",vr="base64url",fn="utf8",Pp=0,nr=1,dn=2,j_=0,Au=1,Vi=12,vc=32;function k_(){const t=ba.utils.randomPrivateKey(),e=ba.getPublicKey(t);return{privateKey:Je(t,Me),publicKey:Je(e,Me)}}function xa(){const t=Zr(vc);return Je(t,Me)}function F_(t,e){const r=ba.getSharedSecret(gt(t,Me),gt(e,Me)),i=Yx($s,r,void 0,void 0,vc);return Je(i,Me)}function Mn(t){const e=$s(gt(t,Me));return Je(e,Me)}function dt(t){const e=$s(gt(t,fn));return Je(e,Me)}function Cp(t){return gt(`${t}`,Ap)}function Yr(t){return Number(Je(t,Ap))}function Bp(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Tp(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function q_(t){const e=Cp(typeof t.type<"u"?t.type:Pp);if(Yr(e)===nr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?gt(t.senderPublicKey,Me):void 0,i=typeof t.iv<"u"?gt(t.iv,Me):Zr(Vi),n=gt(t.symKey,Me),s=sp(n,i).encrypt(gt(t.message,fn)),o=Rp({type:e,sealed:s,iv:i,senderPublicKey:r});return t.encoding===vr?Bp(o):o}function M_(t){const e=gt(t.symKey,Me),{sealed:r,iv:i}=en({encoded:t.encoded,encoding:t.encoding}),n=sp(e,i).decrypt(r);if(n===null)throw new Error("Failed to decrypt");return Je(n,fn)}function L_(t,e){const r=Cp(dn),i=Zr(Vi),n=gt(t,fn),s=Rp({type:r,sealed:n,iv:i});return e===vr?Bp(s):s}function z_(t,e){const{sealed:r}=en({encoded:t,encoding:e});return Je(r,fn)}function Rp(t){if(Yr(t.type)===dn)return Je(zi([t.type,t.sealed]),Ge);if(Yr(t.type)===nr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Je(zi([t.type,t.senderPublicKey,t.iv,t.sealed]),Ge)}return Je(zi([t.type,t.iv,t.sealed]),Ge)}function en(t){const e=(t.encoding||Ge)===vr?Tp(t.encoded):t.encoded,r=gt(e,Ge),i=r.slice(j_,Au),n=Au;if(Yr(i)===nr){const c=n+vc,l=c+Vi,u=r.slice(n,c),h=r.slice(c,l),f=r.slice(l);return{type:i,sealed:f,iv:h,senderPublicKey:u}}if(Yr(i)===dn){const c=r.slice(n),l=Zr(Vi);return{type:i,sealed:c,iv:l}}const s=n+Vi,o=r.slice(n,s),a=r.slice(s);return{type:i,sealed:a,iv:o}}function V_(t,e){const r=en({encoded:t,encoding:e?.encoding});return Np({type:Yr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Je(r.senderPublicKey,Me):void 0,receiverPublicKey:e?.receiverPublicKey})}function Np(t){const e=t?.type||Pp;if(e===nr){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Pu(t){return t.type===nr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Cu(t){return t.type===dn}function K_(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return zi([new Uint8Array([4]),e,r])}function H_(t,e){const[r,i,n]=t.split("."),s=Buffer.from(Tp(n),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${i}`,l=$s(c),u=K_(e);if(!U_.verify(zi([o,a]),l,u))throw new Error("Invalid signature");return oa(t).payload}const W_="irn";function os(t){return t?.relay||{protocol:W_}}function ui(t){const e=kv[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var G_=Object.defineProperty,Y_=Object.defineProperties,Z_=Object.getOwnPropertyDescriptors,Bu=Object.getOwnPropertySymbols,J_=Object.prototype.hasOwnProperty,X_=Object.prototype.propertyIsEnumerable,Tu=(t,e,r)=>e in t?G_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Io=(t,e)=>{for(var r in e||(e={}))J_.call(e,r)&&Tu(t,r,e[r]);if(Bu)for(var r of Bu(e))X_.call(e,r)&&Tu(t,r,e[r]);return t},Q_=(t,e)=>Y_(t,Z_(e));function e3(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),o=t[n];r[s]=o}}),r}function Ru(t){if(!t.includes("wc:")){const l=kd(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:t3(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:e3(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function t3(t){return t.startsWith("//")?t.substring(2):t}function r3(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const s=n,o=r+e+s;t[s]&&(i[o]=t[s])}),i}function Nu(t){const e=new URLSearchParams,r=Io(Io(Q_(Io({},r3(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([i],[n])=>i.localeCompare(n)).forEach(([i,n])=>{n!==void 0&&e.append(i,String(n))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function Pn(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var i3=Object.defineProperty,n3=Object.defineProperties,s3=Object.getOwnPropertyDescriptors,Uu=Object.getOwnPropertySymbols,o3=Object.prototype.hasOwnProperty,a3=Object.prototype.propertyIsEnumerable,ju=(t,e,r)=>e in t?i3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,c3=(t,e)=>{for(var r in e||(e={}))o3.call(e,r)&&ju(t,r,e[r]);if(Uu)for(var r of Uu(e))a3.call(e,r)&&ju(t,r,e[r]);return t},l3=(t,e)=>n3(t,s3(e));function _i(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function Up(t){const e=[];return Object.values(t).forEach(r=>{e.push(..._i(r.accounts))}),[...new Set(e)]}function u3(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.methods)}),[...new Set(e)]}function h3(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.events)}),[...new Set(e)]}function f3(t,e){const r=[];return Object.values(t).forEach(i=>{_i(i.accounts).includes(e)&&r.push(...i.methods)}),r}function d3(t,e){const r=[];return Object.values(t).forEach(i=>{_i(i.accounts).includes(e)&&r.push(...i.events)}),r}function As(t){return t.includes(":")}function hi(t){return As(t)?t.split(":")[0]:t}function ku(t){var e,r,i;const n={};if(!qt(t))return n;for(const[s,o]of Object.entries(t)){const a=As(s)?[s]:o.chains,c=o.methods||[],l=o.events||[],u=hi(s);n[u]=l3(c3({},n[u]),{chains:Ft(a,(e=n[u])==null?void 0:e.chains),methods:Ft(c,(r=n[u])==null?void 0:r.methods),events:Ft(l,(i=n[u])==null?void 0:i.events)})}return n}function p3(t){const e={};return t?.forEach(r=>{var i;const[n,s]=r.split(":");e[n]||(e[n]={accounts:[],chains:[],events:[],methods:[]}),e[n].accounts.push(r),(i=e[n].chains)==null||i.push(`${n}:${s}`)}),e}function Fu(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=p3(e);for(const[i,n]of Object.entries(r))n.methods?n.methods=Ft(n.methods,t):n.methods=t,n.events=["chainChanged","accountsChanged"];return r}function g3(t,e){var r,i,n,s,o,a;const c=ku(t),l=ku(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const f of h)u[f]={chains:Ft((r=c[f])==null?void 0:r.chains,(i=l[f])==null?void 0:i.chains),methods:Ft((n=c[f])==null?void 0:n.methods,(s=l[f])==null?void 0:s.methods),events:Ft((o=c[f])==null?void 0:o.events,(a=l[f])==null?void 0:a.events)};return u}const y3={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},w3={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function z(t,e){const{message:r,code:i}=w3[t];return{message:e?`${r} ${e}`:r,code:i}}function ce(t,e){const{message:r,code:i}=y3[t];return{message:e?`${r} ${e}`:r,code:i}}function yt(t,e){return!!Array.isArray(t)}function qt(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ie(t){return typeof t>"u"}function ge(t,e){return e&&Ie(t)?!0:typeof t=="string"&&!!t.trim().length}function Ec(t,e){return typeof t=="number"&&!isNaN(t)}function m3(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let s=!0;return Mr(n,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=_i(a),h=r[o];(!Mr(Td(o,h),u)||!Mr(h.methods,c)||!Mr(h.events,l))&&(s=!1)}),s):!1}function as(t){return ge(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function b3(t){if(ge(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&as(r)}}return!1}function v3(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(ge(t,!1)){if(e(t))return!0;const r=kd(t);return e(r)}}catch{}return!1}function E3(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function x3(t){return t?.topic}function _3(t,e){let r=null;return ge(t?.publicKey,!1)||(r=z("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function qu(t){let e=!0;return yt(t)?t.length&&(e=t.every(r=>ge(r,!1))):e=!1,e}function I3(t,e,r){let i=null;return yt(e)&&e.length?e.forEach(n=>{i||as(n)||(i=ce("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):as(t)||(i=ce("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function S3(t,e,r){let i=null;return Object.entries(t).forEach(([n,s])=>{if(i)return;const o=I3(n,Td(n,s),`${e} ${r}`);o&&(i=o)}),i}function $3(t,e){let r=null;return yt(t)?t.forEach(i=>{r||b3(i)||(r=ce("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=ce("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function O3(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=$3(i?.accounts,`${e} namespace`);n&&(r=n)}),r}function D3(t,e){let r=null;return qu(t?.methods)?qu(t?.events)||(r=ce("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=ce("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function jp(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=D3(i,`${e}, namespace`);n&&(r=n)}),r}function A3(t,e,r){let i=null;if(t&&qt(t)){const n=jp(t,e);n&&(i=n);const s=S3(t,e,r);s&&(i=s)}else i=z("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function So(t,e){let r=null;if(t&&qt(t)){const i=jp(t,e);i&&(r=i);const n=O3(t,e);n&&(r=n)}else r=z("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function kp(t){return ge(t.protocol,!0)}function P3(t,e){let r=!1;return t?t&&yt(t)&&t.length&&t.forEach(i=>{r=kp(i)}):r=!0,r}function C3(t){return typeof t=="number"}function Ke(t){return typeof t<"u"&&typeof t!==null}function B3(t){return!(!t||typeof t!="object"||!t.code||!Ec(t.code)||!t.message||!ge(t.message,!1))}function T3(t){return!(Ie(t)||!ge(t.method,!1))}function R3(t){return!(Ie(t)||Ie(t.result)&&Ie(t.error)||!Ec(t.id)||!ge(t.jsonrpc,!1))}function N3(t){return!(Ie(t)||!ge(t.name,!1))}function Mu(t,e){return!(!as(e)||!Up(t).includes(e))}function U3(t,e,r){return ge(r,!1)?f3(t,e).includes(r):!1}function j3(t,e,r){return ge(r,!1)?d3(t,e).includes(r):!1}function Lu(t,e,r){let i=null;const n=k3(t),s=F3(e),o=Object.keys(n),a=Object.keys(s),c=zu(Object.keys(t)),l=zu(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Mr(o,a)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||i)return;const f=_i(e[h].accounts);f.includes(h)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{i||(Mr(n[h].methods,s[h].methods)?Mr(n[h].events,s[h].events)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),i}function k3(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function zu(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function F3(t){const e={};return Object.keys(t).forEach(r=>{r.includes(":")?e[r]=t[r]:_i(t[r].accounts)?.forEach(n=>{e[n]={accounts:t[r].accounts.filter(s=>s.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}),e}function q3(t,e){return Ec(t)&&t<=e.max&&t>=e.min}function Vu(){const t=ln();return new Promise(e=>{switch(t){case st.browser:e(M3());break;case st.reactNative:e(L3());break;case st.node:e(z3());break;default:e(!0)}})}function M3(){return xi()&&navigator?.onLine}async function L3(){return Dr()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function z3(){return!0}function V3(t){switch(ln()){case st.browser:K3(t);break;case st.reactNative:H3(t);break}}function K3(t){!Dr()&&xi()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function H3(t){Dr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function W3(){var t;return xi()&&sr.getDocument()?((t=sr.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const $o={};class Bi{static get(e){return $o[e]}static set(e,r){$o[e]=r}static delete(e){delete $o[e]}}function G3(t){const e=on.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function Y3({publicKey:t,signature:e,payload:r}){var i;const n=_a(r.method),s=128|parseInt(((i=r.version)==null?void 0:i.toString())||"4"),o=X3(r.address),a=r.era==="00"?new Uint8Array([0]):_a(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${J3(r.tip)}`),h=eI(u),f=new Uint8Array([0,...t,o,...e,...a,...l,...h,...n]),p=Q3(f.length+1);return new Uint8Array([...p,s,...f])}function Z3(t){const e=_a(t),r=Lv.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function _a(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function J3(t){return t.startsWith("0x")?t.slice(2):t}function X3(t){const e=on.decode(t)[0];return e===42?0:e===60?2:1}function Q3(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function eI(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function tI(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=G3(t.transaction.address),i=Y3({publicKey:r,signature:e,payload:t.transaction}),n=Buffer.from(i).toString("hex");return Z3(n)}function xc({logger:t,name:e}){const r=typeof t=="string"?Bd({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}class Jr{}let rI=class extends Jr{constructor(e){super()}};const Ku=L.FIVE_SECONDS,Xr={pulse:"heartbeat_pulse"};let iI=class Fp extends rI{constructor(e){super(e),this.events=new ot.EventEmitter,this.interval=Ku,this.interval=e?.interval||Ku}static async init(e){const r=new Fp(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),L.toMiliseconds(this.interval))}pulse(){this.events.emit(Xr.pulse)}};const nI=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,sI=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,oI=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function aI(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){cI(t);return}return e}function cI(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Cn(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!oI.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(nI.test(t)||sI.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,aI)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function lI(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function xe(t,...e){try{return lI(t(...e))}catch(r){return Promise.reject(r)}}function uI(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function hI(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Ln(t){if(uI(t))return String(t);if(hI(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Ln(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Ia="base64:";function fI(t){return typeof t=="string"?t:Ia+gI(t)}function dI(t){return typeof t!="string"||!t.startsWith(Ia)?t:pI(t.slice(Ia.length))}function pI(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function gI(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ve(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function yI(...t){return Ve(t.join(":"))}function Bn(t){return t=Ve(t),t?t+":":""}function wI(t,e){if(e===void 0)return!0;let r=0,i=t.indexOf(":");for(;i>-1;)r++,i=t.indexOf(":",i+1);return r<=e}function mI(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const bI="memory",vI=()=>{const t=new Map;return{name:bI,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function EI(t={}){const e={mounts:{"":t.driver||vI()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},i=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),n=(l,u)=>{if(e.watching){u=Ve(u);for(const h of e.watchListeners)h(l,u)}},s=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await Hu(e.mounts[l],n,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const f=new Map,p=d=>{let y=f.get(d.base);return y||(y={driver:d.driver,base:d.base,items:[]},f.set(d.base,y)),y};for(const d of l){const y=typeof d=="string",m=Ve(y?d:d.key),v=y?void 0:d.value,I=y||!d.options?u:{...u,...d.options},b=r(m);p(b).items.push({key:m,value:v,relativeKey:b.relativeKey,options:I})}return Promise.all([...f.values()].map(d=>h(d))).then(d=>d.flat())},c={hasItem(l,u={}){l=Ve(l);const{relativeKey:h,driver:f}=r(l);return xe(f.hasItem,h,u)},getItem(l,u={}){l=Ve(l);const{relativeKey:h,driver:f}=r(l);return xe(f.getItem,h,u).then(p=>Cn(p))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?xe(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),u).then(f=>f.map(p=>({key:yI(h.base,p.key),value:Cn(p.value)}))):Promise.all(h.items.map(f=>xe(h.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:Cn(p)})))))},getItemRaw(l,u={}){l=Ve(l);const{relativeKey:h,driver:f}=r(l);return f.getItemRaw?xe(f.getItemRaw,h,u):xe(f.getItem,h,u).then(p=>dI(p))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=Ve(l);const{relativeKey:f,driver:p}=r(l);p.setItem&&(await xe(p.setItem,f,Ln(u),h),p.watch||n("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return xe(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:Ln(f.value),options:f.options})),u);h.driver.setItem&&await Promise.all(h.items.map(f=>xe(h.driver.setItem,f.relativeKey,Ln(f.value),f.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=Ve(l);const{relativeKey:f,driver:p}=r(l);if(p.setItemRaw)await xe(p.setItemRaw,f,u,h);else if(p.setItem)await xe(p.setItem,f,fI(u),h);else return;p.watch||n("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=Ve(l);const{relativeKey:h,driver:f}=r(l);f.removeItem&&(await xe(f.removeItem,h,u),(u.removeMeta||u.removeMata)&&await xe(f.removeItem,h+"$",u),f.watch||n("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=Ve(l);const{relativeKey:h,driver:f}=r(l),p=Object.create(null);if(f.getMeta&&Object.assign(p,await xe(f.getMeta,h,u)),!u.nativeOnly){const d=await xe(f.getItem,h+"$",u).then(y=>Cn(y));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){l=Bn(l);const h=i(l,!0);let f=[];const p=[];let d=!0;for(const m of h){m.driver.flags?.maxDepth||(d=!1);const v=await xe(m.driver.getKeys,m.relativeBase,u);for(const I of v){const b=m.mountpoint+Ve(I);f.some(E=>b.startsWith(E))||p.push(b)}f=[m.mountpoint,...f.filter(I=>!I.startsWith(m.mountpoint))]}const y=u.maxDepth!==void 0&&!d;return p.filter(m=>(!y||wI(m,u.maxDepth))&&mI(m,l))},async clear(l,u={}){l=Bn(l),await Promise.all(i(l,!1).map(async h=>{if(h.driver.clear)return xe(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(f.map(p=>h.driver.removeItem(p,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Wu(l)))},async watch(l){return await s(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=Bn(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(Hu(u,n,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){l=Bn(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&(e.unwatch[l]?.(),delete e.unwatch[l]),u&&await Wu(e.mounts[l]),e.mountpoints=e.mountpoints.filter(h=>h!==l),delete e.mounts[l])},getMount(l=""){l=Ve(l)+":";const u=r(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=Ve(l),i(l,u.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function Hu(t,e,r){return t.watch?t.watch((i,n)=>e(i,r+n)):()=>{}}async function Wu(t){typeof t.dispose=="function"&&await xe(t.dispose)}function Qr(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function qp(t,e){let r;const i=()=>{if(r)return r;const n=indexedDB.open(t);return n.onupgradeneeded=()=>n.result.createObjectStore(e),r=Qr(n),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(n,s)=>i().then(o=>s(o.transaction(e,n).objectStore(e)))}let Oo;function pn(){return Oo||(Oo=qp("keyval-store","keyval")),Oo}function Gu(t,e=pn()){return e("readonly",r=>Qr(r.get(t)))}function xI(t,e,r=pn()){return r("readwrite",i=>(i.put(e,t),Qr(i.transaction)))}function _I(t,e=pn()){return e("readwrite",r=>(r.delete(t),Qr(r.transaction)))}function II(t=pn()){return t("readwrite",e=>(e.clear(),Qr(e.transaction)))}function SI(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Qr(t.transaction)}function $I(t=pn()){return t("readonly",e=>{if(e.getAllKeys)return Qr(e.getAllKeys());const r=[];return SI(e,i=>r.push(i.key)).then(()=>r)})}const OI="idb-keyval";var DI=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=n=>e+n;let i;return t.dbName&&t.storeName&&(i=qp(t.dbName,t.storeName)),{name:OI,options:t,async hasItem(n){return!(typeof await Gu(r(n),i)>"u")},async getItem(n){return await Gu(r(n),i)??null},setItem(n,s){return xI(r(n),s,i)},removeItem(n){return _I(r(n),i)},getKeys(){return $I(i)},clear(){return II(i)}}};const AI="WALLET_CONNECT_V2_INDEXED_DB",PI="keyvaluestorage";let CI=class{constructor(){this.indexedDb=EI({driver:DI({dbName:AI,storeName:PI})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Wr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Do=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},zn={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Do<"u"&&Do.localStorage?zn.exports=Do.localStorage:typeof window<"u"&&window.localStorage?zn.exports=window.localStorage:zn.exports=new e})();function BI(t){var e;return[t[0],Hr((e=t[1])!=null?e:"")]}let TI=class{constructor(){this.localStorage=zn.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(BI)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Hr(r)}async setItem(e,r){this.localStorage.setItem(e,Wr(r))}async removeItem(e){this.localStorage.removeItem(e)}};const RI="wc_storage_version",Yu=1,NI=async(t,e,r)=>{const i=RI,n=await e.getItem(i);if(n&&n>=Yu){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(i,Yu),r(e),UI(t,o)},UI=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let jI=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new TI;this.storage=e;try{const r=new CI;NI(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var kI=Object.defineProperty,FI=(t,e,r)=>e in t?kI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zu=(t,e,r)=>FI(t,typeof e!="symbol"?e+"":e,r);let qI=class extends Jr{constructor(e){super(),this.opts=e,Zu(this,"protocol","wc"),Zu(this,"version",2)}};var MI=Object.defineProperty,LI=(t,e,r)=>e in t?MI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zI=(t,e,r)=>LI(t,e+"",r);let VI=class extends Jr{constructor(e,r){super(),this.core=e,this.logger=r,zI(this,"records",new Map)}},KI=class{constructor(e,r){this.logger=e,this.core=r}};class HI extends Jr{constructor(e,r){super(),this.relayer=e,this.logger=r}}let WI=class extends Jr{constructor(e){super()}},GI=class{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}},YI=class extends Jr{constructor(e,r){super(),this.relayer=e,this.logger=r}},ZI=class extends Jr{constructor(e,r){super(),this.core=e,this.logger=r}},JI=class{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}},XI=class{constructor(e,r){this.projectId=e,this.logger=r}},QI=class{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}};var eS=Object.defineProperty,tS=(t,e,r)=>e in t?eS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ju=(t,e,r)=>tS(t,typeof e!="symbol"?e+"":e,r);let rS=class{constructor(e){this.opts=e,Ju(this,"protocol","wc"),Ju(this,"version",2)}},iS=class{constructor(e){this.client=e}};const nS="PARSE_ERROR",sS="INVALID_REQUEST",oS="METHOD_NOT_FOUND",aS="INVALID_PARAMS",Mp="INTERNAL_ERROR",_c="SERVER_ERROR",cS=[-32700,-32600,-32601,-32602,-32603],Ki={[nS]:{code:-32700,message:"Parse error"},[sS]:{code:-32600,message:"Invalid Request"},[oS]:{code:-32601,message:"Method not found"},[aS]:{code:-32602,message:"Invalid params"},[Mp]:{code:-32603,message:"Internal error"},[_c]:{code:-32e3,message:"Server error"}},Lp=_c;function lS(t){return cS.includes(t)}function Xu(t){return Object.keys(Ki).includes(t)?Ki[t]:Ki[Lp]}function uS(t){const e=Object.values(Ki).find(r=>r.code===t);return e||Ki[Lp]}function zp(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Ao={};var Sa=function(t,e){return Sa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Sa(t,e)};function hS(t,e){Sa(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var $a=function(){return $a=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},$a.apply(this,arguments)};function fS(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function dS(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function pS(t,e){return function(r,i){e(r,i,t)}}function gS(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function yS(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(h){o(h)}}function c(u){try{l(i.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):n(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function wS(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function mS(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function bS(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Oa(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Vp(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function vS(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Vp(arguments[e]));return t}function ES(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function tn(t){return this instanceof tn?(this.v=t,this):new tn(t)}function xS(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(f){i[f]&&(n[f]=function(p){return new Promise(function(d,y){s.push([f,p,d,y])>1||a(f,p)})})}function a(f,p){try{c(i[f](p))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof tn?Promise.resolve(f.value.v).then(l,u):h(s[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function _S(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:tn(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function IS(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Oa=="function"?Oa(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function SS(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function $S(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function OS(t){return t&&t.__esModule?t:{default:t}}function DS(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function AS(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const PS=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return $a},__asyncDelegator:_S,__asyncGenerator:xS,__asyncValues:IS,__await:tn,__awaiter:yS,__classPrivateFieldGet:DS,__classPrivateFieldSet:AS,__createBinding:mS,__decorate:dS,__exportStar:bS,__extends:hS,__generator:wS,__importDefault:OS,__importStar:$S,__makeTemplateObject:SS,__metadata:gS,__param:pS,__read:Vp,__rest:fS,__spread:vS,__spreadArrays:ES,__values:Oa},Symbol.toStringTag,{value:"Module"})),CS=uf(PS);var Wt={},Qu;function BS(){if(Qu)return Wt;Qu=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.isBrowserCryptoAvailable=Wt.getSubtleCrypto=Wt.getBrowerCrypto=void 0;function t(){return(Nt===null||Nt===void 0?void 0:Nt.crypto)||(Nt===null||Nt===void 0?void 0:Nt.msCrypto)||{}}Wt.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Wt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Wt.isBrowserCryptoAvailable=r,Wt}var Gt={},eh;function TS(){if(eh)return Gt;eh=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.isBrowser=Gt.isNode=Gt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Gt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Gt.isNode=e;function r(){return!t()&&!e()}return Gt.isBrowser=r,Gt}var th;function RS(){return th||(th=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=CS;e.__exportStar(BS(),t),e.__exportStar(TS(),t)})(Ao)),Ao}var NS=RS();function Tt(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function xr(t=6){return BigInt(Tt(t))}function It(t,e,r){return{id:r||Tt(),jsonrpc:"2.0",method:t,params:e}}function rn(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Ps(t,e,r){return{id:t,jsonrpc:"2.0",error:US(e)}}function US(t,e){return typeof t>"u"?Xu(Mp):(typeof t=="string"&&(t=Object.assign(Object.assign({},Xu(_c)),{message:t})),lS(t.code)&&(t=uS(t.code)),t)}class jS{}class kS extends jS{constructor(){super()}}class FS extends kS{constructor(e){super()}}const qS="^https?:",MS="^wss?:";function LS(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Kp(t,e){const r=LS(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function rh(t){return Kp(t,qS)}function ih(t){return Kp(t,MS)}function zS(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Hp(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Ic(t){return Hp(t)&&"method"in t}function Cs(t){return Hp(t)&&(Rt(t)||pt(t))}function Rt(t){return"result"in t}function pt(t){return"error"in t}let Sc=class extends FS{constructor(e){super(e),this.events=new ot.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(It(e.method,e.params||[],e.id||xr().toString()),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{pt(s)?n(s.error):i(s.result)});try{await this.connection.send(e,r)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Cs(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const VS=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),KS=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",nh=t=>t.split("?")[0],sh=10,HS=VS();let WS=class{constructor(e){if(this.url=e,this.events=new ot.EventEmitter,this.registering=!1,!ih(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Wr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!ih(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=NS.isReactNative()?void 0:{rejectUnauthorized:!zS(e)},s=new HS(e,[],n);KS()?s.onerror=o=>{const a=o;i(this.emitError(a.error))}:s.on("error",o=>{i(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Hr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=Ps(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return zp(e,nh(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>sh&&this.events.setMaxListeners(sh)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${nh(this.url)}`));return this.events.emit("register_error",r),r}};var GS={};const Wp="wc",Gp=2,Da="core",Mt=`${Wp}@2:${Da}:`,YS={logger:"error"},ZS={database:":memory:"},JS="crypto",oh="client_ed25519_seed",XS=L.ONE_DAY,QS="keychain",e8="0.3",t8="messages",r8="0.3",i8=L.SIX_HOURS,n8="publisher",Yp="irn",s8="error",Zp="wss://relay.walletconnect.org",o8="relayer",pe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},a8="_subscription",lt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},c8=.1,Aa="2.23.4",ae={link_mode:"link_mode",relay:"relay"},Vn={inbound:"inbound",outbound:"outbound"},l8="0.3",u8="WALLETCONNECT_CLIENT_ID",ah="WALLETCONNECT_LINK_MODE_APPS",rt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},h8="subscription",f8="0.3",d8="pairing",p8="0.3",Ti={wc_pairingDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:L.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:L.ONE_DAY,prompt:!1,tag:0},res:{ttl:L.ONE_DAY,prompt:!1,tag:0}}},Fr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},bt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},g8="history",y8="0.3",w8="expirer",ht={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},m8="0.3",b8="verify-api",v8="https://verify.walletconnect.com",Jp="https://verify.walletconnect.org",Hi=Jp,E8=`${Hi}/v3`,x8=[v8,Jp],_8="echo",I8="https://echo.walletconnect.com",Bt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Zt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},vt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Tr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Rr={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Ri={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},S8=.1,$8="event-client",O8=86400,D8="https://pulse.walletconnect.org/batch";function A8(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var y=0,m=0,v=0,I=d.length;v!==I&&d[v]===0;)v++,y++;for(var b=(I-v)*u+1>>>0,E=new Uint8Array(b);v!==I;){for(var D=d[v],C=0,T=b-1;(D!==0||C<m)&&T!==-1;T--,C++)D+=256*E[T]>>>0,E[T]=D%a>>>0,D=D/a>>>0;if(D!==0)throw new Error("Non-zero carry");m=C,v++}for(var R=b-m;R!==b&&E[R]===0;)R++;for(var A=c.repeat(y);R<b;++R)A+=t.charAt(E[R]);return A}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var y=0;if(d[y]!==" "){for(var m=0,v=0;d[y]===c;)m++,y++;for(var I=(d.length-y)*l+1>>>0,b=new Uint8Array(I);d[y];){var E=r[d.charCodeAt(y)];if(E===255)return;for(var D=0,C=I-1;(E!==0||D<v)&&C!==-1;C--,D++)E+=a*b[C]>>>0,b[C]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");v=D,y++}if(d[y]!==" "){for(var T=I-v;T!==I&&b[T]===0;)T++;for(var R=new Uint8Array(m+(I-T)),A=m;T!==I;)R[A++]=b[T++];return R}}}function p(d){var y=f(d);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var P8=A8,C8=P8;const Xp=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},B8=t=>new TextEncoder().encode(t),T8=t=>new TextDecoder().decode(t);class R8{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class N8{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Qp(this,e)}}class U8{constructor(e){this.decoders=e}or(e){return Qp(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Qp=(t,e)=>new U8({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class j8{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new R8(e,r,i),this.decoder=new N8(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Bs=({name:t,prefix:e,encode:r,decode:i})=>new j8(t,e,r,i),gn=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=C8(r,e);return Bs({prefix:t,name:e,encode:i,decode:s=>Xp(n(s))})},k8=(t,e,r,i)=>{const n={};for(let u=0;u<e.length;++u)n[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=n[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},F8=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Be=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Bs({prefix:e,name:t,encode(n){return F8(n,i,r)},decode(n){return k8(n,i,r,t)}}),q8=Bs({prefix:"\0",name:"identity",encode:t=>T8(t),decode:t=>B8(t)});var M8=Object.freeze({__proto__:null,identity:q8});const L8=Be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var z8=Object.freeze({__proto__:null,base2:L8});const V8=Be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var K8=Object.freeze({__proto__:null,base8:V8});const H8=gn({prefix:"9",name:"base10",alphabet:"0123456789"});var W8=Object.freeze({__proto__:null,base10:H8});const G8=Be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Y8=Be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Z8=Object.freeze({__proto__:null,base16:G8,base16upper:Y8});const J8=Be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),X8=Be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Q8=Be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),e$=Be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),t$=Be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),r$=Be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),i$=Be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),n$=Be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),s$=Be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var o$=Object.freeze({__proto__:null,base32:J8,base32upper:X8,base32pad:Q8,base32padupper:e$,base32hex:t$,base32hexupper:r$,base32hexpad:i$,base32hexpadupper:n$,base32z:s$});const a$=gn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),c$=gn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var l$=Object.freeze({__proto__:null,base36:a$,base36upper:c$});const u$=gn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),h$=gn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var f$=Object.freeze({__proto__:null,base58btc:u$,base58flickr:h$});const d$=Be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),p$=Be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),g$=Be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),y$=Be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var w$=Object.freeze({__proto__:null,base64:d$,base64pad:p$,base64url:g$,base64urlpad:y$});const eg=Array.from(""),m$=eg.reduce((t,e,r)=>(t[r]=e,t),[]),b$=eg.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function v$(t){return t.reduce((e,r)=>(e+=m$[r],e),"")}function E$(t){const e=[];for(const r of t){const i=b$[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const x$=Bs({prefix:"",name:"base256emoji",encode:v$,decode:E$});var _$=Object.freeze({__proto__:null,base256emoji:x$}),I$=tg,ch=128,S$=-128,$$=Math.pow(2,31);function tg(t,e,r){e=e||[],r=r||0;for(var i=r;t>=$$;)e[r++]=t&255|ch,t/=128;for(;t&S$;)e[r++]=t&255|ch,t>>>=7;return e[r]=t|0,tg.bytes=r-i+1,e}var O$=Pa,D$=128,lh=127;function Pa(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw Pa.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&lh)<<n:(o&lh)*Math.pow(2,n),n+=7}while(o>=D$);return Pa.bytes=s-i,r}var A$=Math.pow(2,7),P$=Math.pow(2,14),C$=Math.pow(2,21),B$=Math.pow(2,28),T$=Math.pow(2,35),R$=Math.pow(2,42),N$=Math.pow(2,49),U$=Math.pow(2,56),j$=Math.pow(2,63),k$=function(t){return t<A$?1:t<P$?2:t<C$?3:t<B$?4:t<T$?5:t<R$?6:t<N$?7:t<U$?8:t<j$?9:10},F$={encode:I$,decode:O$,encodingLength:k$},rg=F$;const uh=(t,e,r=0)=>(rg.encode(t,e,r),e),hh=t=>rg.encodingLength(t),Ca=(t,e)=>{const r=e.byteLength,i=hh(t),n=i+hh(r),s=new Uint8Array(n+r);return uh(t,s,0),uh(r,s,i),s.set(e,n),new q$(t,r,e,s)};class q${constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const ig=({name:t,code:e,encode:r})=>new M$(t,e,r);class M${constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ca(this.code,r):r.then(i=>Ca(this.code,i))}else throw Error("Unknown type, must be binary type")}}const ng=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),L$=ig({name:"sha2-256",code:18,encode:ng("SHA-256")}),z$=ig({name:"sha2-512",code:19,encode:ng("SHA-512")});var V$=Object.freeze({__proto__:null,sha256:L$,sha512:z$});const sg=0,K$="identity",og=Xp,H$=t=>Ca(sg,og(t)),W$={code:sg,name:K$,encode:og,digest:H$};var G$=Object.freeze({__proto__:null,identity:W$});new TextEncoder,new TextDecoder;const fh={...M8,...z8,...K8,...W8,...Z8,...o$,...l$,...f$,...w$,..._$};({...V$,...G$});function ag(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Y$(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ag(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function cg(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const dh=cg("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Po=cg("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Y$(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Z$={utf8:dh,"utf-8":dh,hex:fh.base16,latin1:Po,ascii:Po,binary:Po,...fh};function J$(t,e="utf8"){const r=Z$[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ag(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var X$=Object.defineProperty,Q$=(t,e,r)=>e in t?X$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pt=(t,e,r)=>Q$(t,typeof e!="symbol"?e+"":e,r);class eO{constructor(e,r){this.core=e,this.logger=r,Pt(this,"keychain",new Map),Pt(this,"name",QS),Pt(this,"version",e8),Pt(this,"initialized",!1),Pt(this,"storagePrefix",Mt),Pt(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),Pt(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),Pt(this,"set",async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()}),Pt(this,"get",i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n}),Pt(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=at(r,this.name)}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ua(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ha(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var tO=Object.defineProperty,rO=(t,e,r)=>e in t?tO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ve=(t,e,r)=>rO(t,typeof e!="symbol"?e+"":e,r);class iO{constructor(e,r,i){this.core=e,this.logger=r,ve(this,"name",JS),ve(this,"keychain"),ve(this,"randomSessionIdentifier",xa()),ve(this,"initialized",!1),ve(this,"clientId"),ve(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),ve(this,"hasKeys",n=>(this.isInitialized(),this.keychain.has(n))),ve(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const n=await this.getClientSeed(),s=Rl(n),o=xd(s.publicKey);return this.clientId=o,o}),ve(this,"generateKeyPair",()=>{this.isInitialized();const n=k_();return this.setPrivateKey(n.publicKey,n.privateKey)}),ve(this,"signJWT",async n=>{this.isInitialized();const s=await this.getClientSeed(),o=Rl(s),a=this.randomSessionIdentifier;return await M1(a,n,XS,o)}),ve(this,"generateSharedKey",(n,s,o)=>{this.isInitialized();const a=this.getPrivateKey(n),c=F_(a,s);return this.setSymKey(c,o)}),ve(this,"setSymKey",async(n,s)=>{this.isInitialized();const o=s||Mn(n);return await this.keychain.set(o,n),o}),ve(this,"deleteKeyPair",async n=>{this.isInitialized(),await this.keychain.del(n)}),ve(this,"deleteSymKey",async n=>{this.isInitialized(),await this.keychain.del(n)}),ve(this,"encode",async(n,s,o)=>{this.isInitialized();const a=Np(o),c=Wr(s);if(Cu(a))return L_(c,o?.encoding);if(Pu(a)){const f=a.senderPublicKey,p=a.receiverPublicKey;n=await this.generateSharedKey(f,p)}const l=this.getSymKey(n),{type:u,senderPublicKey:h}=a;return q_({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o?.encoding})}),ve(this,"decode",async(n,s,o)=>{this.isInitialized();const a=V_(s,o);if(Cu(a)){const c=z_(s,o?.encoding);return Hr(c)}if(Pu(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;n=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(n),l=M_({symKey:c,encoded:s,encoding:o?.encoding});return Hr(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),ve(this,"getPayloadType",(n,s=Ge)=>{const o=en({encoded:n,encoding:s});return Yr(o.type)}),ve(this,"getPayloadSenderPublicKey",(n,s=Ge)=>{const o=en({encoded:n,encoding:s});return o.senderPublicKey?Je(o.senderPublicKey,Me):void 0}),this.core=e,this.logger=at(r,this.name),this.keychain=i||new eO(this.core,this.logger)}get context(){return Xe(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(oh)}catch{e=xa(),await this.keychain.set(oh,e)}return J$(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var nO=Object.defineProperty,sO=Object.defineProperties,oO=Object.getOwnPropertyDescriptors,ph=Object.getOwnPropertySymbols,aO=Object.prototype.hasOwnProperty,cO=Object.prototype.propertyIsEnumerable,Ba=(t,e,r)=>e in t?nO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lO=(t,e)=>{for(var r in e||(e={}))aO.call(e,r)&&Ba(t,r,e[r]);if(ph)for(var r of ph(e))cO.call(e,r)&&Ba(t,r,e[r]);return t},uO=(t,e)=>sO(t,oO(e)),Qe=(t,e,r)=>Ba(t,typeof e!="symbol"?e+"":e,r);class hO extends KI{constructor(e,r){super(e,r),this.logger=e,this.core=r,Qe(this,"messages",new Map),Qe(this,"messagesWithoutClientAck",new Map),Qe(this,"name",t8),Qe(this,"version",r8),Qe(this,"initialized",!1),Qe(this,"storagePrefix",Mt),Qe(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const n=await this.getRelayerMessagesWithoutClientAck();typeof n<"u"&&(this.messagesWithoutClientAck=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),Qe(this,"set",async(i,n,s)=>{this.isInitialized();const o=dt(n);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=n,this.messages.set(i,a),s===Vn.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,uO(lO({},c),{[o]:n}))}return await this.persist(),o}),Qe(this,"get",i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n}),Qe(this,"getWithoutAck",i=>{this.isInitialized();const n={};for(const s of i){const o=this.messagesWithoutClientAck.get(s)||{};n[s]=Object.values(o)}return n}),Qe(this,"has",(i,n)=>{this.isInitialized();const s=this.get(i),o=dt(n);return typeof s[o]<"u"}),Qe(this,"ack",async(i,n)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(i);if(typeof s>"u")return;const o=dt(n);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,s),await this.persist()}),Qe(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=at(e,this.name),this.core=r}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ua(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,ua(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ha(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?ha(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var fO=Object.defineProperty,dO=Object.defineProperties,pO=Object.getOwnPropertyDescriptors,gh=Object.getOwnPropertySymbols,gO=Object.prototype.hasOwnProperty,yO=Object.prototype.propertyIsEnumerable,Ta=(t,e,r)=>e in t?fO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,si=(t,e)=>{for(var r in e||(e={}))gO.call(e,r)&&Ta(t,r,e[r]);if(gh)for(var r of gh(e))yO.call(e,r)&&Ta(t,r,e[r]);return t},yh=(t,e)=>dO(t,pO(e)),ut=(t,e,r)=>Ta(t,typeof e!="symbol"?e+"":e,r);class wO extends HI{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ut(this,"events",new ot.EventEmitter),ut(this,"name",n8),ut(this,"queue",new Map),ut(this,"publishTimeout",L.toMiliseconds(L.ONE_MINUTE)),ut(this,"initialPublishTimeout",L.toMiliseconds(L.ONE_SECOND*15)),ut(this,"needsTransportRestart",!1),ut(this,"publish",async(i,n,s)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});const h=s?.ttl||i8,f=s?.prompt||!1,p=s?.tag||0,d=s?.id||xr().toString(),y=ui(os().protocol),m={id:d,method:s?.publishMethod||y.publish,params:si({topic:i,message:n,ttl:h,prompt:f,tag:p,attestation:s?.attestation},s?.tvf)},v=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{Ie((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),Ie((c=m.params)==null?void 0:c.tag)&&((l=m.params)==null||delete l.tag);const I=new Promise(async b=>{const E=({id:C})=>{var T;((T=m.id)==null?void 0:T.toString())===C.toString()&&(this.removeRequestFromQueue(C),this.relayer.events.removeListener(pe.publish,E),b())};this.relayer.events.on(pe.publish,E);const D=kt(new Promise((C,T)=>{this.rpcPublish(m,s).then(C).catch(R=>{this.logger.warn(R,R?.message),T(R)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{await D,this.events.removeListener(pe.publish,E)}catch(C){this.queue.set(d,{request:m,opts:s,attempt:1}),this.logger.warn(C,C?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:i,message:n,opts:s}}),await kt(I,this.publishTimeout,v)}catch(I){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(I),(u=s?.internal)!=null&&u.throwOnFailedPublish)throw I}finally{this.queue.delete(d)}}),ut(this,"publishCustom",async i=>{var n,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});const{payload:l,opts:u={}}=i,{attestation:h,tvf:f,publishMethod:p,prompt:d,tag:y,ttl:m=L.FIVE_MINUTES}=u,v=u.id||xr().toString(),I=ui(os().protocol),b=p||I.publish,E={id:v,method:b,params:si(yh(si({},l),{ttl:m,prompt:d,tag:y,attestation:h}),f)},D=`Failed to publish custom payload, please try again. id:${v} tag:${y}`;try{Ie((n=E.params)==null?void 0:n.prompt)&&((s=E.params)==null||delete s.prompt),Ie((o=E.params)==null?void 0:o.tag)&&((a=E.params)==null||delete a.tag);const C=new Promise(async T=>{const R=({id:k})=>{var U;((U=E.id)==null?void 0:U.toString())===k.toString()&&(this.removeRequestFromQueue(k),this.relayer.events.removeListener(pe.publish,R),T())};this.relayer.events.on(pe.publish,R);const A=kt(new Promise((k,U)=>{this.rpcPublish(E,u).then(k).catch(B=>{this.logger.warn(B,B?.message),U(B)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${b} id:${v} tag:${y}`);try{await A,this.events.removeListener(pe.publish,R)}catch(k){this.queue.set(v,{request:E,opts:u,attempt:1}),this.logger.warn(k,k?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:v,payload:l,opts:u}}),await kt(C,this.publishTimeout,D)}catch(C){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(C),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw C}finally{this.queue.delete(v)}}),ut(this,"on",(i,n)=>{this.events.on(i,n)}),ut(this,"once",(i,n)=>{this.events.once(i,n)}),ut(this,"off",(i,n)=>{this.events.off(i,n)}),ut(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.relayer=e,this.logger=at(r,this.name),this.registerEventListeners()}get context(){return Xe(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const i=await this.relayer.request(e);return this.relayer.events.emit(pe.publish,si(si({},e),r)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var i;const n=e.attempt+1;this.queue.set(r,yh(si({},e),{attempt:n})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(i=e.request.params)==null?void 0:i.tag}, attempt: ${n}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Xr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(pe.connection_stalled);return}this.checkQueue()}),this.relayer.on(pe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var mO=Object.defineProperty,bO=(t,e,r)=>e in t?mO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oi=(t,e,r)=>bO(t,typeof e!="symbol"?e+"":e,r);class vO{constructor(){oi(this,"map",new Map),oi(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),oi(this,"get",e=>this.map.get(e)||[]),oi(this,"exists",(e,r)=>this.get(e).includes(r)),oi(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)}),oi(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var EO=Object.defineProperty,xO=Object.defineProperties,_O=Object.getOwnPropertyDescriptors,wh=Object.getOwnPropertySymbols,IO=Object.prototype.hasOwnProperty,SO=Object.prototype.propertyIsEnumerable,Ra=(t,e,r)=>e in t?EO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ni=(t,e)=>{for(var r in e||(e={}))IO.call(e,r)&&Ra(t,r,e[r]);if(wh)for(var r of wh(e))SO.call(e,r)&&Ra(t,r,e[r]);return t},Co=(t,e)=>xO(t,_O(e)),se=(t,e,r)=>Ra(t,typeof e!="symbol"?e+"":e,r);class $O extends YI{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,se(this,"subscriptions",new Map),se(this,"topicMap",new vO),se(this,"events",new ot.EventEmitter),se(this,"name",h8),se(this,"version",f8),se(this,"pending",new Map),se(this,"cached",[]),se(this,"initialized",!1),se(this,"storagePrefix",Mt),se(this,"subscribeTimeout",L.toMiliseconds(L.ONE_MINUTE)),se(this,"initialSubscribeTimeout",L.toMiliseconds(L.ONE_SECOND*15)),se(this,"clientId"),se(this,"batchSubscribeTopicsLimit",500),se(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),se(this,"subscribe",async(i,n)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const o=os(n),a={topic:i,relay:o,transportType:n?.transportType};(s=n?.internal)!=null&&s.skipSubscribe||this.pending.set(i,a);const c=await this.rpcSubscribe(i,o,n);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),se(this,"unsubscribe",async(i,n)=>{this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)}),se(this,"isSubscribed",i=>new Promise(n=>{n(this.topicMap.topics.includes(i))})),se(this,"isKnownTopic",i=>new Promise(n=>{n(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(s=>s.topic===i))})),se(this,"on",(i,n)=>{this.events.on(i,n)}),se(this,"once",(i,n)=>{this.events.once(i,n)}),se(this,"off",(i,n)=>{this.events.off(i,n)}),se(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),se(this,"start",async()=>{await this.onConnect()}),se(this,"stop",async()=>{await this.onDisconnect()}),se(this,"restart",async()=>{await this.restore(),await this.onRestart()}),se(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(n=>{i.push(n)}),await this.batchSubscribe(i)}),se(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Xr.pulse,async()=>{await this.checkPending()}),this.events.on(rt.created,async i=>{const n=rt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()}),this.events.on(rt.deleted,async i=>{const n=rt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()})}),this.relayer=e,this.logger=at(r,this.name),this.clientId=""}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=os(i);await this.restartToComplete({topic:e,id:r,relay:n}),await this.rpcUnsubscribe(e,r,n);const s=ce("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r,i){var n,s;const o=await this.getSubscriptionId(e);if((n=i?.internal)!=null&&n.skipSubscribe)return o;(!i||i?.transportType===ae.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:ui(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=i?.internal)==null?void 0:s.throwOnFailedPublish;try{if(i?.transportType===ae.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},L.toMiliseconds(L.ONE_SECOND)),o;const l=new Promise(async h=>{const f=p=>{p.topic===e&&(this.events.removeListener(rt.created,f),h(p.id))};this.events.on(rt.created,f);try{const p=await kt(new Promise((d,y)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m?.message),y(m)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(rt.created,f),h(p)}catch{}}),u=await kt(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(pe.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:ui(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await kt(new Promise(n=>{this.relayer.request(i).catch(s=>this.logger.warn(s)).then(n)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(pe.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:ui(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await kt(new Promise((s,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(pe.connection_stalled)}return n}rpcUnsubscribe(e,r,i){const n={method:ui(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,Co(Ni({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Ni({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Ni({},r)),this.topicMap.set(r.topic,e),this.events.emit(rt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(rt.deleted,Co(Ni({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(rt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(rt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var i;return r.topic===((i=this.subscriptions.get(r.id))==null?void 0:i.topic)})){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>Co(Ni({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await n2(L.toMiliseconds(L.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return dt(e+await this.getClientId())}}var OO=Object.defineProperty,mh=Object.getOwnPropertySymbols,DO=Object.prototype.hasOwnProperty,AO=Object.prototype.propertyIsEnumerable,Na=(t,e,r)=>e in t?OO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bh=(t,e)=>{for(var r in e||(e={}))DO.call(e,r)&&Na(t,r,e[r]);if(mh)for(var r of mh(e))AO.call(e,r)&&Na(t,r,e[r]);return t},te=(t,e,r)=>Na(t,typeof e!="symbol"?e+"":e,r);class PO extends WI{constructor(e){var r;super(e),te(this,"protocol","wc"),te(this,"version",2),te(this,"core"),te(this,"logger"),te(this,"events",new ot.EventEmitter),te(this,"provider"),te(this,"messages"),te(this,"subscriber"),te(this,"publisher"),te(this,"name",o8),te(this,"transportExplicitlyClosed",!1),te(this,"initialized",!1),te(this,"connectionAttemptInProgress",!1),te(this,"relayUrl"),te(this,"projectId"),te(this,"packageName"),te(this,"bundleId"),te(this,"hasExperiencedNetworkDisruption",!1),te(this,"pingTimeout"),te(this,"heartBeatTimeout",L.toMiliseconds(L.THIRTY_SECONDS+L.FIVE_SECONDS)),te(this,"reconnectTimeout"),te(this,"connectPromise"),te(this,"reconnectInProgress",!1),te(this,"requestsInFlight",[]),te(this,"connectTimeout",L.toMiliseconds(L.ONE_SECOND*15)),te(this,"request",async i=>{var n,s;this.logger.debug("Publishing Request Payload");const o=i.id||xr().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:i.method,topic:(n=i.params)==null?void 0:n.topic},"relayer.request - publishing...");const a=`${o}:${((s=i.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(i);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),te(this,"resetPingTimeout",()=>{es()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,n,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(s=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null?void 0:s.terminate)==null||o.call(s)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),te(this,"onPayloadHandler",i=>{this.onProviderPayload(i),this.resetPingTimeout()}),te(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(pe.connect)}),te(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),te(this,"onProviderErrorHandler",i=>{this.logger.fatal(`Fatal socket error: ${i.message}`),this.events.emit(pe.error,i),this.logger.fatal("Fatal socket error received, closing transport"),this.transportExplicitlyClosed=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,this.reconnectInProgress=!1,this.transportClose().catch(n=>this.logger.warn(n))}),te(this,"registerProviderListeners",()=>{this.provider.on(lt.payload,this.onPayloadHandler),this.provider.on(lt.connect,this.onConnectHandler),this.provider.on(lt.disconnect,this.onDisconnectHandler),this.provider.on(lt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=xc({logger:(r=e.logger)!=null?r:s8,name:this.name}),this.messages=new hO(this.logger,e.core),this.subscriber=new $O(this,this.logger),this.publisher=new wO(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Zp,LE()?this.packageName=Xl():zE()&&(this.bundleId=Xl()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return Xe(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:ae.relay},Vn.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var i,n,s;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((i=r?.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(n=r?.internal)==null?void 0:n.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(rt.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(rt.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,bh({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await kt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,this.reconnectInProgress=!1,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Vu())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,n)=>i.publishedAt-n.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(n){this.logger.warn(n,"Error while processing batch message event: "+n?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const n=de(L.FIVE_MINUTES),s={topic:i,expiry:n,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,s)}this.events.emit(pe.message,e),await this.recordMessageEvent(e,Vn.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,n)=>{const s=()=>{n(new Error("Connection interrupted while trying to connect"))};this.provider.once(lt.disconnect,s),await kt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{n(o)}).finally(()=>{this.provider.off(lt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{n(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(lt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(lt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const n=i;this.logger.warn({},n.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,L.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,n,s;if(es())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Sc(new WS(GE({sdkVersion:Aa,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:i,message:n}=e;await this.messages.set(i,n,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.warn(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ic(e)){if(!e.method.endsWith(a8))return;const r=e.params,{topic:i,message:n,publishedAt:s,attestation:o}=r.data,a={topic:i,message:n,publishedAt:s,transportType:ae.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(bh({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Cs(e)&&this.events.emit(pe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Vn.inbound),this.events.emit(pe.message,e))}async acknowledgePayload(e){const r=rn(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(lt.payload,this.onPayloadHandler),this.provider.off(lt.connect,this.onConnectHandler),this.provider.off(lt.disconnect,this.onDisconnectHandler),this.provider.off(lt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Vu();V3(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Xr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&W3())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(pe.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},L.toMiliseconds(c8)))))}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function CO(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function vh(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Eh(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const BO="[object RegExp]",TO="[object String]",RO="[object Number]",NO="[object Boolean]",xh="[object Arguments]",UO="[object Symbol]",jO="[object Date]",kO="[object Map]",FO="[object Set]",qO="[object Array]",MO="[object Function]",LO="[object ArrayBuffer]",Bo="[object Object]",zO="[object Error]",VO="[object DataView]",KO="[object Uint8Array]",HO="[object Uint8ClampedArray]",WO="[object Uint16Array]",GO="[object Uint32Array]",YO="[object BigUint64Array]",ZO="[object Int8Array]",JO="[object Int16Array]",XO="[object Int32Array]",QO="[object BigInt64Array]",eD="[object Float32Array]",tD="[object Float64Array]";function _h(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function rD(t,e,r){return Mi(t,e,void 0,void 0,void 0,void 0,r)}function Mi(t,e,r,i,n,s,o){const a=o(t,e,r,i,n,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Wi(t,e,s,o)}return Wi(t,e,s,o)}function Wi(t,e,r,i){if(Object.is(t,e))return!0;let n=Eh(t),s=Eh(e);if(n===xh&&(n=Bo),s===xh&&(s=Bo),n!==s)return!1;switch(n){case TO:return t.toString()===e.toString();case RO:{const c=t.valueOf(),l=e.valueOf();return CO(c,l)}case NO:case jO:case UO:return Object.is(t.valueOf(),e.valueOf());case BO:return t.source===e.source&&t.flags===e.flags;case MO:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(n){case kO:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!Mi(l,e.get(c),c,t,e,r,i))return!1;return!0}case FO:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],f=l.findIndex(p=>Mi(h,p,void 0,t,e,r,i));if(f===-1)return!1;l.splice(f,1)}return!0}case qO:case KO:case HO:case WO:case GO:case YO:case ZO:case JO:case XO:case QO:case eD:case tD:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Mi(t[c],e[c],c,t,e,r,i))return!1;return!0}case LO:return t.byteLength!==e.byteLength?!1:Wi(new Uint8Array(t),new Uint8Array(e),r,i);case VO:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Wi(new Uint8Array(t),new Uint8Array(e),r,i);case zO:return t.name===e.name&&t.message===e.message;case Bo:{if(!(Wi(t.constructor,e.constructor,r,i)||_h(t)&&_h(e)))return!1;const c=[...Object.keys(t),...vh(t)],l=[...Object.keys(e),...vh(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],f=t[h];if(!Object.hasOwn(e,h))return!1;const p=e[h];if(!Mi(f,p,h,t,e,r,i))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function iD(){}function nD(t,e){return rD(t,e,iD)}var sD=Object.defineProperty,Ih=Object.getOwnPropertySymbols,oD=Object.prototype.hasOwnProperty,aD=Object.prototype.propertyIsEnumerable,Ua=(t,e,r)=>e in t?sD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sh=(t,e)=>{for(var r in e||(e={}))oD.call(e,r)&&Ua(t,r,e[r]);if(Ih)for(var r of Ih(e))aD.call(e,r)&&Ua(t,r,e[r]);return t},ze=(t,e,r)=>Ua(t,typeof e!="symbol"?e+"":e,r);class ei extends GI{constructor(e,r,i,n=Mt,s=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,ze(this,"map",new Map),ze(this,"version",l8),ze(this,"cached",[]),ze(this,"initialized",!1),ze(this,"getKey"),ze(this,"storagePrefix",Mt),ze(this,"recentlyDeleted",[]),ze(this,"recentlyDeletedLimit",200),ze(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ie(o)?this.map.set(this.getKey(o),o):E3(o)?this.map.set(o.id,o):x3(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),ze(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),ze(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),ze(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>nD(a[c],o[c]))):this.values)),ze(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Sh(Sh({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),ze(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=at(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:n}=z("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var cD=Object.defineProperty,lD=(t,e,r)=>e in t?cD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,X=(t,e,r)=>lD(t,typeof e!="symbol"?e+"":e,r);class uD{constructor(e,r){this.core=e,this.logger=r,X(this,"name",d8),X(this,"version",p8),X(this,"events",new Ha),X(this,"pairings"),X(this,"initialized",!1),X(this,"storagePrefix",Mt),X(this,"ignoredPayloadTypes",[nr]),X(this,"registeredMethods",[]),X(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),X(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),X(this,"create",async i=>{this.isInitialized();const n=xa(),s=await this.core.crypto.setSymKey(n),o=de(L.FIVE_MINUTES),a={protocol:Yp},c={topic:s,expiry:o,relay:a,active:!1,methods:i?.methods},l=Nu({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:n,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(Fr.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:i?.transportType,internal:i?.internal}),{topic:s,uri:l}}),X(this,"pair",async i=>{this.isInitialized();const n=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[Bt.pairing_started]}});this.isValidPair(i,n);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:l}=Ru(i.uri);n.props.properties.topic=s,n.addTrace(Bt.pairing_uri_validation_success),n.addTrace(Bt.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(s)){if(u=this.pairings.get(s),n.addTrace(Bt.existing_pairing),u.active)throw n.setError(Zt.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);n.addTrace(Bt.pairing_not_expired)}const h=c||de(L.FIVE_MINUTES),f={topic:s,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(s,h),await this.pairings.set(s,f),n.addTrace(Bt.store_new_pairing),i.activatePairing&&await this.activate({topic:s}),this.events.emit(Fr.create,f),n.addTrace(Bt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),n.addTrace(Bt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{n.setError(Zt.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(p){throw n.setError(Zt.subscribe_pairing_topic_failure),p}return n.addTrace(Bt.subscribe_pairing_topic_success),f}),X(this,"activate",async({topic:i})=>{this.isInitialized();const n=de(L.FIVE_MINUTES);this.core.expirer.set(i,n),await this.pairings.update(i,{active:!0,expiry:n})}),X(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Ur();this.events.once(ie("pairing_ping",s),({error:l})=>{l?c(l):a()}),await o()}}),X(this,"updateExpiry",async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})}),X(this,"updateMetadata",async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})}),X(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),X(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",ce("USER_DISCONNECTED")),await this.deletePairing(n))}),X(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:n,relay:s,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(n);return Nu({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),X(this,"sendRequest",async(i,n,s)=>{const o=It(n,s),a=await this.core.crypto.encode(i,o),c=Ti[n].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),X(this,"sendResult",async(i,n,s)=>{const o=rn(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,l=Ti[c].res;await this.core.relayer.publish(n,a,l),await this.core.history.resolve(o)}),X(this,"sendError",async(i,n,s)=>{const o=Ps(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,l=Ti[c]?Ti[c].res:Ti.unregistered_method.res;await this.core.relayer.publish(n,a,l),await this.core.history.resolve(o)}),X(this,"deletePairing",async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,ce("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])}),X(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(n=>Ut(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))}),X(this,"onRelayEventRequest",async i=>{const{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(n,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(n,s);default:return await this.onUnknownRpcMethodRequest(n,s)}}),X(this,"onRelayEventResponse",async i=>{const{topic:n,payload:s}=i,o=(await this.core.history.get(n,s.id)).request.method;return o==="wc_pairingPing"?this.onPairingPingResponse(n,s):this.onUnknownRpcMethodResponse(o)}),X(this,"onPairingPingRequest",async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit(Fr.ping,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),X(this,"onPairingPingResponse",(i,n)=>{const{id:s}=n;setTimeout(()=>{Rt(n)?this.events.emit(ie("pairing_ping",s),{}):pt(n)&&this.events.emit(ie("pairing_ping",s),{error:n.error})},500)}),X(this,"onPairingDeleteRequest",async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Fr.delete,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),X(this,"onUnknownRpcMethodRequest",async(i,n)=>{const{id:s,method:o}=n;try{if(this.registeredMethods.includes(o))return;const a=ce("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,i,a),this.logger.error(a)}catch(a){await this.sendError(s,i,a),this.logger.error(a)}}),X(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(ce("WC_METHOD_UNSUPPORTED",i))}),X(this,"isValidPair",(i,n)=>{var s;if(!Ke(i)){const{message:a}=z("MISSING_OR_INVALID",`pair() params: ${i}`);throw n.setError(Zt.malformed_pairing_uri),new Error(a)}if(!v3(i.uri)){const{message:a}=z("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw n.setError(Zt.malformed_pairing_uri),new Error(a)}const o=Ru(i?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw n.setError(Zt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#symKey");throw n.setError(Zt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&L.toMiliseconds(o?.expiryTimestamp)<Date.now()){n.setError(Zt.pairing_expired);const{message:a}=z("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),X(this,"isValidPing",async i=>{if(!Ke(i)){const{message:s}=z("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)}),X(this,"isValidDisconnect",async i=>{if(!Ke(i)){const{message:s}=z("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)}),X(this,"isValidPairingTopic",async i=>{if(!ge(i,!1)){const{message:n}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Ut(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=z("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}}),this.core=e,this.logger=at(r,this.name),this.pairings=new ei(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Xe(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(pe.message,async e=>{const{topic:r,message:i,transportType:n}=e;if(this.pairings.keys.includes(r)&&n!==ae.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const s=await this.core.crypto.decode(r,i);Ic(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):Cs(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,i)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(ht.expired,async e=>{const{topic:r}=jd(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Fr.expire,{topic:r}))})}}var hD=Object.defineProperty,fD=(t,e,r)=>e in t?hD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Oe=(t,e,r)=>fD(t,typeof e!="symbol"?e+"":e,r);class dD extends VI{constructor(e,r){super(e,r),this.core=e,this.logger=r,Oe(this,"records",new Map),Oe(this,"events",new ot.EventEmitter),Oe(this,"name",g8),Oe(this,"version",y8),Oe(this,"cached",[]),Oe(this,"initialized",!1),Oe(this,"storagePrefix",Mt),Oe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Oe(this,"set",(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const o={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:de(L.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(bt.created,o)}),Oe(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=pt(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.persist(),this.events.emit(bt.updated,n))}),Oe(this,"get",async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n))),Oe(this,"delete",(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(bt.deleted,s)}}),this.persist()}),Oe(this,"exists",async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1)),Oe(this,"on",(i,n)=>{this.events.on(i,n)}),Oe(this,"once",(i,n)=>{this.events.once(i,n)}),Oe(this,"off",(i,n)=>{this.events.off(i,n)}),Oe(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=at(r,this.name)}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:It(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(bt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(bt.created,e=>{const r=bt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(bt.updated,e=>{const r=bt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(bt.deleted,e=>{const r=bt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Xr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{L.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(bt.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var pD=Object.defineProperty,gD=(t,e,r)=>e in t?pD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ue=(t,e,r)=>gD(t,typeof e!="symbol"?e+"":e,r);class yD extends ZI{constructor(e,r){super(e,r),this.core=e,this.logger=r,Ue(this,"expirations",new Map),Ue(this,"events",new ot.EventEmitter),Ue(this,"name",w8),Ue(this,"version",m8),Ue(this,"cached",[]),Ue(this,"initialized",!1),Ue(this,"storagePrefix",Mt),Ue(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ue(this,"has",i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}}),Ue(this,"set",(i,n)=>{this.isInitialized();const s=this.formatTarget(i),o={target:s,expiry:n};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(ht.created,{target:s,expiration:o})}),Ue(this,"get",i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)}),Ue(this,"del",i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(ht.deleted,{target:n,expiration:s})}}),Ue(this,"on",(i,n)=>{this.events.on(i,n)}),Ue(this,"once",(i,n)=>{this.events.once(i,n)}),Ue(this,"off",(i,n)=>{this.events.off(i,n)}),Ue(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=at(r,this.name)}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return YE(e);if(typeof e=="number")return ZE(e);const{message:r}=z("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ht.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;L.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ht.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Xr.pulse,()=>this.checkExpirations()),this.events.on(ht.created,e=>{const r=ht.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ht.expired,e=>{const r=ht.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ht.deleted,e=>{const r=ht.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var wD=Object.defineProperty,mD=(t,e,r)=>e in t?wD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fe=(t,e,r)=>mD(t,typeof e!="symbol"?e+"":e,r);class bD extends JI{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,fe(this,"name",b8),fe(this,"abortController"),fe(this,"isDevEnv"),fe(this,"verifyUrlV3",E8),fe(this,"storagePrefix",Mt),fe(this,"version",Gp),fe(this,"publicKey"),fe(this,"fetchPromise"),fe(this,"init",async()=>{var n;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&L.toMiliseconds((n=this.publicKey)==null?void 0:n.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),fe(this,"register",async n=>{if(!xi()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=n,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const l=sr.getDocument(),u=this.startAbortTimer(L.ONE_SECOND*5),h=await new Promise((f,p)=>{const d=()=>{window.removeEventListener("message",m),l.body.removeChild(y),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const y=l.createElement("iframe");y.src=c,y.style.display="none",y.addEventListener("error",d,{signal:this.abortController.signal});const m=v=>{if(v.data&&typeof v.data=="string")try{const I=JSON.parse(v.data);if(I.type==="verify_attestation"){if(oa(I.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(y),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",m),f(I.attestation===null?"":I.attestation)}}catch(I){this.logger.warn(I)}};l.body.appendChild(y),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(l){this.logger.warn(l)}return""}),fe(this,"resolve",async n=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=n;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(oa(s).payload.id!==a)return;const l=await this.isValidJwtAttestation(s);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(n?.verifyUrl);return this.fetchAttestation(o,c)}),fe(this,"fetchAttestation",async(n,s)=>{this.logger.debug(`resolving attestation: ${n} from url: ${s}`);const o=this.startAbortTimer(L.ONE_SECOND*5),a=await fetch(`${s}/attestation/${n}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),fe(this,"getVerifyUrl",n=>{let s=n||Hi;return x8.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Hi}`),s=Hi),s}),fe(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const n=this.startAbortTimer(L.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(n),await s.json()}catch(n){this.logger.warn(n)}}),fe(this,"persistPublicKey",async n=>{this.logger.debug(n,"persisting public key to local storage"),await this.store.setItem(this.storeKey,n),this.publicKey=n}),fe(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),fe(this,"isValidJwtAttestation",async n=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(n,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(n,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),fe(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),fe(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const n=await this.fetchPromise;return this.fetchPromise=void 0,n}),fe(this,"validateAttestation",(n,s)=>{const o=H_(n,s.publicKey),a={hasExpired:L.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=at(r,this.name),this.abortController=new AbortController,this.isDevEnv=hc(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Xe(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),L.toMiliseconds(e))}}var vD=Object.defineProperty,ED=(t,e,r)=>e in t?vD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$h=(t,e,r)=>ED(t,typeof e!="symbol"?e+"":e,r);class xD extends XI{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,$h(this,"context",_8),$h(this,"registerDeviceToken",async i=>{const{clientId:n,token:s,notificationType:o,enableEncrypted:a=!1}=i,c=`${I8}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:o,token:s,always_raw:a})})}),this.logger=at(r,this.context)}}var _D=Object.defineProperty,Oh=Object.getOwnPropertySymbols,ID=Object.prototype.hasOwnProperty,SD=Object.prototype.propertyIsEnumerable,ja=(t,e,r)=>e in t?_D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ui=(t,e)=>{for(var r in e||(e={}))ID.call(e,r)&&ja(t,r,e[r]);if(Oh)for(var r of Oh(e))SD.call(e,r)&&ja(t,r,e[r]);return t},Ee=(t,e,r)=>ja(t,typeof e!="symbol"?e+"":e,r);class $D extends QI{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,Ee(this,"context",$8),Ee(this,"storagePrefix",Mt),Ee(this,"storageVersion",S8),Ee(this,"events",new Map),Ee(this,"shouldPersist",!1),Ee(this,"init",async()=>{if(!hc())try{const n={eventId:eu(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Nd(this.core.relayer.protocol,this.core.relayer.version,Aa)}}};await this.sendEvent([n])}catch(n){this.logger.warn(n)}}),Ee(this,"createEvent",n=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=n,l=eu(),u=this.core.projectId||"",h=Date.now(),f=Ui({eventId:l,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,f),this.shouldPersist=!0),f}),Ee(this,"getEvent",n=>{const{eventId:s,topic:o}=n;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Ui(Ui({},a),this.setMethods(a.eventId))}),Ee(this,"deleteEvent",n=>{const{eventId:s}=n;this.events.delete(s),this.shouldPersist=!0}),Ee(this,"setEventListeners",()=>{this.core.heartbeat.on(Xr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(n=>{L.fromMiliseconds(Date.now())-L.fromMiliseconds(n.timestamp)>O8&&(this.events.delete(n.eventId),this.shouldPersist=!0)})})}),Ee(this,"setMethods",n=>({addTrace:s=>this.addTrace(n,s),setError:s=>this.setError(n,s)})),Ee(this,"addTrace",(n,s)=>{const o=this.events.get(n);o&&(o.props.properties.trace.push(s),this.events.set(n,o),this.shouldPersist=!0)}),Ee(this,"setError",(n,s)=>{const o=this.events.get(n);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(n,o),this.shouldPersist=!0)}),Ee(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ee(this,"restore",async()=>{try{const n=await this.core.storage.getItem(this.storageKey)||[];if(!n.length)return;n.forEach(s=>{this.events.set(s.eventId,Ui(Ui({},s),this.setMethods(s.eventId)))})}catch(n){this.logger.warn(n)}}),Ee(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const n=[];for(const[s,o]of this.events)o.props.type&&n.push(o);if(n.length!==0)try{if((await this.sendEvent(n)).ok)for(const s of n)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Ee(this,"sendEvent",async n=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${D8}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Aa}${s}`,{method:"POST",body:JSON.stringify(n)})}),Ee(this,"getAppDomain",()=>Rd().url),this.logger=at(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var OD=Object.defineProperty,Dh=Object.getOwnPropertySymbols,DD=Object.prototype.hasOwnProperty,AD=Object.prototype.propertyIsEnumerable,ka=(t,e,r)=>e in t?OD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ah=(t,e)=>{for(var r in e||(e={}))DD.call(e,r)&&ka(t,r,e[r]);if(Dh)for(var r of Dh(e))AD.call(e,r)&&ka(t,r,e[r]);return t},oe=(t,e,r)=>ka(t,typeof e!="symbol"?e+"":e,r);let PD=class lg extends qI{constructor(e){var r;super(e),oe(this,"protocol",Wp),oe(this,"version",Gp),oe(this,"name",Da),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"customStoragePrefix"),oe(this,"events",new ot.EventEmitter),oe(this,"logger"),oe(this,"heartbeat"),oe(this,"relayer"),oe(this,"crypto"),oe(this,"storage"),oe(this,"history"),oe(this,"expirer"),oe(this,"pairing"),oe(this,"verify"),oe(this,"echoClient"),oe(this,"linkModeSupportedApps"),oe(this,"eventClient"),oe(this,"initialized",!1),oe(this,"logChunkController"),oe(this,"on",(a,c)=>this.events.on(a,c)),oe(this,"once",(a,c)=>this.events.once(a,c)),oe(this,"off",(a,c)=>this.events.off(a,c)),oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:ae.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Zp,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const n=OE({level:typeof e?.logger=="string"&&e.logger?e.logger:YS.logger,name:Da}),{logger:s,chunkLoggerController:o}=Bd({opts:n,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=at(s,this.name),this.heartbeat=new iI,this.crypto=new iO(this,this.logger,e?.keychain),this.history=new dD(this,this.logger),this.expirer=new yD(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new jI(Ah(Ah({},ZS),e?.storageOptions)),this.relayer=new PO({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new uD(this,this.logger),this.verify=new bD(this,this.logger,this.storage),this.echoClient=new xD(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new $D(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new lg(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(u8,i),r}get context(){return Xe(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(ah,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(ah)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,i=`${r}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&GS.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const CD=PD,ug="wc",hg=2,fg="client",$c=`${ug}@${hg}:${fg}:`,To={name:fg,logger:"error"},Ph="WALLETCONNECT_DEEPLINK_CHOICE",BD="proposal",Ch="Proposal expired",TD="session",ai=L.SEVEN_DAYS,RD="engine",De={wc_sessionPropose:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1104},res:{ttl:L.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1106},res:{ttl:L.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1112},res:{ttl:L.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1114},res:{ttl:L.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:L.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:L.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1119}}},Ro={min:L.FIVE_MINUTES,max:L.SEVEN_DAYS},Ct={idle:"IDLE",active:"ACTIVE"},ND={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},UD="request",jD=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],kD="wc",FD="auth",qD="authKeys",MD="pairingTopics",LD="requests",Ts=`${kD}@${1.5}:${FD}:`,Kn=`${Ts}:PUB_KEY`;var zD=Object.defineProperty,VD=Object.defineProperties,KD=Object.getOwnPropertyDescriptors,Bh=Object.getOwnPropertySymbols,HD=Object.prototype.hasOwnProperty,WD=Object.prototype.propertyIsEnumerable,Fa=(t,e,r)=>e in t?zD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,re=(t,e)=>{for(var r in e||(e={}))HD.call(e,r)&&Fa(t,r,e[r]);if(Bh)for(var r of Bh(e))WD.call(e,r)&&Fa(t,r,e[r]);return t},Ae=(t,e)=>VD(t,KD(e)),F=(t,e,r)=>Fa(t,typeof e!="symbol"?e+"":e,r);class GD extends iS{constructor(e){super(e),F(this,"name",RD),F(this,"events",new Ha),F(this,"initialized",!1),F(this,"requestQueue",{state:Ct.idle,queue:[]}),F(this,"sessionRequestQueue",{state:Ct.idle,queue:[]}),F(this,"emittedSessionRequests",new s2({limit:500})),F(this,"requestQueueDelay",L.ONE_SECOND),F(this,"expectedPairingMethodMap",new Map),F(this,"recentlyDeletedMap",new Map),F(this,"recentlyDeletedLimit",200),F(this,"relayMessageCache",[]),F(this,"pendingSessions",new Map),F(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(De)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay)))}),F(this,"connect",async r=>{var i;this.isInitialized(),await this.confirmOnlineStateOrThrow();const n=Ae(re({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n),n.optionalNamespaces=g3(n.requiredNamespaces,n.optionalNamespaces),n.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:l,relays:u,authentication:h,walletPay:f}=n,p=((i=h?.[0])==null?void 0:i.ttl)||De.wc_sessionPropose.req.ttl||L.FIVE_MINUTES;this.validateRequestExpiry(p);let d=s,y,m=!1;try{if(d){const A=this.client.core.pairing.pairings.get(d);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),m=A.active}}catch(A){throw this.client.logger.error(`connect() -> pairing.get(${d}) failed`),A}if(!d||!m){const{topic:A,uri:k}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});d=A,y=k}if(!d){const{message:A}=z("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(A)}const v=await this.client.core.crypto.generateKeyPair(),I=de(p),b=re(Ae(re(re({requiredNamespaces:o,optionalNamespaces:a,relays:u??[{protocol:Yp}],proposer:{publicKey:v,metadata:this.client.metadata},expiryTimestamp:I,pairingTopic:d},c&&{sessionProperties:c}),l&&{scopedProperties:l}),{id:Tt()}),(h||f)&&{requests:{authentication:h?.map(A=>{const{domain:k,chains:U,nonce:B,uri:$,exp:P,nbf:g,type:w,statement:x,requestId:O,resources:_,signatureTypes:S}=A;return{domain:k,chains:U,nonce:B,type:w??"caip122",aud:$,version:"1",iat:new Date().toISOString(),exp:P,nbf:g,statement:x,requestId:O,resources:_,signatureTypes:S}}),walletPay:f}}),E=ie("session_connect",b.id),{reject:D,resolve:C,done:T}=Ur(p,Ch),R=({id:A})=>{A===b.id&&(this.client.events.off("proposal_expire",R),this.pendingSessions.delete(b.id),this.events.emit(E,{error:{message:Ch,code:0}}))};return this.client.events.on("proposal_expire",R),this.events.once(E,({error:A,session:k})=>{this.client.events.off("proposal_expire",R),A?D(A):k&&C(k)}),await this.setProposal(b.id,b),await this.sendProposeSession({proposal:b,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:b.id}}}).catch(A=>{throw this.deleteProposal(b.id),A}),{uri:y,approval:T}}),F(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),F(this,"approve",async r=>{var i,n,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=r?.id)==null?void 0:i.toString(),trace:[vt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(k){throw o.setError(Tr.no_internet_connection),k}try{await this.isValidProposalId(r?.id)}catch(k){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(Tr.proposal_not_found),k}try{await this.isValidApprove(r)}catch(k){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Tr.session_approve_namespace_validation_failure),k}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=r,d=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:y,proposer:m,requiredNamespaces:v,optionalNamespaces:I}=d;let b=(n=this.client.core.eventClient)==null?void 0:n.getEvent({topic:y});b||(b=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:vt.session_approve_started,properties:{topic:y,trace:[vt.session_approve_started,vt.session_namespaces_validation_success]}}));const E=await this.client.core.crypto.generateKeyPair(),D=m.publicKey,C=await this.client.core.crypto.generateSharedKey(E,D),T=Ae(re(re(re({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:E,metadata:this.client.metadata},expiry:de(ai)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{proposalRequestsResponses:p}),R=ae.relay;b.addTrace(vt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(C,{transportType:R,internal:{skipSubscribe:!0}})}catch(k){throw b.setError(Tr.subscribe_session_topic_failure),k}b.addTrace(vt.subscribe_session_topic_success);const A=Ae(re({},T),{topic:C,requiredNamespaces:v,optionalNamespaces:I,pairingTopic:y,acknowledged:!1,self:T.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:E,transportType:ae.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});await this.client.session.set(C,A),b.addTrace(vt.store_session);try{await this.sendApproveSession({sessionTopic:C,proposal:d,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:E},sessionSettleRequest:T,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:re({correlationId:a},this.getTVFApproveParams(A))}}),b.addTrace(vt.session_approve_publish_success)}catch(k){throw this.client.logger.error(k),this.client.session.delete(C,ce("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(C),k}return this.client.core.eventClient.deleteEvent({eventId:b.eventId}),await this.client.core.pairing.updateMetadata({topic:y,metadata:m.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:y}),await this.setExpiry(C,de(ai)),{topic:C,acknowledged:()=>Promise.resolve(this.client.session.get(C))}}),F(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:n}=r;let s;try{s=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}s&&await this.sendError({id:i,topic:s,error:n,rpcOpts:De.wc_sessionPropose.reject}),await this.deleteProposal(i)}),F(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:i,namespaces:n}=r,{done:s,resolve:o,reject:a}=Ur(L.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=Tt(),l=xr().toString(),u=this.client.session.get(i).namespaces;return this.events.once(ie("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(i,{namespaces:n}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(i,{namespaces:u}),a(h)}),{acknowledged:s}}),F(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,n=Tt(),{done:s,resolve:o,reject:a}=Ur(L.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(ie("session_extend",n),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,de(ai)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),F(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:i,request:n,topic:s,expiry:o=De.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(s);a?.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const c=Tt(),l=xr().toString(),{done:u,resolve:h,reject:f}=Ur(o,"Request expired. Please try again.");this.events.once(ie("session_request",c),({error:m,result:v})=>{m?f(m):h(v)});const p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:p,params:{request:Ae(re({},n),{expiryTimestamp:de(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(m=>f(m)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),await u();const y={request:Ae(re({},n),{expiryTimestamp:de(o)}),chainId:i};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:p,params:y,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,y)}).catch(v=>f(v)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),m()}),new Promise(async m=>{var v;if(!((v=a.sessionConfig)!=null&&v.disableDeepLink)){const I=await e2(this.client.core.storage,Ph);await JE({id:c,topic:s,wcDeepLink:I})}m()}),u()]).then(m=>m[2])}),F(this,"respond",async r=>{var i,n;this.isInitialized();const s=this.client.core.eventClient.createEvent({properties:{topic:r?.topic||((n=(i=r?.response)==null?void 0:i.id)==null?void 0:n.toString()),trace:[vt.session_request_response_started]}});try{await this.isValidRespond(r)}catch(h){throw s.addTrace(h?.message),s.setError(Tr.session_request_response_validation_failure),h}s.addTrace(vt.session_request_response_validation_success);const{topic:o,response:a}=r,{id:c}=a,l=this.client.session.get(o);l.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const u=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{s.addTrace(vt.session_request_response_publish_started),Rt(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:u}):pt(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:u}),this.cleanupAfterResponse(r)}catch(h){throw s.addTrace(h?.message),s.setError(Tr.session_request_response_publish_failure),h}}),F(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=Tt(),s=xr().toString(),{done:o,resolve:a,reject:c}=Ur(L.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(ie("session_ping",n),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:n,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),F(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:n,chainId:s}=r,o=xr().toString(),a=Tt();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:n,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),F(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:ce("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:n}=z("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(n)}}),F(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>m3(i,r)))),F(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),F(this,"authenticate",async(r,i)=>{var n;this.isInitialized(),this.isValidAuthenticate(r);const s=i&&this.client.core.linkModeSupportedApps.includes(i)&&((n=this.client.metadata.redirect)==null?void 0:n.linkMode),o=s?ae.link_mode:ae.relay;o===ae.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:f,exp:p,nbf:d,methods:y=[],expiry:m}=r,v=[...r.resources||[]],{topic:I,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:I,uri:b}});const E=await this.client.core.crypto.generateKeyPair(),D=Mn(E);if(await Promise.all([this.client.auth.authKeys.set(Kn,{responseTopic:D,publicKey:E}),this.client.auth.pairingTopics.set(D,{topic:D,pairingTopic:I})]),await this.client.core.relayer.subscribe(D,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${I}`),y.length>0){const{namespace:_}=ir(a[0]);let S=mx(_,"request",y);qn(v)&&(S=vx(S,v.pop())),v.push(S)}const C=m&&m>De.wc_sessionAuthenticate.req.ttl?m:De.wc_sessionAuthenticate.req.ttl,T={authPayload:{type:f??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:d,resources:v},requester:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:de(C)},R={eip155:{chains:a,methods:[...new Set(["personal_sign",...y])],events:["chainChanged","accountsChanged"]}},A={requiredNamespaces:{},optionalNamespaces:R,relays:[{protocol:"irn"}],pairingTopic:I,proposer:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:de(De.wc_sessionPropose.req.ttl),id:Tt()},{done:k,resolve:U,reject:B}=Ur(C,"Request expired"),$=Tt(),P=ie("session_connect",A.id),g=ie("session_request",$),w=async({error:_,session:S})=>{this.events.off(g,x),_?B(_):S&&U({session:S})},x=async _=>{var S,N,j;if(await this.deletePendingAuthRequest($,{message:"fulfilled",code:0}),_.error){const W=ce("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return _.error.code===W.code?void 0:(this.events.off(P,w),B(_.error.message))}await this.deleteProposal(A.id),this.events.off(P,w);const{cacaos:V,responder:q}=_.result,M=[],H=[];for(const W of V){await hu({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),B(ce("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:J}=W,ue=qn(J.resources),ye=[fa(J.iss)],be=rs(J.iss);if(ue){const ke=fu(ue),Ot=du(ue);M.push(...ke),ye.push(...Ot)}for(const ke of ye)H.push(`${ke}:${be}`)}const G=await this.client.core.crypto.generateSharedKey(E,q.publicKey);let Z;M.length>0&&(Z={topic:G,acknowledged:!0,self:{publicKey:E,metadata:this.client.metadata},peer:q,controller:q.publicKey,expiry:de(ai),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:I,namespaces:Fu([...new Set(M)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,Z),I&&await this.client.core.pairing.updateMetadata({topic:I,metadata:q.metadata}),Z=this.client.session.get(G)),(S=this.client.metadata.redirect)!=null&&S.linkMode&&(N=q.metadata.redirect)!=null&&N.linkMode&&(j=q.metadata.redirect)!=null&&j.universal&&i&&(this.client.core.addLinkModeSupportedApp(q.metadata.redirect.universal),this.client.session.update(G,{transportType:ae.link_mode})),U({auths:V,session:Z})};this.events.once(P,w),this.events.once(g,x);let O;try{if(s){const _=It("wc_sessionAuthenticate",T,$);this.client.core.history.set(I,_);const S=await this.client.core.crypto.encode("",_,{type:dn,encoding:vr});O=Pn(i,I,S)}else await Promise.all([this.sendRequest({topic:I,method:"wc_sessionAuthenticate",params:T,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:$}),this.sendRequest({topic:I,method:"wc_sessionPropose",params:A,expiry:De.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:A.id})])}catch(_){throw this.events.off(P,w),this.events.off(g,x),_}return await this.setProposal(A.id,A),await this.setAuthRequest($,{request:Ae(re({},T),{verifyContext:{}}),pairingTopic:I,transportType:o}),{uri:O??b,response:k}}),F(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:n}=r,s=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Rr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw s.setError(Ri.no_internet_connection),m}const o=this.getPendingAuthRequest(i);if(!o)throw s.setError(Ri.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||ae.relay;a===ae.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=Mn(c),h={type:nr,receiverPublicKey:c,senderPublicKey:l},f=[],p=[];for(const m of n){if(!await hu({cacao:m,projectId:this.client.core.projectId})){s.setError(Ri.invalid_cacao);const D=ce("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:u,error:D,encodeOpts:h}),new Error(D.message)}s.addTrace(Rr.cacaos_verified);const{p:v}=m,I=qn(v.resources),b=[fa(v.iss)],E=rs(v.iss);if(I){const D=fu(I),C=du(I);f.push(...D),b.push(...C)}for(const D of b)p.push(`${D}:${E}`)}const d=await this.client.core.crypto.generateSharedKey(l,c);s.addTrace(Rr.create_authenticated_session_topic);let y;if(f?.length>0){y={topic:d,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:de(ai),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Fu([...new Set(f)],[...new Set(p)]),transportType:a},s.addTrace(Rr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(m){throw s.setError(Ri.subscribe_authenticated_session_topic_failure),m}s.addTrace(Rr.subscribe_authenticated_session_topic_success),await this.client.session.set(d,y),s.addTrace(Rr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(Rr.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:i,result:{cacaos:n,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw s.setError(Ri.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:y}}),F(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:n}=r,s=this.getPendingAuthRequest(i);if(!s)throw new Error(`Could not find pending auth request with id ${i}`);s.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Mn(o),l={type:nr,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:n,encodeOpts:l,rpcOpts:De.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),F(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:n}=r;return ep(i,n)}),F(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),F(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),F(this,"deleteSession",async r=>{var i;const{topic:n,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,ce("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),s||this.client.core.expirer.del(n),this.client.core.storage.removeItem(Ph).catch(l=>this.client.logger.warn(l)),n===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=Ct.idle),await Promise.all(this.getPendingSessionRequests().filter(l=>l.topic===n).map(l=>this.deletePendingSessionRequest(l.id,ce("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:n})}),F(this,"deleteProposal",async(r,i)=>{if(i)try{const n=this.client.proposal.get(r);this.client.core.eventClient.getEvent({topic:n.pairingTopic})?.setError(Tr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,ce("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),F(this,"deletePendingSessionRequest",async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),n&&(this.sessionRequestQueue.state=Ct.idle,this.client.events.emit("session_request_expire",{id:r}))}),F(this,"deletePendingAuthRequest",async(r,i,n=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)])}),F(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),F(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,de(De.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),F(this,"setAuthRequest",async(r,i)=>{const{request:n,pairingTopic:s,transportType:o=ae.relay}=i;this.client.core.expirer.set(r,n.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:r,pairingTopic:s,verifyContext:n.verifyContext,transportType:o})}),F(this,"setPendingSessionRequest",async r=>{const{id:i,topic:n,params:s,verifyContext:o}=r,a=s.request.expiryTimestamp||de(De.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:n,params:s,verifyContext:o})}),F(this,"sendRequest",async r=>{const{topic:i,method:n,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:f={}}=r,p=It(n,s,c);let d;const y=!!u;try{const I=y?vr:Ge;d=await this.client.core.crypto.encode(i,p,{encoding:I})}catch(I){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),I}let m;if(jD.includes(n)){const I=dt(JSON.stringify(p)),b=dt(d);m=await this.client.core.verify.register({id:b,decryptedId:I})}const v=re(re({},De[n].req),f);if(v.attestation=m,o&&(v.ttl=o),a&&(v.id=a),this.client.core.history.set(i,p),y){const I=Pn(u,i,d);await global.Linking.openURL(I,this.client.name)}else v.tvf=Ae(re({},h),{correlationId:p.id}),l?(v.internal=Ae(re({},v.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,d,v)):this.client.core.relayer.publish(i,d,v).catch(I=>this.client.logger.error(I));return p.id}),F(this,"sendProposeSession",async r=>{const{proposal:i,publishOpts:n}=r,s=It("wc_sessionPropose",i,i.id);this.client.core.history.set(i.pairingTopic,s);const o=await this.client.core.crypto.encode(i.pairingTopic,s,{encoding:Ge}),a=dt(JSON.stringify(s)),c=dt(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:i.pairingTopic,sessionProposal:o},opts:Ae(re({},n),{publishMethod:"wc_proposeSession",attestation:l})})}),F(this,"sendApproveSession",async r=>{const{sessionTopic:i,pairingProposalResponse:n,proposal:s,sessionSettleRequest:o,publishOpts:a}=r,c=rn(s.id,n),l=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:Ge}),u=It("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(i,u,{encoding:Ge});this.client.core.history.set(i,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:i,pairingTopic:s.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:Ae(re({},a),{publishMethod:"wc_approveSession"})})}),F(this,"sendResult",async r=>{const{id:i,topic:n,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,l=rn(i,s);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=h?vr:Ge;u=await this.client.core.crypto.encode(n,l,Ae(re({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),d}let f,p;try{f=await this.client.core.history.get(n,i);const d=f.request;try{p=this.getTVFParams(i,d.params,s)}catch(y){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${y?.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${i}) failed`),d}if(h){const d=Pn(c,n,u);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,y=De[d].res;y.tvf=Ae(re({},p),{correlationId:i}),o?(y.internal=Ae(re({},y.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,u,y)):this.client.core.relayer.publish(n,u,y).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(l)}),F(this,"sendError",async r=>{const{id:i,topic:n,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=r,l=Ps(i,s);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?vr:Ge;u=await this.client.core.crypto.encode(n,l,Ae(re({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),p}let f;try{f=await this.client.core.history.get(n,i)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${n}, ${i}) failed`),p}if(h){const p=Pn(c,n,u);await global.Linking.openURL(p,this.client.name)}else{const p=f.request.method,d=a||De[p].res;this.client.core.relayer.publish(n,u,d)}await this.client.core.history.resolve(l)}),F(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{let s=!1;Ut(n.expiry)&&(s=!0),this.client.core.crypto.keychain.has(n.topic)||(s=!0),s&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Ut(n.expiryTimestamp)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession({topic:n})),...i.map(n=>this.deleteProposal(n))])}),F(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),F(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),F(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Ct.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ct.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Ct.idle}),F(this,"processRequest",async r=>{const{topic:i,payload:n,attestation:s,transportType:o,encryptedId:a}=r,c=n.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:n,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,n);case"wc_sessionPing":return await this.onSessionPingRequest(i,n);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,n);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),F(this,"onRelayEventResponse",async r=>{const{topic:i,payload:n,transportType:s}=r,o=(await this.client.core.history.get(i,n.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),F(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:n}=z("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)}),F(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:n}=r,s=this.expectedPairingMethodMap.get(i);return!s||s.includes(n)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),F(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:n,attestation:s,encryptedId:o}=r,{params:a,id:c}=n;try{const l=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(Zt.proposal_listener_not_found)),this.isValidConnect(re({},n.params));const u=a.expiryTimestamp||de(De.wc_sessionPropose.req.ttl),h=re({id:c,pairingTopic:i,expiryTimestamp:u,attestation:s,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:s,hash:dt(JSON.stringify(n)),encryptedId:o,metadata:h.proposer.metadata});l?.addTrace(Bt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(l){await this.sendError({id:c,topic:i,error:l,rpcOpts:De.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),F(this,"onSessionProposeResponse",async(r,i,n)=>{const{id:s}=i;if(Rt(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(s,{sessionTopic:u,pairingTopic:r,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:n});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(pt(i)){await this.deleteProposal(s);const o=ie("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),F(this,"onSessionSettleRequest",async(r,i)=>{const{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=i.params,d=[...this.pendingSessions.values()].find(v=>v.sessionTopic===r);if(!d)return this.client.logger.error(`Pending session not found for topic ${r}`);const y=this.client.proposal.get(d.proposalId),m=Ae(re(re(re({topic:r,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:y.requiredNamespaces,optionalNamespaces:y.optionalNamespaces,controller:a.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:ae.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:m.peer.metadata}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:i.id,topic:r,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:m}),this.events.emit(ie("session_connect",d.proposalId),{session:m})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionSettleResponse",async(r,i)=>{const{id:n}=i;Rt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ie("session_approve",n),{})):pt(i)&&(await this.client.session.delete(r,ce("USER_DISCONNECTED")),this.events.emit(ie("session_approve",n),{error:i.error}))}),F(this,"onSessionUpdateRequest",async(r,i)=>{const{params:n,id:s}=i;try{const o=`${r}_session_update`,a=Bi.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:r,error:ce("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(re({topic:r},n));try{Bi.set(o,s),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult({id:s,topic:r,result:!0})}catch(c){throw Bi.delete(o),c}this.client.events.emit("session_update",{id:s,topic:r,params:n})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),F(this,"onSessionUpdateResponse",(r,i)=>{const{id:n}=i,s=ie("session_update",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Rt(i)?this.events.emit(ie("session_update",n),{}):pt(i)&&this.events.emit(ie("session_update",n),{error:i.error})}),F(this,"onSessionExtendRequest",async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,de(ai)),await this.sendResult({id:n,topic:r,result:!0}),this.client.events.emit("session_extend",{id:n,topic:r})}catch(s){await this.sendError({id:n,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionExtendResponse",(r,i)=>{const{id:n}=i,s=ie("session_extend",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Rt(i)?this.events.emit(ie("session_extend",n),{}):pt(i)&&this.events.emit(ie("session_extend",n),{error:i.error})}),F(this,"onSessionPingRequest",async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:r})}catch(s){await this.sendError({id:n,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionPingResponse",(r,i)=>{const{id:n}=i,s=ie("session_ping",n);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);Rt(i)?this.events.emit(ie("session_ping",n),{}):pt(i)&&this.events.emit(ie("session_ping",n),{error:i.error})},500)}),F(this,"onSessionDeleteRequest",async(r,i)=>{const{id:n}=i;try{await this.isValidDisconnect({topic:r,reason:i.params}),this.cleanupPendingSentRequestsForTopic({topic:r,error:ce("USER_DISCONNECTED")}),await this.deleteSession({topic:r,id:n})}catch(s){this.client.logger.error(s)}}),F(this,"onSessionRequest",async r=>{var i,n,s;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=r,{id:h,params:f}=a;try{await this.isValidRequest(re({topic:o},f));const p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:dt(JSON.stringify(It("wc_sessionRequest",f,h))),encryptedId:l,metadata:p.peer.metadata,transportType:u}),y={id:h,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(y),u===ae.link_mode&&(i=p.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((n=p.peer.metadata.redirect)==null?void 0:n.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(y):(this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),F(this,"onSessionRequestResponse",(r,i)=>{const{id:n}=i,s=ie("session_request",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Rt(i)?this.events.emit(ie("session_request",n),{result:i.result}):pt(i)&&this.events.emit(ie("session_request",n),{error:i.error})}),F(this,"onSessionEventRequest",async(r,i)=>{const{id:n,params:s}=i;try{const o=`${r}_session_event_${s.event.name}`,a=Bi.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(re({topic:r},s)),this.client.events.emit("session_event",{id:n,topic:r,params:s}),Bi.set(o,n)}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:n}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),Rt(i)?this.events.emit(ie("session_request",n),{result:i.result}):pt(i)&&this.events.emit(ie("session_request",n),{error:i.error})}),F(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:n,payload:s,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:l,authPayload:u,expiryTimestamp:h}=s.params,f=await this.getVerifyContext({attestationId:o,hash:dt(JSON.stringify(s)),encryptedId:a,metadata:l.metadata,transportType:c}),p={requester:l,pairingTopic:n,id:s.id,authPayload:u,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:p,pairingTopic:n,transportType:c}),c===ae.link_mode&&(i=l.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:n,params:s.params,id:s.id,verifyContext:f})}catch(l){this.client.logger.error(l);const u=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(s.params.requester.metadata,c),p={type:nr,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:s.id,topic:n,error:l,encodeOpts:p,rpcOpts:De.wc_sessionAuthenticate.autoReject,appLink:f})}}),F(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),F(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ct.idle,this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay))}),F(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const n=this.client.core.history.pending;n.length>0&&n.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{this.events.emit(ie("session_request",s.request.id),{error:i})})}),F(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Ct.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),F(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=Ct.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),F(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(n=>n.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:It("wc_sessionPropose",Ae(re({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),F(this,"isValidConnect",async r=>{if(!Ke(r)){const{message:l}=z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Ie(i)||await this.isValidPairingTopic(i),!P3(c)){const{message:l}=z("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(n&&!Ie(n)&&qt(n)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(n,"requiredNamespaces")}if(s&&!Ie(s)&&qt(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),o&&!Ie(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ie(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(n||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),F(this,"validateNamespaces",(r,i)=>{const n=A3(r,"connect()",i);if(n)throw new Error(n.message)}),F(this,"isValidApprove",async r=>{if(!Ke(r))throw new Error(z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:s,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),l=So(n,"approve()");if(l)throw new Error(l.message);const u=Lu(c.requiredNamespaces,n,"approve()");if(u)throw new Error(u.message);if(!ge(s,!0)){const{message:h}=z("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(o&&!Ie(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ie(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(n));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),F(this,"isValidReject",async r=>{if(!Ke(r)){const{message:s}=z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:i,reason:n}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!B3(n)){const{message:s}=z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}}),F(this,"isValidSessionSettleRequest",r=>{if(!Ke(r)){const{message:l}=z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:n,namespaces:s,expiry:o}=r;if(!kp(i)){const{message:l}=z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=_3(n,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=So(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Ut(o)){const{message:l}=z("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),F(this,"isValidUpdate",async r=>{if(!Ke(r)){const{message:c}=z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:n}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const s=this.client.session.get(i),o=So(n,"update()");if(o)throw new Error(o.message);const a=Lu(s.requiredNamespaces,n,"update()");if(a)throw new Error(a.message)}),F(this,"isValidExtend",async r=>{if(!Ke(r)){const{message:n}=z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),F(this,"isValidRequest",async r=>{if(!Ke(r)){const{message:c}=z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:n,chainId:s,expiry:o}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Mu(a,s)){const{message:c}=z("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!T3(n)){const{message:c}=z("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(c)}if(!U3(a,s,n.method)){const{message:c}=z("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),F(this,"isValidRespond",async r=>{var i;if(!Ke(r)){const{message:a}=z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:n,response:s}=r;try{await this.isValidSessionTopic(n)}catch(a){throw(i=r?.response)!=null&&i.id&&this.cleanupAfterResponse(r),a}if(!R3(s)){const{message:a}=z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}const o=this.client.pendingRequest.get(s.id);if(o.topic!==n){const{message:a}=z("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${s.id}, expected topic: ${o.topic}, received topic: ${n}`);throw new Error(a)}}),F(this,"isValidPing",async r=>{if(!Ke(r)){const{message:n}=z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),F(this,"isValidEmit",async r=>{if(!Ke(r)){const{message:a}=z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:n,chainId:s}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!Mu(o,s)){const{message:a}=z("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!N3(n)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}if(!j3(o,s,n.name)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}}),F(this,"isValidDisconnect",async r=>{if(!Ke(r)){const{message:n}=z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),F(this,"isValidAuthenticate",r=>{const{chains:i,uri:n,domain:s,nonce:o}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!ge(n,!1))throw new Error("uri is required parameter");if(!ge(s,!1))throw new Error("domain is required parameter");if(!ge(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>ir(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=ir(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),F(this,"getVerifyContext",async r=>{const{attestationId:i,hash:n,encryptedId:s,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Hi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ae.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:i,hash:n,encryptedId:s,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),F(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((n,s)=>{if(n==null){const{message:o}=z("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${n} for key ${Object.keys(r)[s]}`);throw new Error(o)}})}),F(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),F(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let n=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(n++>=s)break;this.recentlyDeletedMap.delete(o)}}}),F(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:n}=z("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(n)}}),F(this,"isLinkModeEnabled",(r,i)=>{var n,s,o,a,c,l,u,h,f;return!r||i!==ae.link_mode?!1:((s=(n=this.client.metadata)==null?void 0:n.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=r?.redirect)==null?void 0:u.universal)!==void 0&&((h=r?.redirect)==null?void 0:h.universal)!==""&&((f=r?.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),F(this,"getAppLinkIfEnabled",(r,i)=>{var n;return this.isLinkModeEnabled(r,i)?(n=r?.redirect)==null?void 0:n.universal:void 0}),F(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=Ql(r,"topic")||"",n=decodeURIComponent(Ql(r,"wc_ev")||""),s=this.client.session.keys.includes(i);s&&this.client.session.update(i,{transportType:ae.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:n,sessionExists:s})}),F(this,"registerLinkModeListeners",async()=>{var r;if(hc()||Dr()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const n=await i.getInitialURL();n&&setTimeout(()=>{this.handleLinkModeMessage({url:n})},50)}}}),F(this,"getTVFApproveParams",r=>{try{const i=Up(r.namespaces),n=u3(r.namespaces),s=h3(r.namespaces),o=r.sessionProperties,a=r.scopedProperties;return{approvedChains:i,approvedMethods:n,approvedEvents:s,sessionProperties:o,scopedProperties:a}}catch(i){return this.client.logger.warn(i,"Error getting TVF approve params"),{}}}),F(this,"getTVFParams",(r,i,n)=>{var s,o,a;if(!((s=i.request)!=null&&s.method))return{};const c={correlationId:r,rpcMethods:[i.request.method],chainId:i.chainId};try{const l=this.extractTxHashesFromResult(i.request,n);c.txHashes=l,c.contractAddresses=this.isValidContractData(i.request.params)?[(a=(o=i.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),F(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const n=r?.data||((i=r?.[0])==null?void 0:i.data);if(!n.startsWith("0x"))return!1;const s=n.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),F(this,"extractTxHashesFromResult",(r,i)=>{var n;try{if(!i)return[];const s=r.method,o=ND[s];if(s==="sui_signTransaction")return[Q2(i.transactionBytes)];if(s==="near_signTransaction")return[au(i)];if(s==="near_signTransactions")return i.map(c=>au(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(n=i.tx_json)==null?void 0:n.hash];if(s==="polkadot_signTransaction")return[tI({transaction:r.params.transactionPayload,signature:i.signature})];if(s==="algo_signTxn")return yt(i)?i.map(c=>cu(c)):[cu(i)];if(s==="cosmos_signDirect")return[tx(i)];if(s==="wallet_sendCalls")return rx(i);if(typeof i=="string")return[i];const a=i[o.key];if(yt(a))return s==="solana_signAllTransactions"?a.map(c=>X2(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn(s,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,n]of Object.entries(r))for(const s of n)try{await this.onProviderMessageEvent({topic:i,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${s}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(pe.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:n,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Kn)?this.client.auth.authKeys.get(Kn):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,i,{receiverPublicKey:o,encoding:s===ae.link_mode?vr:Ge});Ic(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:n,transportType:s,encryptedId:dt(i)})):Cs(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:s}),this.client.core.history.delete(r,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:s})),await this.client.core.relayer.messages.ack(r,i)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${i}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(ht.expired,async e=>{const{topic:r,id:i}=jd(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,z("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Fr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Fr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ge(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=z("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!ge(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=z("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=z("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ge(e,!1)){const{message:r}=z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!C3(e)){const{message:r}=z("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=z("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}validateRequestExpiry(e){if(e&&!q3(e,Ro)){const{message:r}=z("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${Ro.min} and ${Ro.max}`);throw new Error(r)}}}class YD extends ei{constructor(e,r){super(e,r,BD,$c),this.core=e,this.logger=r}}let ZD=class extends ei{constructor(e,r){super(e,r,TD,$c),this.core=e,this.logger=r}};class JD extends ei{constructor(e,r){super(e,r,UD,$c,i=>i.id),this.core=e,this.logger=r}}class XD extends ei{constructor(e,r){super(e,r,qD,Ts,()=>Kn),this.core=e,this.logger=r}}class QD extends ei{constructor(e,r){super(e,r,MD,Ts),this.core=e,this.logger=r}}class eA extends ei{constructor(e,r){super(e,r,LD,Ts,i=>i.id),this.core=e,this.logger=r}}var tA=Object.defineProperty,rA=(t,e,r)=>e in t?tA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,No=(t,e,r)=>rA(t,typeof e!="symbol"?e+"":e,r);class iA{constructor(e,r){this.core=e,this.logger=r,No(this,"authKeys"),No(this,"pairingTopics"),No(this,"requests"),this.authKeys=new XD(this.core,this.logger),this.pairingTopics=new QD(this.core,this.logger),this.requests=new eA(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var nA=Object.defineProperty,sA=(t,e,r)=>e in t?nA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Q=(t,e,r)=>sA(t,typeof e!="symbol"?e+"":e,r);let oA=class dg extends rS{constructor(e){super(e),Q(this,"protocol",ug),Q(this,"version",hg),Q(this,"name",To.name),Q(this,"metadata"),Q(this,"core"),Q(this,"logger"),Q(this,"events",new ot.EventEmitter),Q(this,"engine"),Q(this,"session"),Q(this,"proposal"),Q(this,"pendingRequest"),Q(this,"auth"),Q(this,"signConfig"),Q(this,"on",(i,n)=>this.events.on(i,n)),Q(this,"once",(i,n)=>this.events.once(i,n)),Q(this,"off",(i,n)=>this.events.off(i,n)),Q(this,"removeListener",(i,n)=>this.events.removeListener(i,n)),Q(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),Q(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"update",async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"request",async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"find",i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),Q(this,"authenticate",async(i,n)=>{try{return await this.engine.authenticate(i,n)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),this.name=e?.name||To.name,this.metadata=KE(e?.metadata),this.signConfig=e?.signConfig;const r=xc({logger:e?.logger||To.logger,name:this.name});this.logger=r,this.core=e?.core||new CD(e),this.session=new ZD(this.core,this.logger),this.proposal=new YD(this.core,this.logger),this.pendingRequest=new JD(this.core,this.logger),this.engine=new GD(this),this.auth=new iA(this.core,this.logger)}static async init(e){const r=new dg(e);return await r.initialize(),r}get context(){return Xe(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const aA=oA;var Tn={exports:{}},Th;function cA(){return Th||(Th=1,(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Nt<"u"&&Nt,i=(function(){function s(){this.fetch=!1,this.DOMException=r.DOMException}return s.prototype=r,new s})();(function(s){(function(o){var a=typeof s<"u"&&s||typeof self<"u"&&self||typeof Nt<"u"&&Nt||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(g){return g&&DataView.prototype.isPrototypeOf(g)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(g){return g&&u.indexOf(Object.prototype.toString.call(g))>-1};function f(g){if(typeof g!="string"&&(g=String(g)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(g)||g==="")throw new TypeError('Invalid character in header field name: "'+g+'"');return g.toLowerCase()}function p(g){return typeof g!="string"&&(g=String(g)),g}function d(g){var w={next:function(){var x=g.shift();return{done:x===void 0,value:x}}};return c.iterable&&(w[Symbol.iterator]=function(){return w}),w}function y(g){this.map={},g instanceof y?g.forEach(function(w,x){this.append(x,w)},this):Array.isArray(g)?g.forEach(function(w){if(w.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+w.length);this.append(w[0],w[1])},this):g&&Object.getOwnPropertyNames(g).forEach(function(w){this.append(w,g[w])},this)}y.prototype.append=function(g,w){g=f(g),w=p(w);var x=this.map[g];this.map[g]=x?x+", "+w:w},y.prototype.delete=function(g){delete this.map[f(g)]},y.prototype.get=function(g){return g=f(g),this.has(g)?this.map[g]:null},y.prototype.has=function(g){return this.map.hasOwnProperty(f(g))},y.prototype.set=function(g,w){this.map[f(g)]=p(w)},y.prototype.forEach=function(g,w){for(var x in this.map)this.map.hasOwnProperty(x)&&g.call(w,this.map[x],x,this)},y.prototype.keys=function(){var g=[];return this.forEach(function(w,x){g.push(x)}),d(g)},y.prototype.values=function(){var g=[];return this.forEach(function(w){g.push(w)}),d(g)},y.prototype.entries=function(){var g=[];return this.forEach(function(w,x){g.push([x,w])}),d(g)},c.iterable&&(y.prototype[Symbol.iterator]=y.prototype.entries);function m(g){if(!g._noBody){if(g.bodyUsed)return Promise.reject(new TypeError("Already read"));g.bodyUsed=!0}}function v(g){return new Promise(function(w,x){g.onload=function(){w(g.result)},g.onerror=function(){x(g.error)}})}function I(g){var w=new FileReader,x=v(w);return w.readAsArrayBuffer(g),x}function b(g){var w=new FileReader,x=v(w),O=/charset=([A-Za-z0-9_-]+)/.exec(g.type),_=O?O[1]:"utf-8";return w.readAsText(g,_),x}function E(g){for(var w=new Uint8Array(g),x=new Array(w.length),O=0;O<w.length;O++)x[O]=String.fromCharCode(w[O]);return x.join("")}function D(g){if(g.slice)return g.slice(0);var w=new Uint8Array(g.byteLength);return w.set(new Uint8Array(g)),w.buffer}function C(){return this.bodyUsed=!1,this._initBody=function(g){this.bodyUsed=this.bodyUsed,this._bodyInit=g,g?typeof g=="string"?this._bodyText=g:c.blob&&Blob.prototype.isPrototypeOf(g)?this._bodyBlob=g:c.formData&&FormData.prototype.isPrototypeOf(g)?this._bodyFormData=g:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)?this._bodyText=g.toString():c.arrayBuffer&&c.blob&&l(g)?(this._bodyArrayBuffer=D(g.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(g)||h(g))?this._bodyArrayBuffer=D(g):this._bodyText=g=Object.prototype.toString.call(g):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof g=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var g=m(this);if(g)return g;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var g=m(this);return g||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(I);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var g=m(this);if(g)return g;if(this._bodyBlob)return b(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(E(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(k)}),this.json=function(){return this.text().then(JSON.parse)},this}var T=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function R(g){var w=g.toUpperCase();return T.indexOf(w)>-1?w:g}function A(g,w){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');w=w||{};var x=w.body;if(g instanceof A){if(g.bodyUsed)throw new TypeError("Already read");this.url=g.url,this.credentials=g.credentials,w.headers||(this.headers=new y(g.headers)),this.method=g.method,this.mode=g.mode,this.signal=g.signal,!x&&g._bodyInit!=null&&(x=g._bodyInit,g.bodyUsed=!0)}else this.url=String(g);if(this.credentials=w.credentials||this.credentials||"same-origin",(w.headers||!this.headers)&&(this.headers=new y(w.headers)),this.method=R(w.method||this.method||"GET"),this.mode=w.mode||this.mode||null,this.signal=w.signal||this.signal||(function(){if("AbortController"in a){var S=new AbortController;return S.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&x)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(x),(this.method==="GET"||this.method==="HEAD")&&(w.cache==="no-store"||w.cache==="no-cache")){var O=/([?&])_=[^&]*/;if(O.test(this.url))this.url=this.url.replace(O,"$1_="+new Date().getTime());else{var _=/\?/;this.url+=(_.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}A.prototype.clone=function(){return new A(this,{body:this._bodyInit})};function k(g){var w=new FormData;return g.trim().split("&").forEach(function(x){if(x){var O=x.split("="),_=O.shift().replace(/\+/g," "),S=O.join("=").replace(/\+/g," ");w.append(decodeURIComponent(_),decodeURIComponent(S))}}),w}function U(g){var w=new y,x=g.replace(/\r?\n[\t ]+/g," ");return x.split("\r").map(function(O){return O.indexOf(`
`)===0?O.substr(1,O.length):O}).forEach(function(O){var _=O.split(":"),S=_.shift().trim();if(S){var N=_.join(":").trim();try{w.append(S,N)}catch(j){console.warn("Response "+j.message)}}}),w}C.call(A.prototype);function B(g,w){if(!(this instanceof B))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(w||(w={}),this.type="default",this.status=w.status===void 0?200:w.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=w.statusText===void 0?"":""+w.statusText,this.headers=new y(w.headers),this.url=w.url||"",this._initBody(g)}C.call(B.prototype),B.prototype.clone=function(){return new B(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new y(this.headers),url:this.url})},B.error=function(){var g=new B(null,{status:200,statusText:""});return g.ok=!1,g.status=0,g.type="error",g};var $=[301,302,303,307,308];B.redirect=function(g,w){if($.indexOf(w)===-1)throw new RangeError("Invalid status code");return new B(null,{status:w,headers:{location:g}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(w,x){this.message=w,this.name=x;var O=Error(w);this.stack=O.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function P(g,w){return new Promise(function(x,O){var _=new A(g,w);if(_.signal&&_.signal.aborted)return O(new o.DOMException("Aborted","AbortError"));var S=new XMLHttpRequest;function N(){S.abort()}S.onload=function(){var q={statusText:S.statusText,headers:U(S.getAllResponseHeaders()||"")};_.url.indexOf("file://")===0&&(S.status<200||S.status>599)?q.status=200:q.status=S.status,q.url="responseURL"in S?S.responseURL:q.headers.get("X-Request-URL");var M="response"in S?S.response:S.responseText;setTimeout(function(){x(new B(M,q))},0)},S.onerror=function(){setTimeout(function(){O(new TypeError("Network request failed"))},0)},S.ontimeout=function(){setTimeout(function(){O(new TypeError("Network request timed out"))},0)},S.onabort=function(){setTimeout(function(){O(new o.DOMException("Aborted","AbortError"))},0)};function j(q){try{return q===""&&a.location.href?a.location.href:q}catch{return q}}if(S.open(_.method,j(_.url),!0),_.credentials==="include"?S.withCredentials=!0:_.credentials==="omit"&&(S.withCredentials=!1),"responseType"in S&&(c.blob?S.responseType="blob":c.arrayBuffer&&(S.responseType="arraybuffer")),w&&typeof w.headers=="object"&&!(w.headers instanceof y||a.Headers&&w.headers instanceof a.Headers)){var V=[];Object.getOwnPropertyNames(w.headers).forEach(function(q){V.push(f(q)),S.setRequestHeader(q,p(w.headers[q]))}),_.headers.forEach(function(q,M){V.indexOf(M)===-1&&S.setRequestHeader(M,q)})}else _.headers.forEach(function(q,M){S.setRequestHeader(M,q)});_.signal&&(_.signal.addEventListener("abort",N),S.onreadystatechange=function(){S.readyState===4&&_.signal.removeEventListener("abort",N)}),S.send(typeof _._bodyInit>"u"?null:_._bodyInit)})}return P.polyfill=!0,a.fetch||(a.fetch=P,a.Headers=y,a.Request=A,a.Response=B),o.Headers=y,o.Request=A,o.Response=B,o.fetch=P,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var n=r.fetch?r:i;e=n.fetch,e.default=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,t.exports=e})(Tn,Tn.exports)),Tn.exports}var lA=cA();const Rh=lf(lA);var uA=Object.defineProperty,hA=Object.defineProperties,fA=Object.getOwnPropertyDescriptors,Nh=Object.getOwnPropertySymbols,dA=Object.prototype.hasOwnProperty,pA=Object.prototype.propertyIsEnumerable,Uh=(t,e,r)=>e in t?uA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jh=(t,e)=>{for(var r in e||(e={}))dA.call(e,r)&&Uh(t,r,e[r]);if(Nh)for(var r of Nh(e))pA.call(e,r)&&Uh(t,r,e[r]);return t},kh=(t,e)=>hA(t,fA(e));const gA={Accept:"application/json","Content-Type":"application/json"},yA="POST",Fh={headers:gA,method:yA},qh=10;let pg=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new ot.EventEmitter,this.isAvailable=!1,this.registering=!1,!rh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=Wr(e),i=await(await Rh(this.url,kh(jh({},Fh),{body:r}))).json();this.onPayload({data:i})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!rh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return n(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=Wr({id:1,jsonrpc:"2.0",method:"test",params:[]});await Rh(e,kh(jh({},Fh),{body:r}))}this.onOpen()}catch(r){const i=this.parseError(r);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Hr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=Ps(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return zp(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>qh&&this.events.setMaxListeners(qh)}};function wA(t){return Number.isSafeInteger(t)&&t>=0}function mA(t){return t!=null&&typeof t!="function"&&wA(t.length)}function bA(t){return t==="__proto__"}function Oc(t){return t==null||typeof t!="object"&&typeof t!="function"}function gg(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Dc(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const vA="[object RegExp]",yg="[object String]",wg="[object Number]",mg="[object Boolean]",bg="[object Arguments]",EA="[object Symbol]",xA="[object Date]",_A="[object Map]",IA="[object Set]",SA="[object Array]",$A="[object ArrayBuffer]",vg="[object Object]",OA="[object DataView]",DA="[object Uint8Array]",AA="[object Uint8ClampedArray]",PA="[object Uint16Array]",CA="[object Uint32Array]",BA="[object Int8Array]",TA="[object Int16Array]",RA="[object Int32Array]",NA="[object Float32Array]",UA="[object Float64Array]";function Ac(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function jA(t,e){return fi(t,void 0,t,new Map,e)}function fi(t,e,r,i=new Map,n=void 0){const s=n?.(t,e,r,i);if(s!==void 0)return s;if(Oc(t))return t;if(i.has(t))return i.get(t);if(Array.isArray(t)){const o=new Array(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=fi(t[a],a,r,i,n);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;i.set(t,o);for(const[a,c]of t)o.set(a,fi(c,a,r,i,n));return o}if(t instanceof Set){const o=new Set;i.set(t,o);for(const a of t)o.add(fi(a,void 0,r,i,n));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(Ac(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=fi(t[a],a,r,i,n);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return i.set(t,o),_t(o,t,r,i,n),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return i.set(t,o),_t(o,t,r,i,n),o}if(typeof Blob<"u"&&t instanceof Blob){const o=new Blob([t],{type:t.type});return i.set(t,o),_t(o,t,r,i,n),o}if(t instanceof Error){const o=new t.constructor;return i.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,_t(o,t,r,i,n),o}if(t instanceof Boolean){const o=new Boolean(t.valueOf());return i.set(t,o),_t(o,t,r,i,n),o}if(t instanceof Number){const o=new Number(t.valueOf());return i.set(t,o),_t(o,t,r,i,n),o}if(t instanceof String){const o=new String(t.valueOf());return i.set(t,o),_t(o,t,r,i,n),o}if(typeof t=="object"&&kA(t)){const o=Object.create(Object.getPrototypeOf(t));return i.set(t,o),_t(o,t,r,i,n),o}return t}function _t(t,e,r=t,i,n){const s=[...Object.keys(e),...gg(e)];for(let o=0;o<s.length;o++){const a=s[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=fi(e[a],a,r,i,n))}}function kA(t){switch(Dc(t)){case bg:case SA:case $A:case OA:case mg:case xA:case NA:case UA:case BA:case TA:case RA:case _A:case wg:case vg:case vA:case IA:case yg:case EA:case DA:case AA:case PA:case CA:return!0;default:return!1}}function FA(t,e){return jA(t,(r,i,n,s)=>{if(typeof t=="object"){if(Dc(t)===vg&&typeof t.constructor!="function"){const o={};return s.set(t,o),_t(o,t,n,s),o}switch(Object.prototype.toString.call(t)){case wg:case yg:case mg:{const o=new t.constructor(t?.valueOf());return _t(o,t),o}case bg:{const o={};return _t(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}}})}function Mh(t){return FA(t)}function Lh(t){return t!==null&&typeof t=="object"&&Dc(t)==="[object Arguments]"}function qa(t){return typeof t=="object"&&t!==null}function qA(t){return qa(t)&&mA(t)}function MA(){}function Uo(t){return Ac(t)}function jo(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const r=t[Symbol.toStringTag];return r==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${r}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function LA(t){if(Oc(t))return t;if(Array.isArray(t)||Ac(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t);if(e==null)return Object.assign(Object.create(e),t);const r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const i=new r(t);return i.lastIndex=t.lastIndex,i}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){let i;return t instanceof AggregateError?i=new r(t.errors,t.message,{cause:t.cause}):i=new r(t.message,{cause:t.cause}),i.stack=t.stack,Object.assign(i,t),i}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const i=Object.create(e);return Object.assign(i,t)}return t}function zA(t,...e){const r=e.slice(0,-1),i=e[e.length-1];let n=t;for(let s=0;s<r.length;s++){const o=r[s];n=Ma(n,o,i,new Map)}return n}function Ma(t,e,r,i){if(Oc(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(i.has(e))return LA(i.get(e));if(i.set(e,t),Array.isArray(e)){e=e.slice();for(let s=0;s<e.length;s++)e[s]=e[s]??void 0}const n=[...Object.keys(e),...gg(e)];for(let s=0;s<n.length;s++){const o=n[s];if(bA(o))continue;let a=e[o],c=t[o];if(Lh(a)&&(a={...a}),Lh(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=Mh(a)),Array.isArray(a))if(Array.isArray(c)){const u=[],h=Reflect.ownKeys(c);for(let f=0;f<h.length;f++){const p=h[f];u[p]=c[p]}c=u}else if(qA(c)){const u=[];for(let h=0;h<c.length;h++)u[h]=c[h];c=u}else c=[];const l=r(c,a,o,t,e,i);l!==void 0?t[o]=l:Array.isArray(a)||qa(c)&&qa(a)&&(jo(c)||jo(a)||Uo(c)||Uo(a))?t[o]=Ma(c,a,r,i):c==null&&jo(a)?t[o]=Ma({},a,r,i):c==null&&Uo(a)?t[o]=Mh(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function VA(t,...e){return zA(t,...e,MA)}const zh="error",KA="wss://relay.walletconnect.org",HA="wc",Eg="universal_provider",Rn=`${HA}@2:${Eg}:`,xg="https://rpc.walletconnect.org/v1/",_g="generic",WA=`${xg}bundler`,wi="call_status",GA=86400,Pc={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var YA=Object.defineProperty,ZA=Object.defineProperties,JA=Object.getOwnPropertyDescriptors,Vh=Object.getOwnPropertySymbols,XA=Object.prototype.hasOwnProperty,QA=Object.prototype.propertyIsEnumerable,Kh=(t,e,r)=>e in t?YA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nn=(t,e)=>{for(var r in e||(e={}))XA.call(e,r)&&Kh(t,r,e[r]);if(Vh)for(var r of Vh(e))QA.call(e,r)&&Kh(t,r,e[r]);return t},eP=(t,e)=>ZA(t,JA(e));function Ig(t,e,r){var i;const n=ir(t);return((i=e.rpcMap)==null?void 0:i[n.reference])||`${xg}?chainId=${n.namespace}:${n.reference}&projectId=${r}`}function tP(t){return t.includes(":")?t.split(":")[1]:t}function Sg(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function rP(t,e){const r=Object.keys(e.namespaces).filter(n=>n.includes(t));if(!r.length)return[];const i=[];return r.forEach(n=>{const s=e.namespaces[n].accounts;i.push(...s)}),i}function Hh(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>{var i,n;return((i=r?.chains)==null?void 0:i.length)&&((n=r?.chains)==null?void 0:n.length)>0}))}function Un(t={},e={}){const r=Hh(Wh(t)),i=Hh(Wh(e));return VA(r,i)}function Wh(t){var e,r,i,n,s;const o={};if(!qt(t))return o;for(const[a,c]of Object.entries(t)){const l=As(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],f=c.rpcMap||{},p=hi(a);o[p]=eP(Nn(Nn({},o[p]),c),{chains:Ft(l,(e=o[p])==null?void 0:e.chains),methods:Ft(u,(r=o[p])==null?void 0:r.methods),events:Ft(h,(i=o[p])==null?void 0:i.events)}),(qt(f)||qt(((n=o[p])==null?void 0:n.rpcMap)||{}))&&(o[p].rpcMap=Nn(Nn({},f),(s=o[p])==null?void 0:s.rpcMap))}return o}function Gh(t){return t.includes(":")?t.split(":")[2]:t}function Yh(t){const e={};for(const[r,i]of Object.entries(t)){const n=i.methods||[],s=i.events||[],o=i.accounts||[],a=As(r)?[r]:i.chains?i.chains:Sg(i.accounts);e[r]={chains:a,methods:n,events:s,accounts:o}}return e}function ko(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function iP(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const $g={},mi=t=>$g[t],Fo=(t,e)=>{$g[t]=e};var nP=Object.defineProperty,Zh=Object.getOwnPropertySymbols,sP=Object.prototype.hasOwnProperty,oP=Object.prototype.propertyIsEnumerable,Jh=(t,e,r)=>e in t?nP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xh=(t,e)=>{for(var r in e||(e={}))sP.call(e,r)&&Jh(t,r,e[r]);if(Zh)for(var r of Zh(e))oP.call(e,r)&&Jh(t,r,e[r]);return t};const Qh="eip155",aP=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],cP=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,qo=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,ef=t=>Object.keys(t).filter(e=>aP.includes(e)).reduce((e,r)=>(e[r]=lP(t[r]),e),{}),lP=t=>typeof t=="string"&&iP(t)?JSON.parse(t):t,uP=(t,e,r)=>{const{sessionProperties:i={},scopedProperties:n={}}=t,s={};if(!qt(n)&&!qt(i))return;const o=ef(i);for(const a of r){const c=cP(a);if(!c)continue;s[qo(c)]=o;const l=n?.[`${Qh}:${c}`];if(l){const u=l?.[`${Qh}:${c}:${e}`];s[qo(c)]=Xh(Xh({},s[qo(c)]),ef(u||l))}}for(const[a,c]of Object.entries(s))Object.keys(c).length===0&&delete s[a];return Object.keys(s).length>0?s:void 0};var hP=Object.defineProperty,fP=(t,e,r)=>e in t?hP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dP=(t,e,r)=>fP(t,e+"",r);let Mo,pP=class Og{constructor(e){dP(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,r){return await this.storage.setItem(e,r)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return Mo||(Mo=new Og(e)),Mo}};var gP=Object.defineProperty,yP=Object.defineProperties,wP=Object.getOwnPropertyDescriptors,tf=Object.getOwnPropertySymbols,mP=Object.prototype.hasOwnProperty,bP=Object.prototype.propertyIsEnumerable,rf=(t,e,r)=>e in t?gP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vP=(t,e)=>{for(var r in e||(e={}))mP.call(e,r)&&rf(t,r,e[r]);if(tf)for(var r of tf(e))bP.call(e,r)&&rf(t,r,e[r]);return t},EP=(t,e)=>yP(t,wP(e));async function xP(t,e){const r=ir(t.result.capabilities.caip345.caip2),i=t.result.capabilities.caip345.transactionHashes,n=await Promise.allSettled(i.map(h=>_P(r.reference,h,e))),s=n.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);n.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));const o=!s.length||s.some(h=>!h),a=s.every(h=>h?.status==="0x1"),c=s.every(h=>h?.status==="0x0"),l=s.some(h=>h?.status==="0x0");let u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:s,status:u}}async function _P(t,e,r){return await r(parseInt(t)).request(It("eth_getTransactionReceipt",[e]))}async function IP({sendCalls:t,storage:e}){const r=await e.getItem(wi);await e.setItem(wi,EP(vP({},r),{[t.result.id]:{request:t.request,result:t.result,expiry:de(GA)}}))}async function SP({resultId:t,storage:e}){const r=await e.getItem(wi);if(r){delete r[t],await e.setItem(wi,r);for(const i in r)Ut(r[i].expiry)&&delete r[i];await e.setItem(wi,r)}}async function $P({resultId:t,storage:e}){const r=await e.getItem(wi),i=r?.[t];if(i&&!Ut(i.expiry))return i;await SP({resultId:t,storage:e})}var OP=Object.defineProperty,DP=Object.defineProperties,AP=Object.getOwnPropertyDescriptors,nf=Object.getOwnPropertySymbols,PP=Object.prototype.hasOwnProperty,CP=Object.prototype.propertyIsEnumerable,La=(t,e,r)=>e in t?OP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lo=(t,e)=>{for(var r in e||(e={}))PP.call(e,r)&&La(t,r,e[r]);if(nf)for(var r of nf(e))CP.call(e,r)&&La(t,r,e[r]);return t},zo=(t,e)=>DP(t,AP(e)),Nr=(t,e,r)=>La(t,typeof e!="symbol"?e+"":e,r);class BP{constructor(e){Nr(this,"name","eip155"),Nr(this,"client"),Nr(this,"chainId"),Nr(this,"namespace"),Nr(this,"httpProviders"),Nr(this,"events"),Nr(this,"storage"),this.namespace=e.namespace,this.events=mi("events"),this.client=mi("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=pP.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r);const i=this.chainId;this.chainId=parseInt(e),this.events.emit(Pc.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const i=r||Ig(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Sc(new pg(i,mi("disableProviderPing")))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const n=parseInt(tP(r));e[n]=this.createHttpProvider(n,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(e){const r=e||this.chainId;return this.httpProviders[r]||(this.httpProviders=zo(Lo({},this.httpProviders),{[r]:this.createHttpProvider(r)}),this.httpProviders[r])}async handleSwitchChain(e){var r,i;let n=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";n=n.startsWith("0x")?n:`0x${n}`;const s=parseInt(n,16);if(this.isChainApproved(s))this.setDefaultChain(`${s}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:n}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${s}`);else throw new Error(`Failed to switch to chain 'eip155:${s}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,i,n,s,o;const a=(i=(r=e.request)==null?void 0:r.params)==null?void 0:i[0],c=((s=(n=e.request)==null?void 0:n.params)==null?void 0:s[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),u=((o=l?.sessionProperties)==null?void 0:o.capabilities)||{},h=c.length>0?c.join(","):`0x${this.chainId.toString(16)}`,f=`${a}${h}`,p=u?.[f];if(p)return p;let d;try{d=uP(l,a,c)}catch(m){console.warn("Failed to extract capabilities from session",m)}if(d)return d;const y=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:zo(Lo({},l.sessionProperties||{}),{capabilities:zo(Lo({},u||{}),{[f]:y})})})}catch(m){console.warn("Failed to update session with capabilities",m)}return y}async getCallStatus(e){var r,i,n;const s=this.client.session.get(e.topic),o=(r=s.sessionProperties)==null?void 0:r.bundler_name;if(o){const l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}const a=(i=s.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}const c=await $P({resultId:(n=e.request.params)==null?void 0:n[0],storage:this.storage});if(c)try{return await xP(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var i;const n=new URL(e),s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(It("eth_getUserOperationReceipt",[(i=r.request.params)==null?void 0:i[0]]))});if(!s.ok)throw new Error(`Failed to fetch user operation receipt - ${s.status}`);return await s.json()}getBundlerUrl(e,r){return`${WA}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}async sendCalls(e){var r,i,n;const s=await this.client.request(e),o=(r=e.request.params)==null?void 0:r[0],a=s?.id,c=s?.capabilities||{},l=(i=c?.caip345)==null?void 0:i.caip2,u=(n=c?.caip345)==null?void 0:n.transactionHashes;return!a||!l||!(u!=null&&u.length)||await IP({sendCalls:{request:o,result:s},storage:this.storage}),s}}var TP=Object.defineProperty,RP=(t,e,r)=>e in t?TP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ci=(t,e,r)=>RP(t,typeof e!="symbol"?e+"":e,r);class NP{constructor(e){ci(this,"name",_g),ci(this,"client"),ci(this,"httpProviders"),ci(this,"events"),ci(this,"namespace"),ci(this,"chainId"),this.namespace=e.namespace,this.events=mi("events"),this.client=mi("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r);const i=this.chainId;this.chainId=e,this.events.emit(Pc.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return ir(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const i={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(n=>{var s,o;const a=ir(n),c=(o=(s=this.namespace)==null?void 0:s.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];i[a.reference]=this.createHttpProvider(n,c)}),i}getHttpProvider(e){const r=ir(e).reference,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Ig(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Sc(new pg(i,mi("disableProviderPing")))}}var UP=Object.defineProperty,jP=Object.defineProperties,kP=Object.getOwnPropertyDescriptors,sf=Object.getOwnPropertySymbols,FP=Object.prototype.hasOwnProperty,qP=Object.prototype.propertyIsEnumerable,za=(t,e,r)=>e in t?UP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ji=(t,e)=>{for(var r in e||(e={}))FP.call(e,r)&&za(t,r,e[r]);if(sf)for(var r of sf(e))qP.call(e,r)&&za(t,r,e[r]);return t},jn=(t,e)=>jP(t,kP(e)),et=(t,e,r)=>za(t,typeof e!="symbol"?e+"":e,r);let MP=class Dg{constructor(e){et(this,"client"),et(this,"namespaces"),et(this,"optionalNamespaces"),et(this,"sessionProperties"),et(this,"scopedProperties"),et(this,"events",new Ha),et(this,"rpcProviders",{}),et(this,"session"),et(this,"providerOpts"),et(this,"logger"),et(this,"uri"),et(this,"disableProviderPing",!1),et(this,"connectParams");var r,i;this.providerOpts=e,this.logger=xc({logger:(r=e.logger)!=null?r:zh,name:(i=this.providerOpts.name)!=null?i:Eg}),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const r=new Dg(e);return await r.initialize(),r}async request(e,r,i){const[n,s]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:ji({},e),chainId:`${n}:${s}`,topic:this.session.topic,expiry:i})}sendAsync(e,r,i,n){const s=new Date().getTime();this.request(e,i,n).then(o=>r(null,rn(s,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ce("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.connectParams=e,this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:n}=await this.client.authenticate(e,r);i&&(this.uri=i,this.events.emit("display_uri",i));const s=await n();if(this.session=s.session,this.session){const o=Yh(this.session.namespaces);this.namespaces=Un(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return s}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){var r,i;const{uri:n,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties,authentication:(r=this.connectParams)==null?void 0:r.authentication,walletPay:(i=this.connectParams)==null?void 0:i.walletPay});n&&(this.uri=n,this.events.emit("display_uri",n));const o=await s();this.session=o;const a=Yh(o.namespaces);return this.namespaces=Un(this.namespaces,a),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[i,n]=this.validateChain(e);this.getProvider(i).setDefaultChain(n,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(!yt(r))return;for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}catch(r){this.logger.warn(r,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await aA.init({core:this.providerOpts.core,logger:this.providerOpts.logger||zh,relayUrl:this.providerOpts.relayUrl||KA,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error(i,"Failed to get session"),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>hi(r)))];Fo("client",this.client),Fo("events",this.events),Fo("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const i=rP(r,this.session);if(i?.length===0)return;const n=Sg(i),s=Un(this.namespaces,this.optionalNamespaces),o=jn(ji({},s[r]),{accounts:i,chains:n});r==="eip155"?this.rpcProviders[r]=new BP({namespace:o}):this.rpcProviders[r]=new NP({namespace:o})})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:i}=e;i===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:i,topic:n}=e;if(n!==((r=this.session)==null?void 0:r.topic))return;const{event:s}=i;if(s.name==="accountsChanged"){const o=s.data;o&&yt(o)&&this.events.emit("accountsChanged",o.map(Gh))}else if(s.name==="chainChanged"){const o=i.chainId,a=i.event.data,c=hi(o),l=ko(o)!==ko(a)?`${c}:${ko(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i,n;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:s}=r,o=(n=this.client)==null?void 0:n.session.get(e);this.session=jn(ji({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",jn(ji({},ce("USER_DISCONNECTED")),{data:e.topic})))}),this.on(Pc.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(jn(ji({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[_g]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:i={},sessionProperties:n,scopedProperties:s}=e;this.optionalNamespaces=Un(r,i),this.sessionProperties=n,this.scopedProperties=s}validateChain(e){const[r,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,i];if(r&&!Object.keys(this.namespaces||{}).map(o=>hi(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&i)return[r,i];const n=hi(Object.keys(this.namespaces)[0]),s=this.rpcProviders[n].getDefaultChain();return[n,s]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:r,internal:i=!1}){if(!this.namespaces)return;const[n,s]=this.validateChain(e);s&&(this.updateNamespaceChain(n,s),i?(this.events.emit("chainChanged",s),this.emitAccountsChangedOnChainChange({namespace:n,currentCaipChainId:e,previousCaipChainId:r})):this.getProvider(n).setDefaultChain(s),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:r,previousCaipChainId:i}){var n,s;try{if(i===r)return;const o=(s=(n=this.session)==null?void 0:n.namespaces[e])==null?void 0:s.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(Gh);if(!yt(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn(o,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,r){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${r}`,n={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=r):this.namespaces[i]=n}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.connectParams=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var i;const n=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${Rn}/${e}${n}`,r)}async getFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${Rn}/${e}${i}`)}async deleteFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${Rn}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const i of r)i.startsWith(Rn)&&await this.client.core.storage.removeItem(i)}catch(r){this.logger.warn(r,"Failed to cleanup storage")}}};const LP=MP,zP="wc",VP="ethereum_provider",KP=`${zP}@2:${VP}:`,HP="https://rpc.walletconnect.org/v1/",cs=["eth_sendTransaction","personal_sign"],Ag=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],ls=["chainChanged","accountsChanged"],Pg=["chainChanged","accountsChanged","message","disconnect","connect"],WP=async()=>{const{createAppKit:t}=await Kg(()=>import("./core-WM5S_B4o.js").then(e=>e.a5),__vite__mapDeps([0,1,2]),import.meta.url);return t};var GP=Object.defineProperty,YP=Object.defineProperties,ZP=Object.getOwnPropertyDescriptors,of=Object.getOwnPropertySymbols,JP=Object.prototype.hasOwnProperty,XP=Object.prototype.propertyIsEnumerable,Va=(t,e,r)=>e in t?GP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jr=(t,e)=>{for(var r in e||(e={}))JP.call(e,r)&&Va(t,r,e[r]);if(of)for(var r of of(e))XP.call(e,r)&&Va(t,r,e[r]);return t},ki=(t,e)=>YP(t,ZP(e)),tt=(t,e,r)=>Va(t,typeof e!="symbol"?e+"":e,r);function us(t){return Number(t[0].split(":")[1])}function kn(t){return`0x${t.toString(16)}`}function QP(t){const{chains:e,optionalChains:r,methods:i,optionalMethods:n,events:s,optionalEvents:o,rpcMap:a}=t;if(!yt(e))throw new Error("Invalid chains");const c={chains:e,methods:i||cs,events:s||ls,rpcMap:jr({},e.length?{[us(e)]:a[us(e)]}:{})},l=s?.filter(p=>!ls.includes(p)),u=i?.filter(p=>!cs.includes(p));if(!r&&!o&&!n&&!(l!=null&&l.length)&&!(u!=null&&u.length))return{required:e.length?c:void 0};const h=l?.length&&u?.length||!r,f={chains:[...new Set(h?c.chains.concat(r||[]):r)],methods:[...new Set(c.methods.concat(n!=null&&n.length?n:Ag))],events:[...new Set(c.events.concat(o!=null&&o.length?o:Pg))],rpcMap:a};return{required:e.length?c:void 0,optional:r.length?f:void 0}}class Rs{constructor(){tt(this,"events",new ot.EventEmitter),tt(this,"namespace","eip155"),tt(this,"accounts",[]),tt(this,"signer"),tt(this,"chainId",1),tt(this,"modal"),tt(this,"rpc"),tt(this,"STORAGE_KEY",KP),tt(this,"on",(e,r)=>(this.events.on(e,r),this)),tt(this,"once",(e,r)=>(this.events.once(e,r),this)),tt(this,"removeListener",(e,r)=>(this.events.removeListener(e,r),this)),tt(this,"off",(e,r)=>(this.events.off(e,r),this)),tt(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const r=new Rs;return await r.initialize(e),r}async request(e,r){return await this.signer.request(e,this.formatChainId(this.chainId),r)}sendAsync(e,r,i){this.signer.sendAsync(e,r,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var r;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:i,optional:n}=QP(this.rpc);try{const s=await new Promise(async(a,c)=>{var l,u;this.rpc.showQrModal&&((l=this.modal)==null||l.open(),(u=this.modal)==null||u.subscribeState(f=>{!f.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const h=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(ki(jr({namespaces:jr({},i&&{[this.namespace]:i})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:e?.pairingTopic,scopedProperties:h})).then(f=>{a(f)}).catch(f=>{var p;(p=this.modal)==null||p.showErrorMessage("Unable to connect"),c(new Error(f.message))})});if(!s)return;const o=Gl(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:kn(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{(r=this.modal)==null||r.close()}}async authenticate(e,r){var i;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e?.chains});try{const n=await new Promise(async(o,a)=>{var c,l;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(l=this.modal)==null||l.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(ki(jr({},e),{chains:this.rpc.chains}),r).then(u=>{o(u)}).catch(u=>{var h;(h=this.modal)==null||h.showErrorMessage("Unable to connect"),a(new Error(u.message))})}),s=n.session;if(s){const o=Gl(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:kn(this.chainId)})}return n}catch(n){throw this.signer.logger.error(n),n}finally{(i=this.modal)==null||i.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",kn(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",ki(jr({},ce("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",kn(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,i,n]=e.split(":");return{chainId:`${r}:${i}`,address:n}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,i;const n=(r=e?.chains)!=null?r:[],s=(i=e?.optionalChains)!=null?i:[],o=n.concat(s);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=n.length?e?.methods||cs:[],c=n.length?e?.events||ls:[],l=e?.optionalMethods||[],u=e?.optionalEvents||[],h=e?.rpcMap||this.buildRpcMap(o,e.projectId),f=e?.qrModalOptions||void 0;return{chains:n?.map(p=>this.formatChainId(p)),optionalChains:s.map(p=>this.formatChainId(p)),methods:a,events:c,optionalMethods:l,optionalEvents:u,rpcMap:h,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:f,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const i={};return e.forEach(n=>{i[n]=this.getRpcUrl(n,r)}),i}async initialize(e){var r;if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?us(this.rpc.chains):us(this.rpc.optionalChains),this.signer=await LP.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const n=await WP(),{convertWCMToAppKitOptions:s}=await Promise.resolve().then(function(){return u6}),o=s(ki(jr({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!o.networks.length)throw new Error("No networks found for WalletConnect");i=n(ki(jr({},o),{universalProvider:this.signer,manualWCControl:!0,enableMobileFullScreen:((r=this.rpc.qrModalOptions)==null?void 0:r.enableMobileFullScreen)===!0}))}catch(n){throw console.warn(n),new Error("To use QR modal, please install @reown/appkit package")}if(i)try{this.modal=i}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:i,rpcMap:n}=e;r&&yt(r)&&(this.rpc.chains=r.map(s=>this.formatChainId(s)),r.forEach(s=>{this.rpc.rpcMap[s]=n?.[s]||this.getRpcUrl(s)})),i&&yt(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i?.map(s=>this.formatChainId(s)),i.forEach(s=>{this.rpc.rpcMap[s]=n?.[s]||this.getRpcUrl(s)}))}getRpcUrl(e,r){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${HP}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r?.accounts),this.setAccounts(r?.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(r=>this.signer.logger.warn(r))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const e6=Rs;var t6=Object.defineProperty,r6=Object.defineProperties,i6=Object.getOwnPropertyDescriptors,af=Object.getOwnPropertySymbols,n6=Object.prototype.hasOwnProperty,s6=Object.prototype.propertyIsEnumerable,cf=(t,e,r)=>e in t?t6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cg=(t,e)=>{for(var r in e||(e={}))n6.call(e,r)&&cf(t,r,e[r]);if(af)for(var r of af(e))s6.call(e,r)&&cf(t,r,e[r]);return t},o6=(t,e)=>r6(t,i6(e));function a6(t){if(t)return{"--w3m-font-family":t["--wcm-font-family"],"--w3m-accent":t["--wcm-accent-color"],"--w3m-color-mix":t["--wcm-background-color"],"--w3m-z-index":t["--wcm-z-index"]?Number(t["--wcm-z-index"]):void 0,"--w3m-qr-color":t["--wcm-accent-color"],"--w3m-font-size-master":t["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":t["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const c6=t=>{const[e,r]=t.split(":");return Bg({id:r,caipNetworkId:t,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function l6(t){var e,r,i,n,s,o,a;const c=(e=t.chains)==null?void 0:e.map(c6).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const l=c.find(h=>{var f;return h.id===((f=t.defaultChain)==null?void 0:f.id)}),u={projectId:t.projectId,networks:c,themeMode:t.themeMode,themeVariables:a6(t.themeVariables),chainImages:t.chainImages,connectorImages:t.walletImages,defaultNetwork:l,metadata:o6(Cg({},t.metadata),{name:((r=t.metadata)==null?void 0:r.name)||"WalletConnect",description:((i=t.metadata)==null?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:((n=t.metadata)==null?void 0:n.url)||"https://walletconnect.org",icons:((s=t.metadata)==null?void 0:s.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:t.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(t.explorerRecommendedWalletIds)?t.explorerRecommendedWalletIds:[],excludeWalletIds:t.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(t.explorerExcludedWalletIds)?t.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=t.mobileWallets)!=null&&o.length||(a=t.desktopWallets)!=null&&a.length){const h=[...(t.mobileWallets||[]).map(d=>({id:d.id,name:d.name,links:d.links})),...(t.desktopWallets||[]).map(d=>({id:d.id,name:d.name,links:{native:d.links.native,universal:d.links.universal}}))],f=[...u.featuredWalletIds||[],...u.excludeWalletIds||[]],p=h.filter(d=>!f.includes(d.id));p.length&&(u.customWallets=p)}return u}function Bg(t){return Cg({formatters:void 0,fees:void 0,serializers:void 0},t)}var u6=Object.freeze({__proto__:null,convertWCMToAppKitOptions:l6,defineChain:Bg});const t4=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:e6,OPTIONAL_EVENTS:Pg,OPTIONAL_METHODS:Ag,REQUIRED_EVENTS:ls,REQUIRED_METHODS:cs,default:Rs},Symbol.toStringTag,{value:"Module"}));export{on as A,ey as B,kv as C,Lv as D,sm as E,Ha as F,OE as G,um as H,Jr as I,Tt as J,pg as K,t4 as L,Rl as P,xd as Q,at as R,Bd as U,sr as a,zi as b,L as c,ly as d,Ky as e,gt as f,ot as g,jI as h,iI as i,Xe as j,It as k,WS as l,Ic as m,Cs as n,Sc as o,rn as p,M1 as q,Xr as r,oa as s,Je as t,Wr as u,Hr as v,xr as w,Ps as x,Rt as y,pt as z};
